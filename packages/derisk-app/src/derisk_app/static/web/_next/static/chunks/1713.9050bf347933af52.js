"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1713],{421:function(e,r,n){let o;n.d(r,{Z:function(){return m}});var t=n(52676),a=n(40330),l=n(51921),i=n(33967),d=n(4861),s=n(84875),u=n.n(s),c=n(26187),f=n(75271);async function g(){window.obMonaco={getWorkerUrl:e=>{switch(e){case"mysql":return location.origin+"/_next/static/ob-workers/mysql.js";case"obmysql":return location.origin+"/_next/static/ob-workers/obmysql.js";case"oboracle":return location.origin+"/_next/static/ob-workers/oracle.js"}return""}};let e=await n.e(5013).then(n.bind(n,5013)),r=e.default;return o||(o=new r).setup(["mysql"]),o}function m(e){let{className:r,value:n,language:o="mysql",onChange:s,thoughts:c,session:m}=e,p=(0,f.useMemo)(()=>"mysql"!==o?n:c&&c.length>0?(0,l._m)("-- ".concat(c," \n").concat(n)):(0,l._m)(n),[n,c]),k=(0,d.Z)(m),h=(0,f.useContext)(a.p);async function x(e){var r,n;let o=await g();o.setModelOptions((null===(r=e.getModel())||void 0===r?void 0:r.id)||"",function(e,r){let{_modelId:n,delimiter:o}=e;return{delimiter:o,async getTableList(e){var n;return(null==r?void 0:null===(n=r())||void 0===n?void 0:n.getTableList(e))||[]},async getTableColumns(e,n){var o;return(null==r?void 0:null===(o=r())||void 0===o?void 0:o.getTableColumns(e))||[]},async getSchemaList(){var e;return(null==r?void 0:null===(e=r())||void 0===e?void 0:e.getSchemaList())||[]}}}({modelId:(null===(n=e.getModel())||void 0===n?void 0:n.id)||"",delimiter:";"},()=>k.current||null))}return(0,t.jsx)(i.ZP,{className:u()(r),onMount:x,value:p,defaultLanguage:o,onChange:s,theme:(null==h?void 0:h.mode)!=="dark"?"github":"githubDark",options:{minimap:{enabled:!1},wordWrap:"on"}})}i._m.config({monaco:c}),c.editor.defineTheme("github",{base:"vs",inherit:!0,rules:[{background:"ffffff",token:""},{foreground:"6a737d",token:"comment"},{foreground:"6a737d",token:"punctuation.definition.comment"},{foreground:"6a737d",token:"string.comment"},{foreground:"005cc5",token:"constant"},{foreground:"005cc5",token:"entity.name.constant"},{foreground:"005cc5",token:"variable.other.constant"},{foreground:"005cc5",token:"variable.language"},{foreground:"6f42c1",token:"entity"},{foreground:"6f42c1",token:"entity.name"},{foreground:"24292e",token:"variable.parameter.function"},{foreground:"22863a",token:"entity.name.tag"},{foreground:"d73a49",token:"keyword"},{foreground:"d73a49",token:"storage"},{foreground:"d73a49",token:"storage.type"},{foreground:"24292e",token:"storage.modifier.package"},{foreground:"24292e",token:"storage.modifier.import"},{foreground:"24292e",token:"storage.type.java"},{foreground:"032f62",token:"string"},{foreground:"032f62",token:"punctuation.definition.string"},{foreground:"032f62",token:"string punctuation.section.embedded source"},{foreground:"005cc5",token:"support"},{foreground:"005cc5",token:"meta.property-name"},{foreground:"e36209",token:"variable"},{foreground:"24292e",token:"variable.other"},{foreground:"b31d28",fontStyle:"bold italic underline",token:"invalid.broken"},{foreground:"b31d28",fontStyle:"bold italic underline",token:"invalid.deprecated"},{foreground:"fafbfc",background:"b31d28",fontStyle:"italic underline",token:"invalid.illegal"},{foreground:"fafbfc",background:"d73a49",fontStyle:"italic underline",token:"carriage-return"},{foreground:"b31d28",fontStyle:"bold italic underline",token:"invalid.unimplemented"},{foreground:"b31d28",token:"message.error"},{foreground:"24292e",token:"string source"},{foreground:"005cc5",token:"string variable"},{foreground:"032f62",token:"source.regexp"},{foreground:"032f62",token:"string.regexp"},{foreground:"032f62",token:"string.regexp.character-class"},{foreground:"032f62",token:"string.regexp constant.character.escape"},{foreground:"032f62",token:"string.regexp source.ruby.embedded"},{foreground:"032f62",token:"string.regexp string.regexp.arbitrary-repitition"},{foreground:"22863a",fontStyle:"bold",token:"string.regexp constant.character.escape"},{foreground:"005cc5",token:"support.constant"},{foreground:"005cc5",token:"support.variable"},{foreground:"005cc5",token:"meta.module-reference"},{foreground:"735c0f",token:"markup.list"},{foreground:"005cc5",fontStyle:"bold",token:"markup.heading"},{foreground:"005cc5",fontStyle:"bold",token:"markup.heading entity.name"},{foreground:"22863a",token:"markup.quote"},{foreground:"24292e",fontStyle:"italic",token:"markup.italic"},{foreground:"24292e",fontStyle:"bold",token:"markup.bold"},{foreground:"005cc5",token:"markup.raw"},{foreground:"b31d28",background:"ffeef0",token:"markup.deleted"},{foreground:"b31d28",background:"ffeef0",token:"meta.diff.header.from-file"},{foreground:"b31d28",background:"ffeef0",token:"punctuation.definition.deleted"},{foreground:"22863a",background:"f0fff4",token:"markup.inserted"},{foreground:"22863a",background:"f0fff4",token:"meta.diff.header.to-file"},{foreground:"22863a",background:"f0fff4",token:"punctuation.definition.inserted"},{foreground:"e36209",background:"ffebda",token:"markup.changed"},{foreground:"e36209",background:"ffebda",token:"punctuation.definition.changed"},{foreground:"f6f8fa",background:"005cc5",token:"markup.ignored"},{foreground:"f6f8fa",background:"005cc5",token:"markup.untracked"},{foreground:"6f42c1",fontStyle:"bold",token:"meta.diff.range"},{foreground:"005cc5",token:"meta.diff.header"},{foreground:"005cc5",fontStyle:"bold",token:"meta.separator"},{foreground:"005cc5",token:"meta.output"},{foreground:"586069",token:"brackethighlighter.tag"},{foreground:"586069",token:"brackethighlighter.curly"},{foreground:"586069",token:"brackethighlighter.round"},{foreground:"586069",token:"brackethighlighter.square"},{foreground:"586069",token:"brackethighlighter.angle"},{foreground:"586069",token:"brackethighlighter.quote"},{foreground:"b31d28",token:"brackethighlighter.unmatched"},{foreground:"b31d28",token:"sublimelinter.mark.error"},{foreground:"e36209",token:"sublimelinter.mark.warning"},{foreground:"959da5",token:"sublimelinter.gutter-mark"},{foreground:"032f62",fontStyle:"underline",token:"constant.other.reference.link"},{foreground:"032f62",fontStyle:"underline",token:"string.other.link"}],colors:{"editor.foreground":"#24292e","editor.background":"#ffffff","editor.selectionBackground":"#c8c8fa","editor.inactiveSelectionBackground":"#fafbfc","editor.lineHighlightBackground":"#fafbfc","editorCursor.foreground":"#24292e","editorWhitespace.foreground":"#959da5","editorIndentGuide.background":"#959da5","editorIndentGuide.activeBackground":"#24292e","editor.selectionHighlightBorder":"#fafbfc"}}),c.editor.defineTheme("githubDark",{base:"vs-dark",inherit:!0,rules:[{background:"24292e",token:""},{foreground:"959da5",token:"comment"},{foreground:"959da5",token:"punctuation.definition.comment"},{foreground:"959da5",token:"string.comment"},{foreground:"c8e1ff",token:"constant"},{foreground:"c8e1ff",token:"entity.name.constant"},{foreground:"c8e1ff",token:"variable.other.constant"},{foreground:"c8e1ff",token:"variable.language"},{foreground:"b392f0",token:"entity"},{foreground:"b392f0",token:"entity.name"},{foreground:"f6f8fa",token:"variable.parameter.function"},{foreground:"7bcc72",token:"entity.name.tag"},{foreground:"ea4a5a",token:"keyword"},{foreground:"ea4a5a",token:"storage"},{foreground:"ea4a5a",token:"storage.type"},{foreground:"f6f8fa",token:"storage.modifier.package"},{foreground:"f6f8fa",token:"storage.modifier.import"},{foreground:"f6f8fa",token:"storage.type.java"},{foreground:"79b8ff",token:"string"},{foreground:"79b8ff",token:"punctuation.definition.string"},{foreground:"79b8ff",token:"string punctuation.section.embedded source"},{foreground:"c8e1ff",token:"support"},{foreground:"c8e1ff",token:"meta.property-name"},{foreground:"fb8532",token:"variable"},{foreground:"f6f8fa",token:"variable.other"},{foreground:"d73a49",fontStyle:"bold italic underline",token:"invalid.broken"},{foreground:"d73a49",fontStyle:"bold italic underline",token:"invalid.deprecated"},{foreground:"fafbfc",background:"d73a49",fontStyle:"italic underline",token:"invalid.illegal"},{foreground:"fafbfc",background:"d73a49",fontStyle:"italic underline",token:"carriage-return"},{foreground:"d73a49",fontStyle:"bold italic underline",token:"invalid.unimplemented"},{foreground:"d73a49",token:"message.error"},{foreground:"f6f8fa",token:"string source"},{foreground:"c8e1ff",token:"string variable"},{foreground:"79b8ff",token:"source.regexp"},{foreground:"79b8ff",token:"string.regexp"},{foreground:"79b8ff",token:"string.regexp.character-class"},{foreground:"79b8ff",token:"string.regexp constant.character.escape"},{foreground:"79b8ff",token:"string.regexp source.ruby.embedded"},{foreground:"79b8ff",token:"string.regexp string.regexp.arbitrary-repitition"},{foreground:"7bcc72",fontStyle:"bold",token:"string.regexp constant.character.escape"},{foreground:"c8e1ff",token:"support.constant"},{foreground:"c8e1ff",token:"support.variable"},{foreground:"c8e1ff",token:"meta.module-reference"},{foreground:"fb8532",token:"markup.list"},{foreground:"0366d6",fontStyle:"bold",token:"markup.heading"},{foreground:"0366d6",fontStyle:"bold",token:"markup.heading entity.name"},{foreground:"c8e1ff",token:"markup.quote"},{foreground:"f6f8fa",fontStyle:"italic",token:"markup.italic"},{foreground:"f6f8fa",fontStyle:"bold",token:"markup.bold"},{foreground:"c8e1ff",token:"markup.raw"},{foreground:"b31d28",background:"ffeef0",token:"markup.deleted"},{foreground:"b31d28",background:"ffeef0",token:"meta.diff.header.from-file"},{foreground:"b31d28",background:"ffeef0",token:"punctuation.definition.deleted"},{foreground:"176f2c",background:"f0fff4",token:"markup.inserted"},{foreground:"176f2c",background:"f0fff4",token:"meta.diff.header.to-file"},{foreground:"176f2c",background:"f0fff4",token:"punctuation.definition.inserted"},{foreground:"b08800",background:"fffdef",token:"markup.changed"},{foreground:"b08800",background:"fffdef",token:"punctuation.definition.changed"},{foreground:"2f363d",background:"959da5",token:"markup.ignored"},{foreground:"2f363d",background:"959da5",token:"markup.untracked"},{foreground:"b392f0",fontStyle:"bold",token:"meta.diff.range"},{foreground:"c8e1ff",token:"meta.diff.header"},{foreground:"0366d6",fontStyle:"bold",token:"meta.separator"},{foreground:"0366d6",token:"meta.output"},{foreground:"ffeef0",token:"brackethighlighter.tag"},{foreground:"ffeef0",token:"brackethighlighter.curly"},{foreground:"ffeef0",token:"brackethighlighter.round"},{foreground:"ffeef0",token:"brackethighlighter.square"},{foreground:"ffeef0",token:"brackethighlighter.angle"},{foreground:"ffeef0",token:"brackethighlighter.quote"},{foreground:"d73a49",token:"brackethighlighter.unmatched"},{foreground:"d73a49",token:"sublimelinter.mark.error"},{foreground:"fb8532",token:"sublimelinter.mark.warning"},{foreground:"6a737d",token:"sublimelinter.gutter-mark"},{foreground:"79b8ff",fontStyle:"underline",token:"constant.other.reference.link"},{foreground:"79b8ff",fontStyle:"underline",token:"string.other.link"}],colors:{"editor.foreground":"#f6f8fa","editor.background":"#24292e","editor.selectionBackground":"#4c2889","editor.inactiveSelectionBackground":"#444d56","editor.lineHighlightBackground":"#444d56","editorCursor.foreground":"#ffffff","editorWhitespace.foreground":"#6a737d","editorIndentGuide.background":"#6a737d","editorIndentGuide.activeBackground":"#f6f8fa","editor.selectionHighlightBorder":"#444d56"}})},87213:function(e,r,n){var o=n(52676),t=n(97858),a=n.n(t);r.Z=function(e){let{src:r,label:n,width:t,height:l,className:i}=e;return(0,o.jsx)(a(),{className:"w-11 h-11 rounded-full mr-4 border border-gray-200 object-contain bg-white ".concat(i),width:t||44,height:l||44,src:r,alt:n||"db-icon"})}},76657:function(e,r,n){var o=n(14059);r.Z=()=>{var e;return JSON.parse(null!==(e=localStorage.getItem(o.C9))&&void 0!==e?e:"")}},44471:function(e,r,n){n.r(r),n.d(r,{default:function(){return ea}});var o=n(52676),t=n(40330),a=n(16019),l=n(421),i=n(10755),d=n(14059),s=n(30657),u=n(77547),c=n(2206),f=n(40350),g=n(69811),m=n(56275),p=n(84875),k=n.n(p),h=n(97858),x=n.n(h),v=n(98844),b=n(75271),y=n(24841),j=n(15543),w=n(63688),_=n(25377),N=n(7806),C=n(37903),S=n(59849),Z=n(39150),M=n(69439),T=n(64660),q=n(69208),O=n(73810),B=n(53362),L=(0,b.memo)(e=>{let{maxNewTokensValue:r,setMaxNewTokensValue:n}=e,{appInfo:t}=(0,b.useContext)(j.ChatContentContext),{t:a}=(0,y.$G)(),l=(0,b.useMemo)(()=>{var e;return(null===(e=t.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[t.param_need]);if(!l.includes("max_new_tokens"))return(0,o.jsx)(M.Z,{title:a("max_new_tokens_tip"),children:(0,o.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)] cursor-pointer",children:(0,o.jsx)(T.Z,{className:"text-xl cursor-not-allowed opacity-30"})})});let i=e=>{null===e||isNaN(e)||n(e)},d=e=>{n(e)};return(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)(q.Z,{arrow:!1,trigger:["click"],placement:"topLeft",content:()=>(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)(O.Z,{className:"w-32",min:1,max:20480,step:1,onChange:d,value:"number"==typeof r?r:4e3}),(0,o.jsx)(B.Z,{size:"small",className:"w-20",min:1,max:20480,step:1,onChange:i,value:r})]}),children:(0,o.jsx)(M.Z,{title:a("max_new_tokens"),placement:"bottom",arrow:!1,children:(0,o.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)] cursor-pointer",children:(0,o.jsx)(T.Z,{})})})}),(0,o.jsx)("span",{className:"text-sm ml-2",children:r})]})}),$=n(58190),P=n(25675),G=n(46501),J=(0,b.memo)(()=>{let{modelList:e}=(0,b.useContext)(t.p),{appInfo:r,modelValue:n,setModelValue:a}=(0,b.useContext)(j.ChatContentContext),{t:l}=(0,y.$G)(),i=(0,b.useMemo)(()=>{var e;return(null===(e=r.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[r.param_need]);return i.includes("model")?(0,o.jsx)(P.default,{value:n,placeholder:l("choose_model"),className:"h-8 rounded-3xl",onChange:e=>{a(e)},popupMatchSelectWidth:300,children:e.map(e=>(0,o.jsx)(P.default.Option,{children:(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)(G.Z,{model:e}),(0,o.jsx)("span",{className:"ml-2",children:e})]})},e))}):(0,o.jsx)(M.Z,{title:l("model_tip"),children:(0,o.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)]",children:(0,o.jsx)($.Z,{className:"text-xl cursor-not-allowed opacity-30"})})})}),E=n(87213),I=n(51921),D=n(28168),V=n(85408),H=n(10901),z=n(9158),U=n(45467),F=(0,b.memo)(e=>{var r,n,t,l,i;let{fileList:d,setFileList:s,setLoading:u,fileName:c}=e,{setResourceValue:f,appInfo:g,refreshHistory:m,refreshDialogList:p,modelValue:h,resourceValue:x}=(0,b.useContext)(j.ChatContentContext),{temperatureValue:w,maxNewTokensValue:_}=(0,b.useContext)(j.ChatContentContext),N=(0,v.useSearchParams)(),C=null!==(r=null==N?void 0:N.get("scene"))&&void 0!==r?r:"",S=null!==(n=null==N?void 0:N.get("id"))&&void 0!==n?n:"",{t:Z}=(0,y.$G)(),[T,q]=(0,b.useState)([]),O=(0,b.useMemo)(()=>{var e;return(null===(e=g.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[g.param_need]),B=(0,b.useMemo)(()=>{var e,r;return O.includes("resource")&&(null===(e=null===(r=g.param_need)||void 0===r?void 0:r.filter(e=>"resource"===e.type)[0])||void 0===e?void 0:e.value)==="database"},[g.param_need,O]),L=(0,b.useMemo)(()=>{var e,r;return O.includes("resource")&&(null===(e=null===(r=g.param_need)||void 0===r?void 0:r.filter(e=>"resource"===e.type)[0])||void 0===e?void 0:e.value)==="knowledge"},[g.param_need,O]),$=(0,b.useMemo)(()=>{var e;return null===(e=g.param_need)||void 0===e?void 0:e.find(e=>"resource"===e.type)},[g.param_need]),{run:G,loading:J}=(0,H.Z)(async()=>await (0,a.Vx)((0,a.vD)(C)),{manual:!0,onSuccess:e=>{let[,r]=e;q(null!=r?r:[])}});(0,z.Z)(async()=>{(B||L)&&!(null==$?void 0:$.bind_value)&&await G()},[B,L,$]);let F=(0,b.useMemo)(()=>{var e;return null===(e=T.map)||void 0===e?void 0:e.call(T,e=>({label:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(E.Z,{width:24,height:24,src:I.S$[e.type].icon,label:I.S$[e.type].label,className:"w-[1.5em] h-[1.5em] mr-1 inline-block mt-[-4px]"}),e.param]}),value:e.param}))},[T]),W=(0,b.useCallback)(async()=>{let e=new FormData;e.append("doc_file",null==d?void 0:d[0]),u(!0);let[r,n]=await (0,a.Vx)((0,a.qn)({convUid:S,chatMode:C,data:e,model:h,temperatureValue:w,maxNewTokensValue:_,config:{timeout:36e5}})).finally(()=>{u(!1)});n&&(f(n),await m(),await p())},[S,d,h,p,m,C,u,f]);if(!O.includes("resource"))return(0,o.jsx)(M.Z,{title:Z("extend_tip"),children:(0,o.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)]",children:(0,o.jsx)(D.Z,{className:"text-lg cursor-not-allowed opacity-30"})})});switch(null==$?void 0:$.value){case"excel_file":case"text_file":case"image_file":return(0,o.jsx)(U.default,{name:"file",accept:".csv,.xlsx,.xls",fileList:d,showUploadList:!1,beforeUpload:(e,r)=>{null==s||s(r)},customRequest:W,disabled:!!c||!!(null===(t=d[0])||void 0===t?void 0:t.name),children:(0,o.jsx)(M.Z,{title:Z("file_tip"),arrow:!1,placement:"bottom",children:(0,o.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)]",children:(0,o.jsx)(V.Z,{className:k()("text-xl",{"cursor-pointer":!(c||(null===(l=d[0])||void 0===l?void 0:l.name))})})})})});case"database":case"knowledge":case"plugin":case"awel_flow":return x||f(null==F?void 0:null===(i=F[0])||void 0===i?void 0:i.value),(0,o.jsx)(P.default,{value:x,className:"w-52 h-8 rounded-3xl",onChange:e=>{f(e)},disabled:!!(null==$?void 0:$.bind_value),loading:J,options:F})}}),W=(0,b.memo)(e=>{let{temperatureValue:r,setTemperatureValue:n}=e,{appInfo:t}=(0,b.useContext)(j.ChatContentContext),{t:a}=(0,y.$G)(),l=(0,b.useMemo)(()=>{var e;return(null===(e=t.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[t.param_need]);if(!l.includes("temperature"))return(0,o.jsx)(M.Z,{title:a("temperature_tip"),children:(0,o.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)] cursor-pointer",children:(0,o.jsx)(T.Z,{className:"text-xl cursor-not-allowed opacity-30"})})});let i=e=>{isNaN(e)||n(e)};return(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)(q.Z,{arrow:!1,trigger:["click"],placement:"topLeft",content:()=>(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)(O.Z,{className:"w-20",min:0,max:1,step:.1,onChange:i,value:"number"==typeof r?r:0}),(0,o.jsx)(B.Z,{size:"small",className:"w-14",min:0,max:1,step:.1,onChange:i,value:r})]}),children:(0,o.jsx)(M.Z,{title:a("temperature"),placement:"bottom",arrow:!1,children:(0,o.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)] cursor-pointer",children:(0,o.jsx)(T.Z,{})})})}),(0,o.jsx)("span",{className:"text-sm ml-2",children:r})]})}),A=(0,b.memo)(e=>{var r,n;let{ctrl:t}=e,{t:l}=(0,y.$G)(),{history:i,scrollRef:d,canAbort:s,replyLoading:c,currentDialogue:f,appInfo:g,temperatureValue:m,maxNewTokensValue:p,resourceValue:h,setTemperatureValue:v,setMaxNewTokensValue:w,refreshHistory:_,setCanAbort:T,setReplyLoading:q,handleChat:O}=(0,b.useContext)(j.ChatContentContext),[B,$]=(0,b.useState)([]),[P,G]=(0,b.useState)(!1),[E,I]=(0,b.useState)(!1),D=(0,b.useMemo)(()=>{var e;return(null===(e=g.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[g.param_need]),V=(0,b.useMemo)(()=>[{tip:l("stop_replying"),icon:(0,o.jsx)(C.Z,{className:k()({"text-[#0c75fc]":s})}),can_use:s,key:"abort",onClick:()=>{s&&(t.abort(),setTimeout(()=>{T(!1),q(!1)},100))}},{tip:l("answer_again"),icon:(0,o.jsx)(S.Z,{}),can_use:!c&&i.length>0,key:"redo",onClick:async()=>{var e,r;let n=null===(e=null===(r=i.filter(e=>"human"===e.role))||void 0===r?void 0:r.slice(-1))||void 0===e?void 0:e[0];O((null==n?void 0:n.context)||"",{app_code:g.app_code,...D.includes("temperature")&&{temperature:m},...D.includes("max_new_tokens")&&{max_new_tokens:p},...D.includes("resource")&&{select_param:"string"==typeof h?h:JSON.stringify(h)||f.select_param}}),setTimeout(()=>{var e,r;null===(e=d.current)||void 0===e||e.scrollTo({top:null===(r=d.current)||void 0===r?void 0:r.scrollHeight,behavior:"smooth"})},0)}},{tip:l("erase_memory"),icon:E?(0,o.jsx)(N.Z,{spinning:E,indicator:(0,o.jsx)(u.Z,{style:{fontSize:20}})}):(0,o.jsx)(Z.Z,{}),can_use:i.length>0,key:"clear",onClick:async()=>{E||(I(!0),await (0,a.Vx)((0,a.zR)(f.conv_uid)).finally(async()=>{await _(),I(!1)}))}}],[l,s,c,i,E,t,T,q,O,g.app_code,D,m,h,f.select_param,f.conv_uid,d,_]),H=(0,b.useMemo)(()=>{try{return JSON.parse(f.select_param).file_name}catch(e){return""}},[f.select_param]);return(0,o.jsxs)("div",{className:"flex flex-col  mb-2",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between h-full w-full",children:[(0,o.jsxs)("div",{className:"flex gap-3 text-lg",children:[(0,o.jsx)(J,{}),(0,o.jsx)(F,{fileList:B,setFileList:$,setLoading:G,fileName:H}),(0,o.jsx)(W,{temperatureValue:m,setTemperatureValue:v}),(0,o.jsx)(L,{maxNewTokensValue:p,setMaxNewTokensValue:w})]}),(0,o.jsx)("div",{className:"flex gap-1",children:(0,o.jsx)(o.Fragment,{children:V.map(e=>(0,o.jsx)(M.Z,{title:e.tip,arrow:!1,placement:"bottom",children:(0,o.jsx)("div",{className:"flex w-8 h-8 items-center justify-center rounded-md hover:bg-[rgb(221,221,221,0.6)] text-lg ".concat(e.can_use?"cursor-pointer":"opacity-30 cursor-not-allowed"),onClick:()=>{var r;null===(r=e.onClick)||void 0===r||r.call(e)},children:e.icon})},e.key))})})]}),(H||(null===(r=B[0])||void 0===r?void 0:r.name))&&(0,o.jsx)("div",{className:"group/item flex mt-2",children:(0,o.jsxs)("div",{className:"flex items-center justify-between w-64 border border-[#e3e4e6] dark:border-[rgba(255,255,255,0.6)] rounded-lg p-2",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)(x(),{src:"/icons/chat/excel.png",width:20,height:20,alt:"file-icon",className:"mr-2"}),(0,o.jsx)("span",{className:"text-sm text-[#1c2533] dark:text-white line-clamp-1",children:H||(null===(n=B[0])||void 0===n?void 0:n.name)})]}),(0,o.jsx)(N.Z,{spinning:P,indicator:(0,o.jsx)(u.Z,{style:{fontSize:24},spin:!0})})]})})]})}),R=(0,b.memo)(e=>{var r;let{ctrl:n}=e,{t}=(0,y.$G)(),{scrollRef:a,replyLoading:l,handleChat:i,appInfo:d,currentDialogue:s,temperatureValue:c,maxNewTokensValue:f,resourceValue:g,refreshDialogList:m}=(0,b.useContext)(j.ChatContentContext),p=(0,v.useSearchParams)(),h=null!==(r=null==p?void 0:p.get("select_param"))&&void 0!==r?r:"",[x,C]=(0,b.useState)(""),[S,Z]=(0,b.useState)(!1),[M,T]=(0,b.useState)(!1),q=(0,b.useRef)(0),O=(0,b.useMemo)(()=>{var e;return(null===(e=d.param_need)||void 0===e?void 0:e.map(e=>e.type))||[]},[d.param_need]),B=async()=>{q.current++,setTimeout(()=>{var e,r;null===(e=a.current)||void 0===e||e.scrollTo({top:null===(r=a.current)||void 0===r?void 0:r.scrollHeight,behavior:"smooth"}),C("")},0),await i(x,{app_code:d.app_code||"",...O.includes("temperature")&&{temperature:c},...O.includes("max_new_tokens")&&{max_new_tokens:f},select_param:h,...O.includes("resource")&&{select_param:"string"==typeof g?g:JSON.stringify(g)||s.select_param}}),1===q.current&&await m()};return(0,o.jsx)("div",{className:"flex flex-col w-full mx-auto pt-4 pb-0 bg-transparent",children:(0,o.jsxs)("div",{className:"flex flex-1 flex-col bg-white dark:bg-[rgba(255,255,255,0.16)] px-5 py-4 pt-2 rounded-xl relative border-t border-b border-l border-r dark:border-[rgba(255,255,255,0.6)] ".concat(S?"border-[#0c75fc]":""),id:"input-panel",children:[(0,o.jsx)(A,{ctrl:n}),(0,o.jsx)(w.default.TextArea,{placeholder:t("input_tips"),className:"w-full h-10 resize-none border-0 p-0 focus:shadow-none dark:bg-transparent",value:x,onKeyDown:e=>{"Enter"===e.key&&!e.shiftKey&&!M&&(e.preventDefault(),x.trim()&&!l&&B())},onChange:e=>{C(e.target.value)},onFocus:()=>{Z(!0)},onBlur:()=>Z(!1),onCompositionStart:()=>T(!0),onCompositionEnd:()=>T(!1)}),(0,o.jsx)(_.ZP,{type:"primary",className:k()("flex items-center justify-center w-14 h-8 rounded-lg text-sm absolute right-4 bottom-3 bg-button-gradient border-0",{"cursor-not-allowed":!x.trim()}),onClick:()=>{!l&&x.trim()&&B()},children:l?(0,o.jsx)(N.Z,{spinning:l,indicator:(0,o.jsx)(u.Z,{className:"text-white"})}):t("sent")})]})})});let K=()=>{var e;let r=JSON.parse(null!==(e=localStorage.getItem(d.C9))&&void 0!==e?e:""),n=(null==r?void 0:r.avatar_url)||"/agents/sre.png";return(0,o.jsx)(x(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:32,height:32,src:n,alt:"User Avatar"})},Q={todo:{bgClass:"bg-gray-500",icon:(0,o.jsx)(s.Z,{className:"ml-2"})},runing:{bgClass:"bg-blue-500",icon:(0,o.jsx)(u.Z,{className:"ml-2"})},failed:{bgClass:"bg-red-500",icon:(0,o.jsx)(c.Z,{className:"ml-2"})},completed:{bgClass:"bg-green-500",icon:(0,o.jsx)(f.Z,{className:"ml-2"})}},X=e=>e.replaceAll("\\n","\n").replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>"),Y=e=>null==e?void 0:e.replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>");var ee=(0,b.memo)(e=>{var r;let{content:n,onLinkClick:t,messages:a}=e,{t:l}=(0,y.$G)(),d=(0,v.useSearchParams)(),s=null!==(r=null==d?void 0:d.get("scene"))&&void 0!==r?r:"",{context:u,model_name:c,role:f,thinking:p}=n,h=(0,b.useMemo)(()=>"view"===f,[f]),{value:x,cachePluginContext:j}=(0,b.useMemo)(()=>{if("string"!=typeof u)return{relations:[],value:"",cachePluginContext:[]};let[e,r]=u.split("	relations:"),n=r?r.split(","):[],o=[],t=0,a=e.replace(/<dbgpt-view[^>]*>[^<]*<\/dbgpt-view>/gi,e=>{try{var r;let n=e.replaceAll("\n","\\n").replace(/<[^>]*>|<\/[^>]*>/gm,""),a=JSON.parse(n),l="<custom-view>".concat(t,"</custom-view>");return o.push({...a,result:X(null!==(r=a.result)&&void 0!==r?r:"")}),t++,l}catch(r){return console.log(r.message,r),e}});return{relations:n,cachePluginContext:o,value:a}},[u]),w=(0,b.useMemo)(()=>({"custom-view"(e){var r;let{children:n}=e,t=+n.toString();if(!j[t])return n;let{name:a,status:l,err_msg:d,result:s}=j[t],{bgClass:u,icon:c}=null!==(r=Q[l])&&void 0!==r?r:{};return(0,o.jsxs)("div",{className:"bg-white dark:bg-[#212121] rounded-lg overflow-hidden my-2 flex flex-col lg:max-w-[80%]",children:[(0,o.jsxs)("div",{className:k()("flex px-4 md:px-6 py-2 items-center text-white text-sm",u),children:[a,c]}),s?(0,o.jsx)("div",{className:"px-4 md:px-6 py-4 text-sm",children:(0,o.jsx)(m.Z,{components:i.ZP,...i.dx,children:(0,i.CE)(null!=s?s:"")})}):(0,o.jsx)("div",{className:"px-4 md:px-6 py-4 text-sm",children:d})]})}}),[j]),_=function(e){try{let r=JSON.parse(e);return r}catch(e){return console.log(e),{left:"",right:""}}}(u),{left:N="",right:C=""}=_;return(0,o.jsx)("div",{className:"flex h-full",children:(0,o.jsxs)("div",{className:"flex ".concat("chat_agent"!==s||p?"":"flex-1"," overflow-hidden"),children:[!h&&!1,h&&(0,o.jsx)("div",{className:"flex flex-1 flex-col w-full p-2",children:(0,o.jsxs)("div",{className:"flex w-full h-full bg-white dark:bg-[rgba(255,255,255,0.16)] p-2 rounded-2xl",children:["object"==typeof u&&(0,o.jsxs)("div",{children:["[".concat(u.template_name,"]: "),(0,o.jsxs)("span",{className:"text-theme-primary cursor-pointer",onClick:t,children:[(0,o.jsx)(g.Z,{className:"mr-1"}),u.template_introduce||"More Details"]})]}),"string"==typeof u&&"chat_agent"===s&&(0,o.jsxs)("div",{className:"flex flex-row w-full",children:[(0,o.jsxs)("div",{className:"flex flex-col w-2/5 pr-2 border-dashed border-r border-gray-300",children:[(0,o.jsxs)("div",{className:"flex flex-col flex-justify-space-between h-full overflow-y-auto",children:[(0,o.jsxs)("div",{className:"flex flex-row gap-2 mb-2 text-gray-500 text-ms pt-2 pb-3 justify-end",children:[(0,o.jsx)("span",{className:"wrap-break-word w-4/5",children:a[0].context}),(0,o.jsx)("span",{className:"pl-3",children:(0,o.jsx)(K,{})})]}),(0,o.jsx)(m.Z,{components:i.ZP,...i.dx,children:(0,i.CE)(Y(N))})]}),(0,o.jsx)(R,{})]}),(0,o.jsx)("div",{className:"flex flex-col w-3/5 pl-2 h-full",children:(0,o.jsx)(m.Z,{className:"h-full overflow-y-auto",components:i.ZP,...i.dx,children:(0,i.CE)(Y(C))})})]}),"string"==typeof u&&"chat_agent"!==s&&(0,o.jsx)("div",{children:(0,o.jsx)(m.Z,{components:{...i.ZP,...w},...i.dx,children:(0,i.CE)(X(x))})}),!1]})})]})})}),er=n(8891),en=n(83958),eo=n(32699),et=n(5185),ea=(0,b.memo)(()=>{var e,r;let n=(0,b.useRef)(null),i=(0,v.useSearchParams)(),d=null!==(r=null==i?void 0:i.get("id"))&&void 0!==r?r:"",{currentDialogInfo:s,model:u}=(0,b.useContext)(t.p),{history:c,handleChat:f,refreshDialogList:g,setAppInfo:m,setModelValue:p,setTemperatureValue:k,setMaxNewTokensValue:h,setResourceValue:x}=(0,b.useContext)(j.ChatContentContext),y=(0,er.Z)(f,{wait:500}),[w,_]=(0,b.useState)(!1),[N,C]=(0,b.useState)(""),S=(0,b.useMemo)(()=>{let e=(0,eo.cloneDeep)(c);return e.filter(e=>["view","human"].includes(e.role)).map(e=>({...e,key:(0,et.Z)()}))},[c]);return(0,z.Z)(async()=>{console.log(d,s,"chatId, currentDialogInfo");let e=(0,I.a_)();if(e&&e.id===d){let[,d]=await (0,a.Vx)((0,a.BN)({...s}));if(d){var r,n,o,t,l,i,c,f,v;let a=(null==d?void 0:null===(r=d.param_need)||void 0===r?void 0:r.map(e=>e.type))||[],s=(null===(n=null==d?void 0:null===(o=d.param_need)||void 0===o?void 0:o.filter(e=>"model"===e.type)[0])||void 0===n?void 0:n.value)||u,b=(null===(t=null==d?void 0:null===(l=d.param_need)||void 0===l?void 0:l.filter(e=>"temperature"===e.type)[0])||void 0===t?void 0:t.value)||.6,j=(null===(i=null==d?void 0:null===(c=d.param_need)||void 0===c?void 0:c.filter(e=>"max_new_tokens"===e.type)[0])||void 0===i?void 0:i.value)||4e3,w=null===(f=null==d?void 0:null===(v=d.param_need)||void 0===v?void 0:v.filter(e=>"resource"===e.type)[0])||void 0===f?void 0:f.bind_value;m(d||{}),k(b||.6),h(j||4e3),p(s),x(w),y.run(e.message,{app_code:null==d?void 0:d.app_code,model_name:s,...(null==a?void 0:a.includes("temperature"))&&{temperature:b},...(null==a?void 0:a.includes("max_new_tokens"))&&{max_new_tokens:j},...a.includes("resource")&&{select_param:"string"==typeof w?w:JSON.stringify(w)}}),await g(),localStorage.removeItem(I.rU)}}},[d,JSON.stringify(s)]),(0,b.useEffect)(()=>{setTimeout(()=>{var e,r;null===(e=n.current)||void 0===e||e.scrollTo(0,null===(r=n.current)||void 0===r?void 0:r.scrollHeight)},50)},[c,null===(e=c[c.length-1])||void 0===e?void 0:e.context]),(0,o.jsxs)("div",{className:"w-full pl-4 pr-4 h-full",ref:n,children:[!!S.length&&S.filter(e=>"view"===e.role).map((e,r)=>(0,o.jsx)(ee,{content:e,onLinkClick:()=>{_(!0),C(JSON.stringify(null==e?void 0:e.context,null,2))},messages:S},r)),(0,o.jsx)(en.default,{title:"JSON Editor",open:w,width:"60%",cancelButtonProps:{hidden:!0},onOk:()=>{_(!1)},onCancel:()=>{_(!1)},children:(0,o.jsx)(l.Z,{className:"w-full h-[500px]",language:"json",value:N})})]})})},46501:function(e,r,n){var o=n(52676),t=n(22877),a=n(97858),l=n.n(a),i=n(75271);r.Z=(0,i.memo)(e=>{let{width:r,height:n,model:a}=e,d=(0,i.useMemo)(()=>(0,t.ab)(a||"huggingface"),[a]);return a?(0,o.jsx)(l(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:r||24,height:n||24,src:d,alt:"llm",priority:!0}):null})}}]);