(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6442,1201],{74266:function(e,o,t){var n={"./simpleWorker":50223,"./simpleWorker.js":50223,"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/base/common/worker/simpleWorker":50223,"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/base/common/worker/simpleWorker.js":50223};function r(e){return Promise.resolve().then(function(){if(!t.o(n,e)){var o=Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}return t(n[e])})}r.keys=function(){return Object.keys(n)},r.id=74266,e.exports=r},79410:function(e,o,t){var n={"./editorBaseApi":[54726],"./editorBaseApi.js":[54726],"./editorSimpleWorker":[56216],"./editorSimpleWorker.js":[56216],"./editorWorker":[14541],"./editorWorker.js":[14541],"./editorWorkerHost":[7570],"./editorWorkerHost.js":[7570],"./findSectionHeaders":[26767],"./findSectionHeaders.js":[26767],"./getIconClasses":[25129],"./getIconClasses.js":[25129],"./languageFeatureDebounce":[27825],"./languageFeatureDebounce.js":[27825],"./languageFeatures":[47924],"./languageFeatures.js":[47924],"./languageFeaturesService":[26524],"./languageFeaturesService.js":[26524],"./languageService":[39920],"./languageService.js":[39920],"./languagesAssociations":[15981],"./languagesAssociations.js":[15981],"./languagesRegistry":[27921],"./languagesRegistry.js":[27921],"./markerDecorations":[90231],"./markerDecorations.js":[90231],"./markerDecorationsService":[15761],"./markerDecorationsService.js":[15761],"./model":[42361],"./model.js":[42361],"./modelService":[95451],"./modelService.js":[95451],"./resolverService":[16417],"./resolverService.js":[16417],"./semanticTokensDto":[77263],"./semanticTokensDto.js":[77263],"./semanticTokensProviderStyling":[89094],"./semanticTokensProviderStyling.js":[89094],"./semanticTokensStyling":[51819],"./semanticTokensStyling.js":[51819],"./semanticTokensStylingService":[79837],"./semanticTokensStylingService.js":[79837],"./textModelSync/textModelSync.impl":[48838],"./textModelSync/textModelSync.impl.js":[48838],"./textModelSync/textModelSync.protocol":[45858,5858],"./textModelSync/textModelSync.protocol.js":[45858,5858],"./textResourceConfiguration":[95633],"./textResourceConfiguration.js":[95633],"./treeSitterParserService":[25224],"./treeSitterParserService.js":[25224],"./treeViewsDnd":[10234],"./treeViewsDnd.js":[10234],"./treeViewsDndService":[8743],"./treeViewsDndService.js":[8743],"./unicodeTextModelHighlighter":[69810],"./unicodeTextModelHighlighter.js":[69810],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorBaseApi":[54726],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorBaseApi.js":[54726],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorSimpleWorker":[56216],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorSimpleWorker.js":[56216],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorWorker":[14541],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorWorker.js":[14541],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorWorkerHost":[7570],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorWorkerHost.js":[7570],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/findSectionHeaders":[26767],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/findSectionHeaders.js":[26767],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/getIconClasses":[25129],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/getIconClasses.js":[25129],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageFeatureDebounce":[27825],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageFeatureDebounce.js":[27825],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageFeatures":[47924],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageFeatures.js":[47924],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageFeaturesService":[26524],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageFeaturesService.js":[26524],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageService":[39920],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageService.js":[39920],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languagesAssociations":[15981],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languagesAssociations.js":[15981],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languagesRegistry":[27921],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languagesRegistry.js":[27921],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/markerDecorations":[90231],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/markerDecorations.js":[90231],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/markerDecorationsService":[15761],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/markerDecorationsService.js":[15761],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/model":[42361],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/model.js":[42361],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/modelService":[95451],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/modelService.js":[95451],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/resolverService":[16417],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/resolverService.js":[16417],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensDto":[77263],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensDto.js":[77263],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensProviderStyling":[89094],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensProviderStyling.js":[89094],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensStyling":[51819],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensStyling.js":[51819],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensStylingService":[79837],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensStylingService.js":[79837],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/textModelSync/textModelSync.impl":[48838],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/textModelSync/textModelSync.impl.js":[48838],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/textModelSync/textModelSync.protocol":[45858,5858],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/textModelSync/textModelSync.protocol.js":[45858,5858],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/textResourceConfiguration":[95633],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/textResourceConfiguration.js":[95633],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/treeSitterParserService":[25224],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/treeSitterParserService.js":[25224],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/treeViewsDnd":[10234],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/treeViewsDnd.js":[10234],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/treeViewsDndService":[8743],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/treeViewsDndService.js":[8743],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/unicodeTextModelHighlighter":[69810],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/unicodeTextModelHighlighter.js":[69810]};function r(e){if(!t.o(n,e))return Promise.resolve().then(function(){var o=Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o});var o=n[e],r=o[0];return Promise.all(o.slice(1).map(t.e)).then(function(){return t(r)})}r.keys=function(){return Object.keys(n)},r.id=79410,e.exports=r},77401:function(e,o,t){"use strict";t.r(o),t.d(o,{default:function(){return eR}});var n=t(52676),r=t(40330),l=t(63384),s=t(86471),a=t(51921),i=t(8869),d=t(82187),c=t.n(d),u=t(98844),m=t(75271),f=t(85100),g=t(14425),p=t(99532),v=()=>{let{history:e,setHistory:o,chatId:t,model:n,docId:a}=(0,m.useContext)(r.p),{chat:i}=(0,s.Z)({queryAgentURL:"/knowledge/document/summary"}),d=(0,m.useCallback)(async e=>{let[,r]=await (0,l.Vx)((0,l.$i)(t)),s=[...r,{role:"human",context:"",model_name:n,order:0,time_stamp:0},{role:"view",context:"",model_name:n,order:0,time_stamp:0,retry:!0}],d=s.length-1;o([...s]),await i({data:{doc_id:e||a,model_name:n},chatId:t,onMessage:e=>{s[d].context=e,o([...s])}})},[e,n,a,t]);return d},h=t(65351),x=t(60680),k=t(26385),b=t(23435),j=t(83803),y=t(47266),_=t(41581),w=t(874),S=t.n(w),N=t(32699),Z=t(6821),C=t(47219),P=t(7464),M=t(25433),D=t(87007),R=t(65483),E=t(96950);function O(e){let{document:o}=e;switch(o.status){case"RUNNING":return(0,n.jsx)(R.Rp,{});case"FINISHED":default:return(0,n.jsx)(R.s2,{});case"FAILED":return(0,n.jsx)(E.Z,{})}}function T(e){let{documents:o,dbParam:t}=e,r=(0,D.useRouter)(),l=e=>{r.push("/knowledge/chunk/?spaceName=".concat(t,"&id=").concat(e))};return(null==o?void 0:o.length)?(0,n.jsx)("div",{className:"absolute flex overflow-scroll h-12 top-[-35px] w-full z-10",children:o.map(e=>{let o;switch(e.status){case"RUNNING":o="#2db7f5";break;case"FINISHED":default:o="#87d068";break;case"FAILED":o="#f50"}return(0,n.jsx)(y.Z,{title:e.result,children:(0,n.jsxs)(M.ZP,{style:{color:o},onClick:()=>{l(e.id)},className:"shrink flex items-center mr-3",children:[(0,n.jsx)(O,{document:e}),e.doc_name]})},e.id)})}):null}var F=t(44655),I=t(29144);function H(e){let{dbParam:o,setDocId:t}=(0,m.useContext)(r.p),{onUploadFinish:s,handleFinish:a}=e,i=v(),[d,c]=(0,m.useState)(!1),u=async e=>{c(!0);let n=new FormData;n.append("doc_name",e.file.name),n.append("doc_file",e.file),n.append("doc_type","DOCUMENT");let r=await (0,l.Vx)((0,l.iG)(o||"default",n));if(!r[1]){c(!1);return}t(r[1]),s(),c(!1),null==a||a(!0),await i(r[1]),null==a||a(!1)};return(0,n.jsx)(I.default,{customRequest:u,showUploadList:!1,maxCount:1,multiple:!1,className:"absolute z-10 top-2 left-2",accept:".pdf,.ppt,.pptx,.xls,.xlsx,.doc,.docx,.txt,.md",children:(0,n.jsx)(M.ZP,{loading:d,size:"small",shape:"circle",icon:(0,n.jsx)(F.Z,{})})})}var V=t(20346),W=t(58976),A=t(6051),L=t(71921),U=t(35209),q=t(50107),B=t(44745),$=t(53024);let z=e=>{let{data:o,loading:t,submit:r,close:l}=e,{t:s}=(0,Z.$G)(),a=e=>()=>{r(e),l()};return(0,n.jsx)("div",{style:{maxHeight:400,overflow:"auto"},children:(0,n.jsx)(A.Z,{dataSource:null==o?void 0:o.data,loading:t,rowKey:e=>e.prompt_name,renderItem:e=>(0,n.jsx)(A.Z.Item,{onClick:a(e.content),children:(0,n.jsx)(y.Z,{title:e.content,children:(0,n.jsx)(A.Z.Item.Meta,{style:{cursor:"copy"},title:e.prompt_name,description:s("Prompt_Info_Scene")+"：".concat(e.chat_scene,"，")+s("Prompt_Info_Sub_Scene")+"：".concat(e.sub_chat_scene)})})},e.prompt_name)})})};var J=e=>{let{submit:o}=e,{t}=(0,Z.$G)(),[r,l]=(0,m.useState)(!1),[s,a]=(0,m.useState)("common"),{data:i,loading:d}=(0,W.Z)(()=>(0,V.PR)("/prompt/list",{prompt_type:s}),{refreshDeps:[s],onError:e=>{j.ZP.error(null==e?void 0:e.message)}});return(0,n.jsx)(L.ZP,{theme:{components:{Popover:{minWidth:250}}},children:(0,n.jsx)(U.Z,{title:(0,n.jsx)(q.Z.Item,{label:"Prompt "+t("Type"),children:(0,n.jsx)(B.default,{style:{width:150},value:s,onChange:e=>{a(e)},options:[{label:t("Public")+" Prompts",value:"common"},{label:t("Private")+" Prompts",value:"private"}]})}),content:(0,n.jsx)(z,{data:i,loading:d,submit:o,close:()=>{l(!1)}}),placement:"topRight",trigger:"click",open:r,onOpenChange:e=>{l(e)},children:(0,n.jsx)(y.Z,{title:t("Click_Select")+" Prompt",children:(0,n.jsx)($.Z,{className:"bottom-[30%]"})})})})},G=function(e){let{children:o,loading:t,onSubmit:s,handleFinish:a,placeholder:i,...d}=e,{dbParam:c,scene:u}=(0,m.useContext)(r.p),[f,g]=(0,m.useState)(""),p=(0,m.useMemo)(()=>"chat_knowledge"===u,[u]),[v,h]=(0,m.useState)([]),x=(0,m.useRef)(0);async function k(){if(!c)return null;let[e,o]=await (0,l.Vx)((0,l._Q)(c,{page:1,page_size:x.current}));h((null==o?void 0:o.data)||[])}(0,m.useEffect)(()=>{p&&k()},[c]);let b=async()=>{x.current+=1,await k()};return(0,n.jsxs)("div",{className:"flex-1 relative",children:[(0,n.jsx)(T,{documents:v,dbParam:c}),p&&(0,n.jsx)(H,{handleFinish:a,onUploadFinish:b,className:"absolute z-10 top-2 left-2"}),(0,n.jsx)(P.default.TextArea,{className:"flex-1 ".concat(p?"pl-10":""," pr-10"),size:"large",value:f,autoSize:{minRows:1,maxRows:4},...d,onPressEnter:e=>{if(f.trim()&&13===e.keyCode){if(e.shiftKey){e.preventDefault(),g(e=>e+"\n");return}s(f),setTimeout(()=>{g("")},0)}},onChange:e=>{if("number"==typeof d.maxLength){g(e.target.value.substring(0,d.maxLength));return}g(e.target.value)},placeholder:i}),(0,n.jsx)(M.ZP,{className:"ml-2 flex items-center justify-center absolute right-0 bottom-0",size:"large",type:"text",loading:t,icon:(0,n.jsx)(C.Z,{}),onClick:()=>{s(f)}}),(0,n.jsx)(J,{submit:e=>{g(f+e)}}),o]})},K=t(94075),Q=t(10755),X=(0,m.memo)(function(e){var o;let{content:t}=e,{scene:l}=(0,m.useContext)(r.p),s="view"===t.role;return(0,n.jsx)("div",{className:c()("relative w-full p-2 md:p-4 rounded-xl break-words",{"bg-white dark:bg-[#232734]":s,"lg:w-full xl:w-full pl-0":["chat_with_db_execute","chat_dashboard"].includes(l)}),children:s?(0,n.jsx)(K.Z,{components:Q.ZP,...Q.dx,children:(0,Q.CE)(null==(o=t.context)?void 0:o.replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>"))}):(0,n.jsx)("div",{className:"",children:t.context})})}),Y=t(29091),ee=t(79312),eo=t(15409),et=t(89633),en=t(53596),er=t(89314),el=t(13921),es=t(52977),ea=t(21667);let ei={todo:{bgClass:"bg-gray-500",icon:(0,n.jsx)(Y.Z,{className:"ml-2"})},runing:{bgClass:"bg-blue-500",icon:(0,n.jsx)(ee.Z,{className:"ml-2"})},failed:{bgClass:"bg-red-500",icon:(0,n.jsx)(eo.Z,{className:"ml-2"})},completed:{bgClass:"bg-green-500",icon:(0,n.jsx)(et.Z,{className:"ml-2"})}};function ed(e){return e.replaceAll("\\n","\n").replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>")}var ec=(0,m.memo)(function(e){let{children:o,content:t,isChartChat:l,onLinkClick:s}=e,{scene:a}=(0,m.useContext)(r.p),{context:i,model_name:d,role:u}=t,f="view"===u,{relations:g,value:p,cachePluginContext:v}=(0,m.useMemo)(()=>{if("string"!=typeof i)return{relations:[],value:"",cachePluginContext:[]};let[e,o]=i.split("	relations:"),t=o?o.split(","):[],n=[],r=0,l=e.replace(/<dbgpt-view[^>]*>[^<]*<\/dbgpt-view>/gi,e=>{try{var o;let t=e.replaceAll("\n","\\n").replace(/<[^>]*>|<\/[^>]*>/gm,""),l=JSON.parse(t),s="<custom-view>".concat(r,"</custom-view>");return n.push({...l,result:ed(null!==(o=l.result)&&void 0!==o?o:"")}),r++,s}catch(o){return console.log(o.message,o),e}});return{relations:t,cachePluginContext:n,value:l}},[i]),h=(0,m.useMemo)(()=>({"custom-view"(e){var o;let{children:t}=e,r=+t.toString();if(!v[r])return t;let{name:l,status:s,err_msg:a,result:i}=v[r],{bgClass:d,icon:u}=null!==(o=ei[s])&&void 0!==o?o:{};return(0,n.jsxs)("div",{className:"bg-white dark:bg-[#212121] rounded-lg overflow-hidden my-2 flex flex-col lg:max-w-[80%]",children:[(0,n.jsxs)("div",{className:c()("flex px-4 md:px-6 py-2 items-center text-white text-sm",d),children:[l,u]}),i?(0,n.jsx)("div",{className:"px-4 md:px-6 py-4 text-sm",children:(0,n.jsx)(K.Z,{components:Q.ZP,...Q.dx,children:(0,Q.CE)(null!=i?i:"")})}):(0,n.jsx)("div",{className:"px-4 md:px-6 py-4 text-sm",children:a})]})}}),[i,v]);return f||i?(0,n.jsxs)("div",{className:c()("relative flex flex-wrap w-full p-2 md:p-4 rounded-xl break-words",{"bg-white dark:bg-[#232734]":f,"lg:w-full xl:w-full pl-0":["chat_with_db_execute","chat_dashboard"].includes(a)}),children:[(0,n.jsx)("div",{className:"mr-2 flex flex-shrink-0 items-center justify-center h-7 w-7 rounded-full text-lg sm:mr-4",children:f?(0,ea.A)(d)||(0,n.jsx)(en.Z,{}):(0,n.jsx)(er.Z,{})}),(0,n.jsxs)("div",{className:"flex-1 overflow-hidden items-center text-md leading-8 pb-2",children:[!f&&"string"==typeof i&&i,f&&l&&"object"==typeof i&&(0,n.jsxs)("div",{children:["[".concat(i.template_name,"]: "),(0,n.jsxs)("span",{className:"text-theme-primary cursor-pointer",onClick:s,children:[(0,n.jsx)(el.Z,{className:"mr-1"}),i.template_introduce||"More Details"]})]}),f&&"string"==typeof i&&(0,n.jsx)(K.Z,{components:{...Q.ZP,...h},...Q.dx,children:(0,Q.CE)(ed(p))}),!!(null==g?void 0:g.length)&&(0,n.jsx)("div",{className:"flex flex-wrap mt-2",children:null==g?void 0:g.map((e,o)=>(0,n.jsx)(es.Z,{color:"#108ee9",children:e},e+o))})]}),o]}):(0,n.jsx)("div",{className:"h-12"})}),eu=t(67204),em=t(32837),ef=t(22546),eg=t(13806),ep=t(71816),ev=t(46742),eh=t(99406),ex=t(71838),ek=t(20175),eb=t(91279),ej=t(76676),ey=t(49692),e_=t(14937),ew=t(20001),eS=t(16637),eN=e=>{var o;let{conv_index:t,question:s,knowledge_space:a,select_param:i}=e,{t:d}=(0,Z.$G)(),{chatId:c}=(0,m.useContext)(r.p),[u,f]=(0,m.useState)(""),[g,p]=(0,m.useState)(4),[v,h]=(0,m.useState)(""),x=(0,m.useRef)(null),[_,w]=j.ZP.useMessage(),S=(0,m.useCallback)((e,o)=>{o?(0,l.Vx)((0,l.Eb)(c,t)).then(e=>{var o,t,n,r;let l=null!==(o=e[1])&&void 0!==o?o:{};f(null!==(t=l.ques_type)&&void 0!==t?t:""),p(parseInt(null!==(n=l.score)&&void 0!==n?n:"4")),h(null!==(r=l.messages)&&void 0!==r?r:"")}).catch(e=>{console.log(e)}):(f(""),p(4),h(""))},[c,t]),N=(0,ef.Z)(eg.Z)(e=>{let{theme:o}=e;return{backgroundColor:"dark"===o.palette.mode?"#FBFCFD":"#0E0E10",...o.typography["body-sm"],padding:o.spacing(1),display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,width:"100%",height:"100%"}});return(0,n.jsxs)(ep.L,{onOpenChange:S,children:[w,(0,n.jsx)(y.Z,{title:d("Rating"),children:(0,n.jsx)(ev.Z,{slots:{root:b.ZP},slotProps:{root:{variant:"plain",color:"primary"}},sx:{borderRadius:40},children:(0,n.jsx)(eu.Z,{})})}),(0,n.jsxs)(eh.Z,{children:[(0,n.jsx)(ex.Z,{disabled:!0,sx:{minHeight:0}}),(0,n.jsx)(ek.Z,{sx:{width:"100%",maxWidth:350,display:"grid",gap:3,padding:1},children:(0,n.jsx)("form",{onSubmit:e=>{e.preventDefault(),(0,l.Vx)((0,l.VC)({data:{conv_uid:c,conv_index:t,question:s,knowledge_space:a,score:g,ques_type:u,messages:v}})).then(e=>{_.open({type:"success",content:"save success"})}).catch(e=>{_.open({type:"error",content:"save error"})})},children:(0,n.jsxs)(eb.Z,{container:!0,spacing:.5,columns:13,sx:{flexGrow:1},children:[(0,n.jsx)(eb.Z,{xs:3,children:(0,n.jsx)(N,{children:d("Q_A_Category")})}),(0,n.jsx)(eb.Z,{xs:10,children:(0,n.jsx)(ej.Z,{action:x,value:u,placeholder:"Choose one…",onChange:(e,o)=>f(null!=o?o:""),...u&&{endDecorator:(0,n.jsx)(b.ZP,{size:"sm",variant:"plain",color:"neutral",onMouseDown:e=>{e.stopPropagation()},onClick:()=>{var e;f(""),null===(e=x.current)||void 0===e||e.focusVisible()},children:(0,n.jsx)(em.Z,{})}),indicator:null},sx:{width:"100%"},children:i&&(null===(o=Object.keys(i))||void 0===o?void 0:o.map(e=>(0,n.jsx)(ey.Z,{value:e,children:i[e]},e)))})}),(0,n.jsx)(eb.Z,{xs:3,children:(0,n.jsx)(N,{children:(0,n.jsx)(y.Z,{title:(0,n.jsx)(ek.Z,{children:(0,n.jsx)("div",{children:d("feed_back_desc")})}),variant:"solid",placement:"left",children:d("Q_A_Rating")})})}),(0,n.jsx)(eb.Z,{xs:10,sx:{pl:0,ml:0},children:(0,n.jsx)(e_.Z,{"aria-label":"Custom",step:1,min:0,max:5,valueLabelFormat:function(e){return({0:d("Lowest"),1:d("Missed"),2:d("Lost"),3:d("Incorrect"),4:d("Verbose"),5:d("Best")})[e]},valueLabelDisplay:"on",marks:[{value:0,label:"0"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"},{value:5,label:"5"}],sx:{width:"90%",pt:3,m:2,ml:1},onChange:e=>{var o;return p(null===(o=e.target)||void 0===o?void 0:o.value)},value:g})}),(0,n.jsx)(eb.Z,{xs:13,children:(0,n.jsx)(ew.Z,{placeholder:d("Please_input_the_text"),value:v,onChange:e=>h(e.target.value),minRows:2,maxRows:4,endDecorator:(0,n.jsx)(eS.ZP,{level:"body-xs",sx:{ml:"auto"},children:d("input_count")+v.length+d("input_unit")}),sx:{width:"100%",fontSize:14}})}),(0,n.jsx)(eb.Z,{xs:13,children:(0,n.jsx)(k.Z,{type:"submit",variant:"outlined",sx:{width:"100%",height:"100%"},children:d("submit")})})]})})})]})]})},eZ=t(421),eC=e=>{var o,t;let{messages:s,onSubmit:d,onFormatContent:f}=e,{dbParam:p,currentDialogue:w,scene:C,model:P,refreshDialogList:M,chatId:D,agent:R,docId:E}=(0,m.useContext)(r.p),{t:O}=(0,Z.$G)(),T=(0,u.useSearchParams)(),F=null!==(o=T&&T.get("select_param"))&&void 0!==o?o:"",I=null!==(t=T&&T.get("spaceNameOriginal"))&&void 0!==t?t:"",[H,V]=(0,m.useState)(!1),[W,A]=(0,m.useState)(!1),[L,U]=(0,m.useState)(s),[q,B]=(0,m.useState)(""),[$,z]=(0,m.useState)(),J=(0,m.useRef)(null),K=(0,m.useMemo)(()=>"chat_dashboard"===C,[C]),Q=v(),Y=(0,m.useMemo)(()=>{switch(C){case"chat_agent":return R;case"chat_excel":return null==w?void 0:w.select_param;case"chat_flow":return F;default:return I||p}},[C,R,w,p,I,F]),ee=async e=>{if(!H&&e.trim()){if("chat_agent"===C&&!R){j.ZP.warning(O("choice_agent_tip"));return}try{V(!0),await d(e,{select_param:null!=Y?Y:""})}finally{V(!1)}}},eo=e=>K&&f&&"string"==typeof e?f(e):e,[et,en]=j.ZP.useMessage(),er=async e=>{let o=K&&f&&"string"==typeof e?f(e):e,t=null==o?void 0:o.replace(/\trelations:.*/g,""),n=S()(t);n?t?et.open({type:"success",content:O("copy_success")}):et.open({type:"warning",content:O("copy_nothing")}):et.open({type:"error",content:O("copy_failed")})},el=async()=>{!H&&E&&(V(!0),await Q(E),V(!1))};return(0,i.Z)(async()=>{let e=(0,a.a_)();e&&e.id===D&&(await ee(e.message),M(),localStorage.removeItem(a.rU))},[D]),(0,m.useEffect)(()=>{let e=s;K&&(e=(0,N.cloneDeep)(s).map(e=>{if((null==e?void 0:e.role)==="view"&&"string"==typeof(null==e?void 0:e.context))try{e.context=JSON.parse(e.context)}catch(o){f&&(e.context=eo(e.context))}return e})),U(e.filter(e=>["view","human"].includes(e.role)))},[K,s,f]),(0,m.useEffect)(()=>{(0,l.Vx)((0,l.Lu)()).then(e=>{var o;z(null!==(o=e[1])&&void 0!==o?o:{})}).catch(e=>{console.log(e)})},[]),(0,m.useEffect)(()=>{setTimeout(()=>{var e;null===(e=J.current)||void 0===e||e.scrollTo(0,J.current.scrollHeight)},50)},[s]),(0,n.jsxs)(n.Fragment,{children:[en,(0,n.jsx)("div",{ref:J,className:"flex flex-1 overflow-y-auto h-full w-full flex-col",children:(0,n.jsx)("div",{className:"flex items-center flex-1 flex-col text-sm leading-6 text-slate-900 dark:text-slate-300 sm:text-base sm:leading-7",children:L.length?L.map((e,o)=>{var t;return"chat_agent"===C?(0,n.jsx)(X,{content:e},o):(0,n.jsx)(ec,{content:e,isChartChat:K,onLinkClick:()=>{A(!0),B(JSON.stringify(null==e?void 0:e.context,null,2))},children:"view"===e.role&&(0,n.jsxs)("div",{className:"flex w-full border-t border-gray-200 dark:border-theme-dark",children:["chat_knowledge"===C&&e.retry?(0,n.jsxs)(k.Z,{onClick:el,slots:{root:b.ZP},slotProps:{root:{variant:"plain",color:"primary"}},children:[(0,n.jsx)(h.Z,{}),"\xa0",(0,n.jsx)("span",{className:"text-sm",children:O("Retry")})]}):null,(0,n.jsxs)("div",{className:"flex w-full flex-row-reverse",children:[(0,n.jsx)(eN,{select_param:$,conv_index:Math.ceil((o+1)/2),question:null===(t=null==L?void 0:L.filter(o=>(null==o?void 0:o.role)==="human"&&(null==o?void 0:o.order)===e.order)[0])||void 0===t?void 0:t.context,knowledge_space:I||p||""}),(0,n.jsx)(y.Z,{title:O("Copy_Btn"),children:(0,n.jsx)(k.Z,{onClick:()=>er(null==e?void 0:e.context),slots:{root:b.ZP},slotProps:{root:{variant:"plain",color:"primary"}},sx:{borderRadius:40},children:(0,n.jsx)(x.Z,{})})})]})]})},o)}):(0,n.jsx)(g.Z,{description:"Start a conversation"})})}),(0,n.jsx)("div",{className:c()("relative sticky bottom-0 bg-theme-light dark:bg-theme-dark after:absolute after:-top-8 after:h-8 after:w-full after:bg-gradient-to-t after:from-theme-light after:to-transparent dark:after:from-theme-dark",{"cursor-not-allowed":"chat_excel"===C&&!(null==w?void 0:w.select_param)}),children:(0,n.jsxs)("div",{className:"flex flex-wrap w-full py-2 sm:pt-6 sm:pb-10 items-center",children:[P&&(0,n.jsx)("div",{className:"mr-2 flex",children:(0,ea.A)(P)}),(0,n.jsx)(G,{loading:H,onSubmit:ee,handleFinish:V})]})}),(0,n.jsx)(_.default,{title:"JSON Editor",open:W,width:"60%",cancelButtonProps:{hidden:!0},onOk:()=>{A(!1)},onCancel:()=>{A(!1)},children:(0,n.jsx)(eZ.Z,{className:"w-full h-[500px]",language:"json",value:q})})]})},eP=t(45374);let eM=e=>{if("string"!=typeof e)return e;if(e.startsWith("```vis-thinking")||e.includes("```vis-thinking")){let o=e.indexOf('{"');if(-1!==o){let t=e.substring(o);try{return JSON.parse(t)}catch(o){let e=t.replace(/```$/g,"").trim();try{return JSON.parse(e)}catch(e){return console.error("Error parsing cleaned JSON:",e),null}}}}try{return"string"==typeof e?JSON.parse(e):e}catch(o){return console.log("Not JSON format or vis-thinking format, returning original content"),e}},eD=e=>{if("string"!=typeof e)return e;if(e.startsWith("```vis-thinking")||e.includes("```vis-thinking")){let o=e.indexOf("```vis-thinking"),t=o+15,n=e.indexOf("```",t);if(-1!==n)return e.substring(o,n+3)}return e};var eR=()=>{var e;let o=(0,u.useSearchParams)(),{scene:t,chatId:d,model:v,agent:h,setModel:x,history:k,setHistory:b}=(0,m.useContext)(r.p),{chat:j}=(0,s.Z)({}),y=null!==(e=o&&o.get("initMessage"))&&void 0!==e?e:"",[_,w]=(0,m.useState)(!1),[S,N]=(0,m.useState)(),Z=async()=>{w(!0);let[,e]=await (0,l.Vx)((0,l.$i)(d));b(null!=e?e:[]),w(!1)},C=e=>{var o;let t=null===(o=e[e.length-1])||void 0===o?void 0:o.context;if(t)try{let e=eM(t),o="object"==typeof e?e:"string"==typeof t?JSON.parse(t):t;N((null==o?void 0:o.template_name)==="report"?null==o?void 0:o.charts:void 0)}catch(e){console.log(e),N([])}};(0,i.Z)(async()=>{let e=(0,a.a_)();e&&e.id===d||await Z()},[y,d]),(0,m.useEffect)(()=>{var e,o;if(!k.length)return;let t=null===(e=null===(o=k.filter(e=>"view"===e.role))||void 0===o?void 0:o.slice(-1))||void 0===e?void 0:e[0];(null==t?void 0:t.model_name)&&x(t.model_name),C(k)},[k.length]),(0,m.useEffect)(()=>()=>{b([])},[]);let P=(0,m.useCallback)((e,o)=>new Promise(n=>{let r=[...k,{role:"human",context:e,model_name:v,order:0,time_stamp:0},{role:"view",context:"",model_name:v,order:0,time_stamp:0}],l=r.length-1;b([...r]),j({data:{...o,chat_mode:t||"chat_normal",model_name:v,user_input:e},chatId:d,onMessage:e=>{(null==o?void 0:o.incremental)?r[l].context+=e:r[l].context=e,b([...r])},onDone:()=>{C(r),n()},onClose:()=>{C(r),n()},onError:e=>{r[l].context=e,b([...r]),n()}})}),[k,j,d,v,h,t]);return(0,n.jsxs)("div",{className:"flex flex-col h-screen w-full overflow-hidden",children:[(0,n.jsx)(p.Z,{visible:_}),(0,n.jsx)("div",{className:"flex-none",children:(0,n.jsx)(eP.Z,{refreshHistory:Z,modelChange:e=>{x(e)}})}),(0,n.jsxs)("div",{className:"flex-auto flex overflow-hidden",children:[!!(null==S?void 0:S.length)&&(0,n.jsx)("div",{className:c()("overflow-auto",{"w-full h-1/2 md:h-full md:w-3/4 pb-4 md:pr-4":"chat_dashboard"===t}),children:(0,n.jsx)(f.ZP,{chartsData:S})}),!(null==S?void 0:S.length)&&"chat_dashboard"===t&&(0,n.jsx)("div",{className:c()("flex items-center justify-center",{"w-full h-1/2 md:h-full md:w-3/4":"chat_dashboard"===t}),children:(0,n.jsx)(g.Z,{})}),(0,n.jsx)("div",{className:c()("flex flex-col overflow-hidden",{"w-full h-1/2 md:h-full md:w-1/4 border-t md:border-t-0 md:border-l dark:border-gray-800":"chat_dashboard"===t,"w-full h-full px-4 lg:px-8":"chat_dashboard"!==t}),children:(0,n.jsx)("div",{className:"h-full overflow-hidden",children:(0,n.jsx)(eC,{messages:k,onSubmit:P,onFormatContent:eD})})})]})]})}},45374:function(e,o,t){"use strict";t.d(o,{Z:function(){return D}});var n=t(52676),r=t(40330),l=t(21667),s=t(65483),a=t(32106),i=t(37441),d=t(21309),c=t(75271);function u(){let{isContract:e,setIsContract:o,scene:t}=(0,c.useContext)(r.p),l=t&&["chat_with_db_execute","chat_dashboard"].includes(t);return l?(0,n.jsxs)(d.ZP.Group,{value:e,defaultValue:!0,buttonStyle:"solid",onChange:()=>{o(!e)},children:[(0,n.jsxs)(d.ZP.Button,{value:!1,children:[(0,n.jsx)(a.Z,{component:s.ig,className:"mr-1"}),"Preview"]}),(0,n.jsxs)(d.ZP.Button,{value:!0,children:[(0,n.jsx)(i.Z,{className:"mr-1"}),"Editor"]})]}):null}t(51083);var m=t(63384),f=t(58976),g=t(44745),p=t(6821),v=function(){let{t:e}=(0,p.$G)(),{agent:o,setAgent:t}=(0,c.useContext)(r.p),{data:l=[]}=(0,f.Z)(async()=>{let[,e]=await (0,m.Vx)((0,m.H4)());return null!=e?e:[]});return(0,n.jsx)(g.default,{className:"w-60",value:o,placeholder:e("Select_Plugins"),options:l.map(e=>({label:e.app_name,value:e.app_code})),allowClear:!0,onChange:e=>{null==t||t(e)}})},h=t(23455),x=t(15543),k=t(97022),b=t(98868),j=t(83803),y=t(47266),_=t(29144),w=t(25433),S=function(e){var o;let{convUid:t,chatMode:l,onComplete:s,...a}=e,[i,d]=(0,c.useState)(!1),[u,f]=j.ZP.useMessage(),[g,p]=(0,c.useState)([]),[v,S]=(0,c.useState)(),{model:N}=(0,c.useContext)(r.p),{temperatureValue:Z,maxNewTokensValue:C}=(0,c.useContext)(x.ChatContentContext),P=async e=>{var o;if(!e){j.ZP.error("Please select the *.(csv|xlsx|xls) file");return}if(!/\.(csv|xlsx|xls)$/.test(null!==(o=e.file.name)&&void 0!==o?o:"")){j.ZP.error("File type must be csv, xlsx or xls");return}p([e.file])},M=async()=>{d(!0);try{let e=new FormData;e.append("doc_file",g[0]),u.open({content:"Uploading ".concat(g[0].name),type:"loading",duration:0});let[o]=await (0,m.Vx)((0,m.qn)({convUid:t,chatMode:l,data:e,model:N,temperatureValue:Z,maxNewTokensValue:C,config:{timeout:36e5,onUploadProgress:e=>{let o=Math.ceil(e.loaded/(e.total||0)*100);S(o)}}}));if(o)return;j.ZP.success("success"),null==s||s()}catch(e){j.ZP.error((null==e?void 0:e.message)||"Upload Error")}finally{d(!1),u.destroy()}};return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[f,(0,n.jsx)(y.Z,{placement:"bottom",title:"File cannot be changed after upload",children:(0,n.jsx)(_.default,{disabled:i,className:"mr-1",beforeUpload:()=>!1,fileList:g,name:"file",accept:".csv,.xlsx,.xls",multiple:!1,onChange:P,showUploadList:{showDownloadIcon:!1,showPreviewIcon:!1,showRemoveIcon:!1},itemRender:()=>(0,n.jsx)(n.Fragment,{}),...a,children:(0,n.jsx)(w.ZP,{className:"flex justify-center items-center",type:"primary",disabled:i,icon:(0,n.jsx)(k.Z,{}),children:"Select File"})})}),(0,n.jsx)(w.ZP,{type:"primary",loading:i,className:"flex justify-center items-center",disabled:!g.length,icon:(0,n.jsx)(b.Z,{}),onClick:M,children:i?100===v?"Analysis":"Uploading":"Upload"}),!!g.length&&(0,n.jsxs)("div",{className:"mt-2 text-gray-500 text-sm flex items-center",onClick:()=>p([]),children:[(0,n.jsx)(h.Z,{className:"mr-2"}),(0,n.jsx)("span",{children:null===(o=g[0])||void 0===o?void 0:o.name})]})]})})},N=function(e){let{onComplete:o}=e,{currentDialogue:t,scene:l,chatId:s}=(0,c.useContext)(r.p);return"chat_excel"!==l?null:(0,n.jsx)("div",{className:"max-w-md h-full relative",children:t?(0,n.jsxs)("div",{className:"flex h-8 overflow-hidden rounded",children:[(0,n.jsx)("div",{className:"flex items-center justify-center px-2 bg-gray-600 text-lg",children:(0,n.jsx)(h.Z,{className:"text-white"})}),(0,n.jsx)("div",{className:"flex items-center justify-center px-3 bg-gray-100 text-xs rounded-tr rounded-br dark:text-gray-800 truncate",children:t.select_param})]}):(0,n.jsx)(S,{convUid:s,chatMode:l,onComplete:o})})},Z=t(87213),C=t(51921),P=t(8869),M=function(){let{scene:e,dbParam:o,setDbParam:t}=(0,c.useContext)(r.p),[l,s]=(0,c.useState)([]);(0,P.Z)(async()=>{let[,o]=await (0,m.Vx)((0,m.vD)(e));s(null!=o?o:[])},[e]);let a=(0,c.useMemo)(()=>{var e;return null===(e=l.map)||void 0===e?void 0:e.call(l,e=>({name:e.param,...C.S$[e.type]}))},[l]);return((0,c.useEffect)(()=>{(null==a?void 0:a.length)&&!o&&t(a[0].name)},[a,t,o]),null==a?void 0:a.length)?(0,n.jsx)(g.default,{value:o,className:"w-36",onChange:e=>{t(e)},children:a.map(e=>(0,n.jsxs)(g.default.Option,{children:[(0,n.jsx)(Z.Z,{width:24,height:24,src:e.icon,label:e.label,className:"w-[1.5em] h-[1.5em] mr-1 inline-block mt-[-4px]"}),e.name]},e.name))}):null},D=function(e){let{refreshHistory:o,modelChange:t}=e,{scene:s,refreshDialogList:a}=(0,c.useContext)(r.p);return(0,n.jsxs)("div",{className:"w-full py-2 px-4 md:px-4 flex flex-wrap items-center justify-center gap-1 md:gap-4",children:[(0,n.jsx)(l.Z,{onChange:t}),(0,n.jsx)(M,{}),"chat_excel"===s&&(0,n.jsx)(N,{onComplete:()=>{null==a||a(),null==o||o()}}),"chat_agent"===s&&(0,n.jsx)(v,{}),(0,n.jsx)(u,{})]})}},21667:function(e,o,t){"use strict";t.d(o,{A:function(){return m}});var n=t(52676),r=t(40330),l=t(22877),s=t(44745),a=t(97858),i=t.n(a),d=t(75271),c=t(6821);let u="/models/huggingface.svg";function m(e,o){var t,r;let{width:s,height:a}=o||{};return e?(0,n.jsx)(i(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:s||24,height:a||24,src:(null===(t=l.Hf[e])||void 0===t?void 0:t.icon)||u,alt:"llm"},(null===(r=l.Hf[e])||void 0===r?void 0:r.icon)||u):null}o.Z=function(e){let{onChange:o}=e,{t}=(0,c.$G)(),{modelList:a,model:i}=(0,d.useContext)(r.p);return!a||a.length<=0?null:(0,n.jsx)(s.default,{value:i,placeholder:t("choose_model"),className:"w-52",onChange:e=>{null==o||o(e)},children:a.map(e=>{var o;return(0,n.jsx)(s.default.Option,{children:(0,n.jsxs)("div",{className:"flex items-center",children:[m(e),(0,n.jsx)("span",{className:"ml-2",children:(null===(o=l.Hf[e])||void 0===o?void 0:o.label)||e})]})},e)})})}},421:function(e,o,t){"use strict";let n;t.d(o,{Z:function(){return g}});var r=t(52676),l=t(40330),s=t(51921),a=t(62552),i=t(10159),d=t(82187),c=t.n(d),u=t(37257),m=t(75271);async function f(){window.obMonaco={getWorkerUrl:e=>{switch(e){case"mysql":return location.origin+"/_next/static/ob-workers/mysql.js";case"obmysql":return location.origin+"/_next/static/ob-workers/obmysql.js";case"oboracle":return location.origin+"/_next/static/ob-workers/oracle.js"}return""}};let e=await t.e(5321).then(t.bind(t,65321)),o=e.default;return n||(n=new o).setup(["mysql"]),n}function g(e){let{className:o,value:t,language:n="mysql",onChange:d,thoughts:u,session:g}=e,p=(0,m.useMemo)(()=>"mysql"!==n?t:u&&u.length>0?(0,s._m)("-- ".concat(u," \n").concat(t)):(0,s._m)(t),[t,u]),v=(0,i.Z)(g),h=(0,m.useContext)(l.p);async function x(e){var o,t;let n=await f();n.setModelOptions((null===(o=e.getModel())||void 0===o?void 0:o.id)||"",function(e,o){let{_modelId:t,delimiter:n}=e;return{delimiter:n,async getTableList(e){var t;return(null==o?void 0:null===(t=o())||void 0===t?void 0:t.getTableList(e))||[]},async getTableColumns(e,t){var n;return(null==o?void 0:null===(n=o())||void 0===n?void 0:n.getTableColumns(e))||[]},async getSchemaList(){var e;return(null==o?void 0:null===(e=o())||void 0===e?void 0:e.getSchemaList())||[]}}}({modelId:(null===(t=e.getModel())||void 0===t?void 0:t.id)||"",delimiter:";"},()=>v.current||null))}return(0,r.jsx)(a.ZP,{className:c()(o),onMount:x,value:p,defaultLanguage:n,onChange:d,theme:(null==h?void 0:h.mode)!=="dark"?"github":"githubDark",options:{minimap:{enabled:!1},wordWrap:"on"}})}a._m.config({monaco:u}),u.editor.defineTheme("github",{base:"vs",inherit:!0,rules:[{background:"ffffff",token:""},{foreground:"6a737d",token:"comment"},{foreground:"6a737d",token:"punctuation.definition.comment"},{foreground:"6a737d",token:"string.comment"},{foreground:"005cc5",token:"constant"},{foreground:"005cc5",token:"entity.name.constant"},{foreground:"005cc5",token:"variable.other.constant"},{foreground:"005cc5",token:"variable.language"},{foreground:"6f42c1",token:"entity"},{foreground:"6f42c1",token:"entity.name"},{foreground:"24292e",token:"variable.parameter.function"},{foreground:"22863a",token:"entity.name.tag"},{foreground:"d73a49",token:"keyword"},{foreground:"d73a49",token:"storage"},{foreground:"d73a49",token:"storage.type"},{foreground:"24292e",token:"storage.modifier.package"},{foreground:"24292e",token:"storage.modifier.import"},{foreground:"24292e",token:"storage.type.java"},{foreground:"032f62",token:"string"},{foreground:"032f62",token:"punctuation.definition.string"},{foreground:"032f62",token:"string punctuation.section.embedded source"},{foreground:"005cc5",token:"support"},{foreground:"005cc5",token:"meta.property-name"},{foreground:"e36209",token:"variable"},{foreground:"24292e",token:"variable.other"},{foreground:"b31d28",fontStyle:"bold italic underline",token:"invalid.broken"},{foreground:"b31d28",fontStyle:"bold italic underline",token:"invalid.deprecated"},{foreground:"fafbfc",background:"b31d28",fontStyle:"italic underline",token:"invalid.illegal"},{foreground:"fafbfc",background:"d73a49",fontStyle:"italic underline",token:"carriage-return"},{foreground:"b31d28",fontStyle:"bold italic underline",token:"invalid.unimplemented"},{foreground:"b31d28",token:"message.error"},{foreground:"24292e",token:"string source"},{foreground:"005cc5",token:"string variable"},{foreground:"032f62",token:"source.regexp"},{foreground:"032f62",token:"string.regexp"},{foreground:"032f62",token:"string.regexp.character-class"},{foreground:"032f62",token:"string.regexp constant.character.escape"},{foreground:"032f62",token:"string.regexp source.ruby.embedded"},{foreground:"032f62",token:"string.regexp string.regexp.arbitrary-repitition"},{foreground:"22863a",fontStyle:"bold",token:"string.regexp constant.character.escape"},{foreground:"005cc5",token:"support.constant"},{foreground:"005cc5",token:"support.variable"},{foreground:"005cc5",token:"meta.module-reference"},{foreground:"735c0f",token:"markup.list"},{foreground:"005cc5",fontStyle:"bold",token:"markup.heading"},{foreground:"005cc5",fontStyle:"bold",token:"markup.heading entity.name"},{foreground:"22863a",token:"markup.quote"},{foreground:"24292e",fontStyle:"italic",token:"markup.italic"},{foreground:"24292e",fontStyle:"bold",token:"markup.bold"},{foreground:"005cc5",token:"markup.raw"},{foreground:"b31d28",background:"ffeef0",token:"markup.deleted"},{foreground:"b31d28",background:"ffeef0",token:"meta.diff.header.from-file"},{foreground:"b31d28",background:"ffeef0",token:"punctuation.definition.deleted"},{foreground:"22863a",background:"f0fff4",token:"markup.inserted"},{foreground:"22863a",background:"f0fff4",token:"meta.diff.header.to-file"},{foreground:"22863a",background:"f0fff4",token:"punctuation.definition.inserted"},{foreground:"e36209",background:"ffebda",token:"markup.changed"},{foreground:"e36209",background:"ffebda",token:"punctuation.definition.changed"},{foreground:"f6f8fa",background:"005cc5",token:"markup.ignored"},{foreground:"f6f8fa",background:"005cc5",token:"markup.untracked"},{foreground:"6f42c1",fontStyle:"bold",token:"meta.diff.range"},{foreground:"005cc5",token:"meta.diff.header"},{foreground:"005cc5",fontStyle:"bold",token:"meta.separator"},{foreground:"005cc5",token:"meta.output"},{foreground:"586069",token:"brackethighlighter.tag"},{foreground:"586069",token:"brackethighlighter.curly"},{foreground:"586069",token:"brackethighlighter.round"},{foreground:"586069",token:"brackethighlighter.square"},{foreground:"586069",token:"brackethighlighter.angle"},{foreground:"586069",token:"brackethighlighter.quote"},{foreground:"b31d28",token:"brackethighlighter.unmatched"},{foreground:"b31d28",token:"sublimelinter.mark.error"},{foreground:"e36209",token:"sublimelinter.mark.warning"},{foreground:"959da5",token:"sublimelinter.gutter-mark"},{foreground:"032f62",fontStyle:"underline",token:"constant.other.reference.link"},{foreground:"032f62",fontStyle:"underline",token:"string.other.link"}],colors:{"editor.foreground":"#24292e","editor.background":"#ffffff","editor.selectionBackground":"#c8c8fa","editor.inactiveSelectionBackground":"#fafbfc","editor.lineHighlightBackground":"#fafbfc","editorCursor.foreground":"#24292e","editorWhitespace.foreground":"#959da5","editorIndentGuide.background":"#959da5","editorIndentGuide.activeBackground":"#24292e","editor.selectionHighlightBorder":"#fafbfc"}}),u.editor.defineTheme("githubDark",{base:"vs-dark",inherit:!0,rules:[{background:"24292e",token:""},{foreground:"959da5",token:"comment"},{foreground:"959da5",token:"punctuation.definition.comment"},{foreground:"959da5",token:"string.comment"},{foreground:"c8e1ff",token:"constant"},{foreground:"c8e1ff",token:"entity.name.constant"},{foreground:"c8e1ff",token:"variable.other.constant"},{foreground:"c8e1ff",token:"variable.language"},{foreground:"b392f0",token:"entity"},{foreground:"b392f0",token:"entity.name"},{foreground:"f6f8fa",token:"variable.parameter.function"},{foreground:"7bcc72",token:"entity.name.tag"},{foreground:"ea4a5a",token:"keyword"},{foreground:"ea4a5a",token:"storage"},{foreground:"ea4a5a",token:"storage.type"},{foreground:"f6f8fa",token:"storage.modifier.package"},{foreground:"f6f8fa",token:"storage.modifier.import"},{foreground:"f6f8fa",token:"storage.type.java"},{foreground:"79b8ff",token:"string"},{foreground:"79b8ff",token:"punctuation.definition.string"},{foreground:"79b8ff",token:"string punctuation.section.embedded source"},{foreground:"c8e1ff",token:"support"},{foreground:"c8e1ff",token:"meta.property-name"},{foreground:"fb8532",token:"variable"},{foreground:"f6f8fa",token:"variable.other"},{foreground:"d73a49",fontStyle:"bold italic underline",token:"invalid.broken"},{foreground:"d73a49",fontStyle:"bold italic underline",token:"invalid.deprecated"},{foreground:"fafbfc",background:"d73a49",fontStyle:"italic underline",token:"invalid.illegal"},{foreground:"fafbfc",background:"d73a49",fontStyle:"italic underline",token:"carriage-return"},{foreground:"d73a49",fontStyle:"bold italic underline",token:"invalid.unimplemented"},{foreground:"d73a49",token:"message.error"},{foreground:"f6f8fa",token:"string source"},{foreground:"c8e1ff",token:"string variable"},{foreground:"79b8ff",token:"source.regexp"},{foreground:"79b8ff",token:"string.regexp"},{foreground:"79b8ff",token:"string.regexp.character-class"},{foreground:"79b8ff",token:"string.regexp constant.character.escape"},{foreground:"79b8ff",token:"string.regexp source.ruby.embedded"},{foreground:"79b8ff",token:"string.regexp string.regexp.arbitrary-repitition"},{foreground:"7bcc72",fontStyle:"bold",token:"string.regexp constant.character.escape"},{foreground:"c8e1ff",token:"support.constant"},{foreground:"c8e1ff",token:"support.variable"},{foreground:"c8e1ff",token:"meta.module-reference"},{foreground:"fb8532",token:"markup.list"},{foreground:"0366d6",fontStyle:"bold",token:"markup.heading"},{foreground:"0366d6",fontStyle:"bold",token:"markup.heading entity.name"},{foreground:"c8e1ff",token:"markup.quote"},{foreground:"f6f8fa",fontStyle:"italic",token:"markup.italic"},{foreground:"f6f8fa",fontStyle:"bold",token:"markup.bold"},{foreground:"c8e1ff",token:"markup.raw"},{foreground:"b31d28",background:"ffeef0",token:"markup.deleted"},{foreground:"b31d28",background:"ffeef0",token:"meta.diff.header.from-file"},{foreground:"b31d28",background:"ffeef0",token:"punctuation.definition.deleted"},{foreground:"176f2c",background:"f0fff4",token:"markup.inserted"},{foreground:"176f2c",background:"f0fff4",token:"meta.diff.header.to-file"},{foreground:"176f2c",background:"f0fff4",token:"punctuation.definition.inserted"},{foreground:"b08800",background:"fffdef",token:"markup.changed"},{foreground:"b08800",background:"fffdef",token:"punctuation.definition.changed"},{foreground:"2f363d",background:"959da5",token:"markup.ignored"},{foreground:"2f363d",background:"959da5",token:"markup.untracked"},{foreground:"b392f0",fontStyle:"bold",token:"meta.diff.range"},{foreground:"c8e1ff",token:"meta.diff.header"},{foreground:"0366d6",fontStyle:"bold",token:"meta.separator"},{foreground:"0366d6",token:"meta.output"},{foreground:"ffeef0",token:"brackethighlighter.tag"},{foreground:"ffeef0",token:"brackethighlighter.curly"},{foreground:"ffeef0",token:"brackethighlighter.round"},{foreground:"ffeef0",token:"brackethighlighter.square"},{foreground:"ffeef0",token:"brackethighlighter.angle"},{foreground:"ffeef0",token:"brackethighlighter.quote"},{foreground:"d73a49",token:"brackethighlighter.unmatched"},{foreground:"d73a49",token:"sublimelinter.mark.error"},{foreground:"fb8532",token:"sublimelinter.mark.warning"},{foreground:"6a737d",token:"sublimelinter.gutter-mark"},{foreground:"79b8ff",fontStyle:"underline",token:"constant.other.reference.link"},{foreground:"79b8ff",fontStyle:"underline",token:"string.other.link"}],colors:{"editor.foreground":"#f6f8fa","editor.background":"#24292e","editor.selectionBackground":"#4c2889","editor.inactiveSelectionBackground":"#444d56","editor.lineHighlightBackground":"#444d56","editorCursor.foreground":"#ffffff","editorWhitespace.foreground":"#6a737d","editorIndentGuide.background":"#6a737d","editorIndentGuide.activeBackground":"#f6f8fa","editor.selectionHighlightBorder":"#444d56"}})},14425:function(e,o,t){"use strict";var n=t(52676),r=t(39457),l=t(25433),s=t(82187),a=t.n(s),i=t(6821);o.Z=function(e){let{className:o,error:t,description:s,refresh:d}=e,{t:c}=(0,i.$G)();return(0,n.jsx)(r.Z,{image:"/empty.png",imageStyle:{width:320,height:196,margin:"0 auto",maxWidth:"100%",maxHeight:"100%"},className:a()("flex items-center justify-center flex-col h-full w-full",o),description:t?(0,n.jsx)(l.ZP,{type:"primary",onClick:d,children:c("try_again")}):null!=s?s:c("no_data")})}},87213:function(e,o,t){"use strict";var n=t(52676),r=t(97858),l=t.n(r);o.Z=function(e){let{src:o,label:t,width:r,height:s,className:a}=e;return(0,n.jsx)(l(),{className:"w-11 h-11 rounded-full mr-4 border border-gray-200 object-contain bg-white ".concat(a),width:r||44,height:s||44,src:o,alt:t||"db-icon"})}},99532:function(e,o,t){"use strict";var n=t(52676),r=t(79312);o.Z=function(e){let{visible:o}=e;return o?(0,n.jsx)("div",{className:"absolute w-full h-full top-0 left-0 flex justify-center items-center z-10 bg-white dark:bg-black bg-opacity-50 dark:bg-opacity-50 backdrop-blur-sm text-3xl animate-fade animate-duration-200",children:(0,n.jsx)(r.Z,{})}):null}},76657:function(e,o,t){"use strict";var n=t(14059);o.Z=()=>{var e;return JSON.parse(null!==(e=localStorage.getItem(n.C9))&&void 0!==e?e:"")}},46501:function(e,o,t){"use strict";var n=t(52676),r=t(22877),l=t(97858),s=t.n(l),a=t(75271);o.Z=(0,a.memo)(e=>{let{width:o,height:t,model:l}=e,i=(0,a.useMemo)(()=>(0,r.ab)(l||"huggingface"),[l]);return l?(0,n.jsx)(s(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:o||24,height:t||24,src:i,alt:"llm",priority:!0}):null})},14113:function(e,o,t){"use strict";t.r(o);var n=t(52676),r=t(270),l=t(55391),s=t(2148),a=t(92157),i=t(874),d=t.n(i),c=t(75271),u=t(21201);o.default=(0,c.memo)(()=>{var e;let{appInfo:o}=(0,c.useContext)(u.MobileChatContext),{message:t}=s.Z.useApp(),[i,m]=(0,c.useState)(0);if(!(null==o?void 0:o.app_code))return null;let f=async()=>{let e=d()("dingtalk://dingtalkclient/page/link?url=".concat(encodeURIComponent(location.href),"&pc_slide=true"));t[e?"success":"error"](e?"复制成功":"复制失败")};return i>6&&t.info(JSON.stringify(window.navigator.userAgent),2,()=>{m(0)}),(0,n.jsxs)("header",{className:"flex w-full items-center justify-between bg-[rgba(255,255,255,0.9)] border dark:bg-black dark:border-[rgba(255,255,255,0.6)] rounded-xl mx-auto px-4 py-2 mb-4 sticky top-4 z-50 mt-4 shadow-md",children:[(0,n.jsxs)("div",{className:"flex gap-2 items-center",onClick:()=>m(i+1),children:[(0,n.jsx)(r.Z,{scene:(null==o?void 0:null===(e=o.team_context)||void 0===e?void 0:e.chat_scene)||"chat_agent",width:8,height:8}),(0,n.jsxs)("div",{className:"flex flex-col ml-2",children:[(0,n.jsx)(a.Z.Text,{className:"text-md font-bold line-clamp-2",children:null==o?void 0:o.app_name}),(0,n.jsx)(a.Z.Text,{className:"text-sm line-clamp-2",children:null==o?void 0:o.app_describe})]})]}),(0,n.jsx)("div",{onClick:f,className:"flex items-center justify-center w-10 h-10 bg-[#ffffff99] dark:bg-[rgba(255,255,255,0.2)] border border-white dark:border-[rgba(255,255,255,0.2)] rounded-[50%] cursor-pointer",children:(0,n.jsx)(l.Z,{className:"text-lg"})})]})})},49484:function(e,o,t){"use strict";t.r(o);var n=t(52676),r=t(63384),l=t(51921),s=t(14059),a=t(6181),i=t(65351),d=t(79312),c=t(94752),u=t(47219),m=t(63464),f=t(58976),g=t(52977),p=t(35209),v=t(16116),h=t(7464),x=t(25433),k=t(82187),b=t.n(k),j=t(98844),y=t(75271),_=t(21201),w=t(84663),S=t(72717),N=t(6656);let Z=["magenta","orange","geekblue","purple","cyan","green"];o.default=()=>{var e,o;let t=(0,j.useSearchParams)(),k=null!==(o=null==t?void 0:t.get("ques"))&&void 0!==o?o:"",{history:C,model:P,scene:M,temperature:D,resource:R,conv_uid:E,appInfo:O,scrollViewRef:T,order:F,userInput:I,ctrl:H,canAbort:V,canNewChat:W,setHistory:A,setCanNewChat:L,setCarAbort:U,setUserInput:q}=(0,y.useContext)(_.MobileChatContext),[B,$]=(0,y.useState)(!1),[z,J]=(0,y.useState)(!1),G=async e=>{var o,t,n;q(""),H.current=new AbortController;let r={chat_mode:M,model_name:P,user_input:e||I,conv_uid:E,temperature:D,app_code:null==O?void 0:O.app_code,...R&&{select_param:JSON.stringify(R)}};if(C&&C.length>0){let e=null==C?void 0:C.filter(e=>"view"===e.role);F.current=e[e.length-1].order+1}let a=[{role:"human",context:e||I,model_name:P,order:F.current,time_stamp:0},{role:"view",context:"",model_name:P,order:F.current,time_stamp:0,thinking:!0}],i=a.length-1;A([...C,...a]),L(!1);try{await (0,m.L)("".concat((o="http://0.0.0.0:7777",void 0!==o)?o:"","/api/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",[s.gp]:null!==(t=(0,l.n5)())&&void 0!==t?t:""},signal:H.current.signal,body:JSON.stringify(r),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===m.a)return},onclose(){var e;null===(e=H.current)||void 0===e||e.abort(),L(!0),U(!1)},onerror(e){throw Error(e)},onmessage:e=>{let o=e.data;try{o=JSON.parse(o).vis}catch(e){o.replaceAll("\\n","\n")}"[DONE]"===o?(L(!0),U(!1)):(null==o?void 0:o.startsWith("[ERROR]"))?(a[i].context=null==o?void 0:o.replace("[ERROR]",""),a[i].thinking=!1,A([...C,...a]),L(!0),U(!1)):(U(!0),a[i].context=o,a[i].thinking=!1,A([...C,...a]))}})}catch(e){null===(n=H.current)||void 0===n||n.abort(),a[i].context="Sorry, we meet some error, please try again later.",a[i].thinking=!1,A([...a]),L(!0),U(!1)}},K=async()=>{I.trim()&&W&&await G()};(0,y.useEffect)(()=>{var e,o;null===(e=T.current)||void 0===e||e.scrollTo({top:null===(o=T.current)||void 0===o?void 0:o.scrollHeight,behavior:"auto"})},[C,T]);let Q=(0,y.useMemo)(()=>{if(!O)return[];let{param_need:e=[]}=O;return null==e?void 0:e.map(e=>e.type)},[O]),X=(0,y.useMemo)(()=>{var e;return 0===C.length&&O&&!!(null==O?void 0:null===(e=O.recommend_questions)||void 0===e?void 0:e.length)},[C,O]),{run:Y,loading:ee}=(0,f.Z)(async()=>await (0,r.Vx)((0,r.zR)(E)),{manual:!0,onSuccess:()=>{A([])}});return(0,y.useEffect)(()=>{k&&P&&E&&O&&G(k)},[O,E,P,k]),(0,n.jsxs)("div",{className:"flex flex-col",children:[X&&(0,n.jsx)("ul",{children:null==O?void 0:null===(e=O.recommend_questions)||void 0===e?void 0:e.map((e,o)=>(0,n.jsx)("li",{className:"mb-3",children:(0,n.jsx)(g.Z,{color:Z[o],className:"p-2 rounded-xl",onClick:async()=>{G(e.question)},children:e.question})},e.id))}),(0,n.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,n.jsxs)("div",{className:"flex gap-2 mb-1 w-full overflow-x-auto",children:[(null==Q?void 0:Q.includes("model"))&&(0,n.jsx)(w.default,{}),(null==Q?void 0:Q.includes("resource"))&&(0,n.jsx)(S.default,{}),(null==Q?void 0:Q.includes("temperature"))&&(0,n.jsx)(N.default,{})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between text-lg font-bold",children:[(0,n.jsx)(p.Z,{content:"暂停回复",trigger:["hover"],children:(0,n.jsx)(a.Z,{className:b()("p-2 cursor-pointer",{"text-[#0c75fc]":V,"text-gray-400":!V}),onClick:()=>{var e;V&&(null===(e=H.current)||void 0===e||e.abort(),setTimeout(()=>{U(!1),L(!0)},100))}})}),(0,n.jsx)(p.Z,{content:"再来一次",trigger:["hover"],children:(0,n.jsx)(i.Z,{className:b()("p-2 cursor-pointer",{"text-gray-400":!C.length||!W}),onClick:()=>{var e,o;if(!W||0===C.length)return;let t=null===(e=null===(o=C.filter(e=>"human"===e.role))||void 0===o?void 0:o.slice(-1))||void 0===e?void 0:e[0];G((null==t?void 0:t.context)||"")}})}),ee?(0,n.jsx)(v.Z,{spinning:ee,indicator:(0,n.jsx)(d.Z,{style:{fontSize:18},spin:!0}),className:"p-2"}):(0,n.jsx)(p.Z,{content:"清除历史",trigger:["hover"],children:(0,n.jsx)(c.Z,{className:b()("p-2 cursor-pointer",{"text-gray-400":!C.length||!W}),onClick:()=>{W&&Y()}})})]})]}),(0,n.jsxs)("div",{className:b()("flex py-2 px-3 items-center justify-between bg-white dark:bg-[#242733] dark:border-[#6f7f95] rounded-xl border",{"border-[#0c75fc] dark:border-[rgba(12,117,252,0.8)]":B}),children:[(0,n.jsx)(h.default.TextArea,{placeholder:"可以问我任何问题",className:"w-full resize-none border-0 p-0 focus:shadow-none",value:I,autoSize:{minRows:1},onKeyDown:e=>{if("Enter"===e.key&&!e.shiftKey){if(z){e.preventDefault();return}I.trim()&&(e.preventDefault(),K())}},onChange:e=>{q(e.target.value)},onFocus:()=>{$(!0)},onBlur:()=>$(!1),onCompositionStartCapture:()=>{J(!0)},onCompositionEndCapture:()=>{setTimeout(()=>{J(!1)},0)}}),(0,n.jsx)(x.ZP,{type:"primary",className:b()("flex items-center justify-center rounded-lg bg-button-gradient border-0 ml-2",{"opacity-40 cursor-not-allowed":!I.trim()||!W}),onClick:K,children:W?(0,n.jsx)(u.Z,{}):(0,n.jsx)(v.Z,{indicator:(0,n.jsx)(d.Z,{className:"text-white"})})})]})]})}},84663:function(e,o,t){"use strict";t.r(o);var n=t(52676),r=t(40330),l=t(46501),s=t(22069),a=t(54929),i=t(35209),d=t(75271),c=t(21201);o.default=()=>{let{modelList:e}=(0,d.useContext)(r.p),{model:o,setModel:t}=(0,d.useContext)(c.MobileChatContext),u=(0,d.useMemo)(()=>e.length>0?e.map(e=>({label:(0,n.jsxs)("div",{className:"flex items-center gap-2",onClick:()=>{t(e)},children:[(0,n.jsx)(l.Z,{width:14,height:14,model:e}),(0,n.jsx)("span",{className:"text-xs",children:e})]}),key:e})):[],[e,t]);return(0,n.jsx)(a.Z,{menu:{items:u},placement:"top",trigger:["click"],children:(0,n.jsx)(i.Z,{content:o,children:(0,n.jsxs)("div",{className:"flex items-center gap-1 border rounded-xl bg-white dark:bg-black p-2 flex-shrink-0",children:[(0,n.jsx)(l.Z,{width:16,height:16,model:o}),(0,n.jsx)("span",{className:"text-xs font-medium line-clamp-1",style:{maxWidth:96},children:o}),(0,n.jsx)(s.Z,{rotate:90})]})})})}},95873:function(e,o,t){"use strict";t.r(o);var n=t(52676),r=t(97858),l=t.n(r),s=t(75271);o.default=(0,s.memo)(e=>{let{width:o,height:t,src:r,label:s}=e;return(0,n.jsx)(l(),{width:o||14,height:t||14,src:r,alt:s||"db-icon",priority:!0})})},72717:function(e,o,t){"use strict";t.r(o);var n=t(52676),r=t(63384),l=t(15543),s=t(51921),a=t(79312),i=t(22069),d=t(42808),c=t(58976),u=t(16116),m=t(29144),f=t(54929),g=t(75271),p=t(21201),v=t(95873);o.default=()=>{let{appInfo:e,resourceList:o,scene:t,model:h,conv_uid:x,getChatHistoryRun:k,setResource:b,resource:j}=(0,g.useContext)(p.MobileChatContext),{temperatureValue:y,maxNewTokensValue:_}=(0,g.useContext)(l.ChatContentContext),[w,S]=(0,g.useState)(null),N=(0,g.useMemo)(()=>{var o,t,n;return null===(o=null==e?void 0:null===(t=e.param_need)||void 0===t?void 0:t.filter(e=>"resource"===e.type))||void 0===o?void 0:null===(n=o[0])||void 0===n?void 0:n.value},[e]),Z=(0,g.useMemo)(()=>o&&o.length>0?o.map(e=>({label:(0,n.jsxs)("div",{className:"flex items-center gap-2",onClick:()=>{S(e),b(e.space_id||e.param)},children:[(0,n.jsx)(v.default,{width:14,height:14,src:s.S$[e.type].icon,label:s.S$[e.type].label}),(0,n.jsx)("span",{className:"text-xs",children:e.param})]}),key:e.space_id||e.param})):[],[o,b]),{run:C,loading:P}=(0,c.Z)(async e=>{let[,o]=await (0,r.Vx)((0,r.qn)({convUid:x,chatMode:t,data:e,model:h,temperatureValue:y,maxNewTokensValue:_,config:{timeout:36e5}}));return b(o),o},{manual:!0,onSuccess:async()=>{await k()}}),M=async e=>{let o=new FormData;o.append("doc_file",null==e?void 0:e.file),await C(o)},D=(0,g.useMemo)(()=>P?(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(u.Z,{size:"small",indicator:(0,n.jsx)(a.Z,{spin:!0})}),(0,n.jsx)("span",{className:"text-xs",children:"上传中"})]}):j?(0,n.jsxs)("div",{className:"flex gap-1",children:[(0,n.jsx)("span",{className:"text-xs",children:j.file_name}),(0,n.jsx)(i.Z,{rotate:90})]}):(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(d.Z,{className:"text-base"}),(0,n.jsx)("span",{className:"text-xs",children:"上传文件"})]}),[P,j]);return(0,n.jsx)(n.Fragment,{children:(()=>{switch(N){case"excel_file":case"text_file":case"image_file":return(0,n.jsx)("div",{className:"flex items-center justify-center gap-1 border rounded-xl bg-white dark:bg-black px-2 flex-shrink-0",children:(0,n.jsx)(m.default,{name:"file",accept:".xlsx,.xls",maxCount:1,showUploadList:!1,beforeUpload:()=>!1,onChange:M,className:"flex h-full w-full items-center justify-center",children:D})});case"database":case"knowledge":case"plugin":case"awel_flow":var e,t,r,l,a;if(!(null==o?void 0:o.length))return null;return(0,n.jsx)(f.Z,{menu:{items:Z},placement:"top",trigger:["click"],children:(0,n.jsxs)("div",{className:"flex items-center gap-1 border rounded-xl bg-white dark:bg-black p-2 flex-shrink-0",children:[(0,n.jsx)(v.default,{width:14,height:14,src:null===(e=s.S$[(null==w?void 0:w.type)||(null==o?void 0:null===(t=o[0])||void 0===t?void 0:t.type)])||void 0===e?void 0:e.icon,label:null===(r=s.S$[(null==w?void 0:w.type)||(null==o?void 0:null===(l=o[0])||void 0===l?void 0:l.type)])||void 0===r?void 0:r.label}),(0,n.jsx)("span",{className:"text-xs font-medium",children:(null==w?void 0:w.param)||(null==o?void 0:null===(a=o[0])||void 0===a?void 0:a.param)}),(0,n.jsx)(i.Z,{rotate:90})]})})}})()})}},6656:function(e,o,t){"use strict";t.r(o);var n=t(52676),r=t(23794),l=t(54929),s=t(46967),a=t(75271),i=t(21201);o.default=()=>{let{temperature:e,setTemperature:o}=(0,a.useContext)(i.MobileChatContext),t=e=>{isNaN(e)||o(e)};return(0,n.jsx)(l.Z,{trigger:["click"],dropdownRender:()=>(0,n.jsx)("div",{className:"flex h-28 bg-white dark:bg-[rgba(255,255,255,0.5)] items-center justify-center rounded-xl py-3",children:(0,n.jsx)(s.Z,{defaultValue:.5,max:1,min:0,step:.1,vertical:!0,onChange:t,value:e})}),placement:"top",children:(0,n.jsxs)("div",{className:"flex items-center justify-between border rounded-xl bg-white dark:bg-black w-14 p-2 flex-shrink-0",children:[(0,n.jsx)(r.Z,{type:"icon-icons-temperature",className:"text-sm"}),(0,n.jsx)("span",{className:"text-xs font-medium",children:e})]})})}},21201:function(e,o,t){"use strict";t.r(o),t.d(o,{MobileChatContext:function(){return k}});var n=t(52676),r=t(40330),l=t(63384),s=t(76657),a=t(51921),i=t(14059),d=t(63464),c=t(58976),u=t(16116),m=t(52373),f=t.n(m),g=t(98844),p=t(75271),v=t(14113),h=t(49484);let x=f()(()=>Promise.all([t.e(8201),t.e(3732),t.e(4130),t.e(4521),t.e(768),t.e(5745),t.e(9066),t.e(4745),t.e(1568),t.e(7707),t.e(9914),t.e(9308),t.e(2763),t.e(8226),t.e(8025),t.e(4186),t.e(8814),t.e(350),t.e(4965),t.e(6447),t.e(8889),t.e(163),t.e(2486),t.e(3431)]).then(t.bind(t,83431)),{loadableGenerated:{webpack:()=>[83431]},ssr:!1}),k=(0,p.createContext)({model:"",temperature:.5,resource:null,setModel:()=>{},setTemperature:()=>{},setResource:()=>{},scene:"",history:[],setHistory:()=>{},scrollViewRef:{current:null},appInfo:{},conv_uid:"",resourceList:[],order:{current:1},handleChat:()=>Promise.resolve(),canAbort:!1,setCarAbort:()=>{},canNewChat:!1,setCanNewChat:()=>{},ctrl:{current:void 0},userInput:"",setUserInput:()=>{},getChatHistoryRun:()=>{}});o.default=()=>{var e,o;let t=(0,g.useSearchParams)(),m=null!==(e=null==t?void 0:t.get("chat_scene"))&&void 0!==e?e:"",f=null!==(o=null==t?void 0:t.get("app_code"))&&void 0!==o?o:"",{modelList:b}=(0,p.useContext)(r.p),[j,y]=(0,p.useState)([]),[_,w]=(0,p.useState)(""),[S,N]=(0,p.useState)(.5),[Z,C]=(0,p.useState)(null),P=(0,p.useRef)(null),[M,D]=(0,p.useState)(""),[R,E]=(0,p.useState)(!1),[O,T]=(0,p.useState)(!0),F=(0,p.useRef)(),I=(0,p.useRef)(1),H=(0,s.Z)(),V=(0,p.useMemo)(()=>"".concat(null==H?void 0:H.user_no,"_").concat(f),[f,H]),{run:W,loading:A}=(0,c.Z)(async()=>await (0,l.Vx)((0,l.$i)("".concat(null==H?void 0:H.user_no,"_").concat(f))),{manual:!0,onSuccess:e=>{let[,o]=e,t=null==o?void 0:o.filter(e=>"view"===e.role);t&&t.length>0&&(I.current=t[t.length-1].order+1),y(o||[])}}),{data:L,run:U,loading:q}=(0,c.Z)(async e=>{let[,o]=await (0,l.Vx)((0,l.BN)(e));return null!=o?o:{}},{manual:!0}),{run:B,data:$,loading:z}=(0,c.Z)(async()=>{var e,o;let[,t]=await (0,l.Vx)((0,l.vD)(m));return C((null==t?void 0:null===(e=t[0])||void 0===e?void 0:e.space_id)||(null==t?void 0:null===(o=t[0])||void 0===o?void 0:o.param)),null!=t?t:[]},{manual:!0}),{run:J,loading:G}=(0,c.Z)(async()=>{let[,e]=await (0,l.Vx)((0,l.iP)());return null!=e?e:[]},{manual:!0,onSuccess:e=>{var o;let t=null===(o=null==e?void 0:e.filter(e=>e.conv_uid===V))||void 0===o?void 0:o[0];(null==t?void 0:t.select_param)&&C(JSON.parse(null==t?void 0:t.select_param))}});(0,p.useEffect)(()=>{m&&f&&b.length&&U({chat_scene:m,app_code:f})},[f,m,U,b]),(0,p.useEffect)(()=>{f&&W()},[f]),(0,p.useEffect)(()=>{if(b.length>0){var e,o,t;let n=null===(e=null==L?void 0:null===(o=L.param_need)||void 0===o?void 0:o.filter(e=>"model"===e.type))||void 0===e?void 0:null===(t=e[0])||void 0===t?void 0:t.value;w(n||b[0])}},[b,L]),(0,p.useEffect)(()=>{var e,o,t;let n=null===(e=null==L?void 0:null===(o=L.param_need)||void 0===o?void 0:o.filter(e=>"temperature"===e.type))||void 0===e?void 0:null===(t=e[0])||void 0===t?void 0:t.value;N(n||.5)},[L]),(0,p.useEffect)(()=>{if(m&&(null==L?void 0:L.app_code)){var e,o,t,n,r,l;let s=null===(e=null==L?void 0:null===(o=L.param_need)||void 0===o?void 0:o.filter(e=>"resource"===e.type))||void 0===e?void 0:null===(t=e[0])||void 0===t?void 0:t.value,a=null===(n=null==L?void 0:null===(r=L.param_need)||void 0===r?void 0:r.filter(e=>"resource"===e.type))||void 0===n?void 0:null===(l=n[0])||void 0===l?void 0:l.bind_value;a&&C(a),["database","knowledge","plugin","awel_flow"].includes(s)&&!a&&B()}},[L,m,B]);let K=async e=>{var o,t,n;D(""),F.current=new AbortController;let r={chat_mode:m,model_name:_,user_input:e||M,conv_uid:V,temperature:S,app_code:null==L?void 0:L.app_code,...Z&&{select_param:Z}};if(j&&j.length>0){let e=null==j?void 0:j.filter(e=>"view"===e.role);I.current=e[e.length-1].order+1}let l=[{role:"human",context:e||M,model_name:_,order:I.current,time_stamp:0},{role:"view",context:"",model_name:_,order:I.current,time_stamp:0,thinking:!0}],s=l.length-1;y([...j,...l]),T(!1);try{await (0,d.L)("".concat((o="http://0.0.0.0:7777",void 0!==o)?o:"","/api/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",[i.gp]:null!==(t=(0,a.n5)())&&void 0!==t?t:""},signal:F.current.signal,body:JSON.stringify(r),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===d.a)return},onclose(){var e;null===(e=F.current)||void 0===e||e.abort(),T(!0),E(!1)},onerror(e){throw Error(e)},onmessage:e=>{let o=e.data;try{o=JSON.parse(o).vis}catch(e){o.replaceAll("\\n","\n")}"[DONE]"===o?(T(!0),E(!1)):(null==o?void 0:o.startsWith("[ERROR]"))?(l[s].context=null==o?void 0:o.replace("[ERROR]",""),l[s].thinking=!1,y([...j,...l]),T(!0),E(!1)):(E(!0),l[s].context=o,l[s].thinking=!1,y([...j,...l]))}})}catch(e){null===(n=F.current)||void 0===n||n.abort(),l[s].context="Sorry, we meet some error, please try again later.",l[s].thinking=!1,y([...l]),T(!0),E(!1)}};return(0,p.useEffect)(()=>{m&&"chat_agent"!==m&&J()},[m,J]),(0,n.jsx)(k.Provider,{value:{model:_,resource:Z,setModel:w,setTemperature:N,setResource:C,temperature:S,appInfo:L,conv_uid:V,scene:m,history:j,scrollViewRef:P,setHistory:y,resourceList:$,order:I,handleChat:K,setCanNewChat:T,ctrl:F,canAbort:R,setCarAbort:E,canNewChat:O,userInput:M,setUserInput:D,getChatHistoryRun:W},children:(0,n.jsx)(u.Z,{size:"large",className:"flex h-screen w-screen justify-center items-center max-h-screen",spinning:A||q||z||G,children:(0,n.jsxs)("div",{className:"flex flex-col h-screen bg-gradient-light dark:bg-gradient-dark p-4 pt-0",children:[(0,n.jsxs)("div",{ref:P,className:"flex flex-col flex-1 overflow-y-auto mb-3",children:[(0,n.jsx)(v.default,{}),(0,n.jsx)(x,{})]}),(null==L?void 0:L.app_code)&&(0,n.jsx)(h.default,{})]})})})}},20346:function(e,o,t){"use strict";t.d(o,{Tk:function(){return i},PR:function(){return d}});var n=t(51921),r=t(83803);t(32699);var l=t(1669);let s=l.default.create({baseURL:"http://0.0.0.0:7777"});s.defaults.timeout=1e4,s.interceptors.response.use(e=>e.data,e=>Promise.reject(e));let a={"content-type":"application/json","User-Id":(0,n.n5)()},i=(e,o)=>{if(o){let t=Object.keys(o).filter(e=>void 0!==o[e]&&""!==o[e]).map(e=>"".concat(e,"=").concat(o[e])).join("&");t&&(e+="?".concat(t))}return s.get("/api"+e,{headers:a}).then(e=>e).catch(e=>{r.ZP.error(e),Promise.reject(e)})},d=(e,o)=>s.post(e,o,{headers:a}).then(e=>e).catch(e=>{r.ZP.error(e),Promise.reject(e)})},51083:function(){}}]);