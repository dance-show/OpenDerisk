(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1655,1201],{77401:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eM}});var r=n(52676),o=n(40330),l=n(16019),a=n(86471),i=n(51921),s=n(9158),d=n(84875),c=n.n(d),u=n(98844),f=n(75271),g=n(85100),m=n(14425),h=n(99532),p=()=>{let{history:e,setHistory:t,chatId:n,model:r,docId:i}=(0,f.useContext)(o.p),{chat:s}=(0,a.Z)({queryAgentURL:"/knowledge/document/summary"}),d=(0,f.useCallback)(async e=>{let[,o]=await (0,l.Vx)((0,l.$i)(n)),a=[...o,{role:"human",context:"",model_name:r,order:0,time_stamp:0},{role:"view",context:"",model_name:r,order:0,time_stamp:0,retry:!0}],d=a.length-1;t([...a]),await s({data:{doc_id:e||i,model_name:r},chatId:n,onMessage:e=>{a[d].context=e,t([...a])}})},[e,r,i,n]);return d},x=n(59849),v=n(4629),b=n(58227),k=n(60175),j=n(9349),y=n(69439),w=n(83958),_=n(874),Z=n.n(_),N=n(32699),C=n(24841),S=n(83058),P=n(63688),R=n(25377),E=n(87007),M=n(65483),O=n(96950);function I(e){let{document:t}=e;switch(t.status){case"RUNNING":return(0,r.jsx)(M.Rp,{});case"FINISHED":default:return(0,r.jsx)(M.s2,{});case"FAILED":return(0,r.jsx)(O.Z,{})}}function D(e){let{documents:t,dbParam:n}=e,o=(0,E.useRouter)(),l=e=>{o.push("/knowledge/chunk/?spaceName=".concat(n,"&id=").concat(e))};return(null==t?void 0:t.length)?(0,r.jsx)("div",{className:"absolute flex overflow-scroll h-12 top-[-35px] w-full z-10",children:t.map(e=>{let t;switch(e.status){case"RUNNING":t="#2db7f5";break;case"FINISHED":default:t="#87d068";break;case"FAILED":t="#f50"}return(0,r.jsx)(y.Z,{title:e.result,children:(0,r.jsxs)(R.ZP,{style:{color:t},onClick:()=>{l(e.id)},className:"shrink flex items-center mr-3",children:[(0,r.jsx)(I,{document:e}),e.doc_name]})},e.id)})}):null}var q=n(51163),L=n(45467);function T(e){let{dbParam:t,setDocId:n}=(0,f.useContext)(o.p),{onUploadFinish:a,handleFinish:i}=e,s=p(),[d,c]=(0,f.useState)(!1),u=async e=>{c(!0);let r=new FormData;r.append("doc_name",e.file.name),r.append("doc_file",e.file),r.append("doc_type","DOCUMENT");let o=await (0,l.Vx)((0,l.iG)(t||"default",r));if(!o[1]){c(!1);return}n(o[1]),a(),c(!1),null==i||i(!0),await s(o[1]),null==i||i(!1)};return(0,r.jsx)(L.default,{customRequest:u,showUploadList:!1,maxCount:1,multiple:!1,className:"absolute z-10 top-2 left-2",accept:".pdf,.ppt,.pptx,.xls,.xlsx,.doc,.docx,.txt,.md",children:(0,r.jsx)(R.ZP,{loading:d,size:"small",shape:"circle",icon:(0,r.jsx)(q.Z,{})})})}var F=n(20346),U=n(10901),V=n(72097),A=n(56145),$=n(69208),H=n(5783),z=n(25675),B=n(2912);let J=e=>{let{data:t,loading:n,submit:o,close:l}=e,{t:a}=(0,C.$G)(),i=e=>()=>{o(e),l()};return(0,r.jsx)("div",{style:{maxHeight:400,overflow:"auto"},children:(0,r.jsx)(V.Z,{dataSource:null==t?void 0:t.data,loading:n,rowKey:e=>e.prompt_name,renderItem:e=>(0,r.jsx)(V.Z.Item,{onClick:i(e.content),children:(0,r.jsx)(y.Z,{title:e.content,children:(0,r.jsx)(V.Z.Item.Meta,{style:{cursor:"copy"},title:e.prompt_name,description:a("Prompt_Info_Scene")+"：".concat(e.chat_scene,"，")+a("Prompt_Info_Sub_Scene")+"：".concat(e.sub_chat_scene)})})},e.prompt_name)})})};var G=e=>{let{submit:t}=e,{t:n}=(0,C.$G)(),[o,l]=(0,f.useState)(!1),[a,i]=(0,f.useState)("common"),{data:s,loading:d}=(0,U.Z)(()=>(0,F.PR)("/prompt/list",{prompt_type:a}),{refreshDeps:[a],onError:e=>{j.ZP.error(null==e?void 0:e.message)}});return(0,r.jsx)(A.ZP,{theme:{components:{Popover:{minWidth:250}}},children:(0,r.jsx)($.Z,{title:(0,r.jsx)(H.default.Item,{label:"Prompt "+n("Type"),children:(0,r.jsx)(z.default,{style:{width:150},value:a,onChange:e=>{i(e)},options:[{label:n("Public")+" Prompts",value:"common"},{label:n("Private")+" Prompts",value:"private"}]})}),content:(0,r.jsx)(J,{data:s,loading:d,submit:t,close:()=>{l(!1)}}),placement:"topRight",trigger:"click",open:o,onOpenChange:e=>{l(e)},children:(0,r.jsx)(y.Z,{title:n("Click_Select")+" Prompt",children:(0,r.jsx)(B.Z,{className:"bottom-[30%]"})})})})},W=function(e){let{children:t,loading:n,onSubmit:a,handleFinish:i,placeholder:s,...d}=e,{dbParam:c,scene:u}=(0,f.useContext)(o.p),[g,m]=(0,f.useState)(""),h=(0,f.useMemo)(()=>"chat_knowledge"===u,[u]),[p,x]=(0,f.useState)([]),v=(0,f.useRef)(0);async function b(){if(!c)return null;let[e,t]=await (0,l.Vx)((0,l._Q)(c,{page:1,page_size:v.current}));x((null==t?void 0:t.data)||[])}(0,f.useEffect)(()=>{h&&b()},[c]);let k=async()=>{v.current+=1,await b()};return(0,r.jsxs)("div",{className:"flex-1 relative",children:[(0,r.jsx)(D,{documents:p,dbParam:c}),h&&(0,r.jsx)(T,{handleFinish:i,onUploadFinish:k,className:"absolute z-10 top-2 left-2"}),(0,r.jsx)(P.default.TextArea,{className:"flex-1 ".concat(h?"pl-10":""," pr-10"),size:"large",value:g,autoSize:{minRows:1,maxRows:4},...d,onPressEnter:e=>{if(g.trim()&&13===e.keyCode){if(e.shiftKey){e.preventDefault(),m(e=>e+"\n");return}a(g),setTimeout(()=>{m("")},0)}},onChange:e=>{if("number"==typeof d.maxLength){m(e.target.value.substring(0,d.maxLength));return}m(e.target.value)},placeholder:s}),(0,r.jsx)(R.ZP,{className:"ml-2 flex items-center justify-center absolute right-0 bottom-0",size:"large",type:"text",loading:n,icon:(0,r.jsx)(S.Z,{}),onClick:()=>{a(g)}}),(0,r.jsx)(G,{submit:e=>{m(g+e)}}),t]})},K=n(56275),Q=n(97950),X=(0,f.memo)(function(e){var t;let{content:n}=e,{scene:l}=(0,f.useContext)(o.p),a="view"===n.role;return(0,r.jsx)("div",{className:c()("relative w-full p-2 md:p-4 rounded-xl break-words",{"bg-white dark:bg-[#232734]":a,"lg:w-full xl:w-full pl-0":["chat_with_db_execute","chat_dashboard"].includes(l)}),children:a?(0,r.jsx)(K.Z,{components:Q.ZP,...Q.dx,children:(0,Q.CE)(null==(t=n.context)?void 0:t.replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>"))}):(0,r.jsx)("div",{className:"",children:n.context})})}),Y=n(30657),ee=n(77547),et=n(2206),en=n(40350),er=n(14174),eo=n(9866),el=n(69811),ea=n(19652),ei=n(21667);let es={todo:{bgClass:"bg-gray-500",icon:(0,r.jsx)(Y.Z,{className:"ml-2"})},runing:{bgClass:"bg-blue-500",icon:(0,r.jsx)(ee.Z,{className:"ml-2"})},failed:{bgClass:"bg-red-500",icon:(0,r.jsx)(et.Z,{className:"ml-2"})},completed:{bgClass:"bg-green-500",icon:(0,r.jsx)(en.Z,{className:"ml-2"})}};function ed(e){return e.replaceAll("\\n","\n").replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>")}var ec=(0,f.memo)(function(e){let{children:t,content:n,isChartChat:l,onLinkClick:a}=e,{scene:i}=(0,f.useContext)(o.p),{context:s,model_name:d,role:u}=n,g="view"===u,{relations:m,value:h,cachePluginContext:p}=(0,f.useMemo)(()=>{if("string"!=typeof s)return{relations:[],value:"",cachePluginContext:[]};let[e,t]=s.split("	relations:"),n=t?t.split(","):[],r=[],o=0,l=e.replace(/<dbgpt-view[^>]*>[^<]*<\/dbgpt-view>/gi,e=>{try{var t;let n=e.replaceAll("\n","\\n").replace(/<[^>]*>|<\/[^>]*>/gm,""),l=JSON.parse(n),a="<custom-view>".concat(o,"</custom-view>");return r.push({...l,result:ed(null!==(t=l.result)&&void 0!==t?t:"")}),o++,a}catch(t){return console.log(t.message,t),e}});return{relations:n,cachePluginContext:r,value:l}},[s]),x=(0,f.useMemo)(()=>({"custom-view"(e){var t;let{children:n}=e,o=+n.toString();if(!p[o])return n;let{name:l,status:a,err_msg:i,result:s}=p[o],{bgClass:d,icon:u}=null!==(t=es[a])&&void 0!==t?t:{};return(0,r.jsxs)("div",{className:"bg-white dark:bg-[#212121] rounded-lg overflow-hidden my-2 flex flex-col lg:max-w-[80%]",children:[(0,r.jsxs)("div",{className:c()("flex px-4 md:px-6 py-2 items-center text-white text-sm",d),children:[l,u]}),s?(0,r.jsx)("div",{className:"px-4 md:px-6 py-4 text-sm",children:(0,r.jsx)(K.Z,{components:Q.ZP,...Q.dx,children:(0,Q.CE)(null!=s?s:"")})}):(0,r.jsx)("div",{className:"px-4 md:px-6 py-4 text-sm",children:i})]})}}),[s,p]);return g||s?(0,r.jsxs)("div",{className:c()("relative flex flex-wrap w-full p-2 md:p-4 rounded-xl break-words",{"bg-white dark:bg-[#232734]":g,"lg:w-full xl:w-full pl-0":["chat_with_db_execute","chat_dashboard"].includes(i)}),children:[(0,r.jsx)("div",{className:"mr-2 flex flex-shrink-0 items-center justify-center h-7 w-7 rounded-full text-lg sm:mr-4",children:g?(0,ei.A)(d)||(0,r.jsx)(er.Z,{}):(0,r.jsx)(eo.Z,{})}),(0,r.jsxs)("div",{className:"flex-1 overflow-hidden items-center text-md leading-8 pb-2",children:[!g&&"string"==typeof s&&s,g&&l&&"object"==typeof s&&(0,r.jsxs)("div",{children:["[".concat(s.template_name,"]: "),(0,r.jsxs)("span",{className:"text-theme-primary cursor-pointer",onClick:a,children:[(0,r.jsx)(el.Z,{className:"mr-1"}),s.template_introduce||"More Details"]})]}),g&&"string"==typeof s&&(0,r.jsx)(K.Z,{components:{...Q.ZP,...x},...Q.dx,children:(0,Q.CE)(ed(h))}),!!(null==m?void 0:m.length)&&(0,r.jsx)("div",{className:"flex flex-wrap mt-2",children:null==m?void 0:m.map((e,t)=>(0,r.jsx)(ea.Z,{color:"#108ee9",children:e},e+t))})]}),t]}):(0,r.jsx)("div",{className:"h-12"})}),eu=n(83669),ef=n(71635),eg=n(88912),em=n(74918),eh=n(71816),ep=n(22671),ex=n(92792),ev=n(66150),eb=n(35531),ek=n(47855),ej=n(34961),ey=n(97222),ew=n(27298),e_=n(48079),eZ=n(47042),eN=e=>{var t;let{conv_index:n,question:a,knowledge_space:i,select_param:s}=e,{t:d}=(0,C.$G)(),{chatId:c}=(0,f.useContext)(o.p),[u,g]=(0,f.useState)(""),[m,h]=(0,f.useState)(4),[p,x]=(0,f.useState)(""),v=(0,f.useRef)(null),[w,_]=j.ZP.useMessage(),Z=(0,f.useCallback)((e,t)=>{t?(0,l.Vx)((0,l.Eb)(c,n)).then(e=>{var t,n,r,o;let l=null!==(t=e[1])&&void 0!==t?t:{};g(null!==(n=l.ques_type)&&void 0!==n?n:""),h(parseInt(null!==(r=l.score)&&void 0!==r?r:"4")),x(null!==(o=l.messages)&&void 0!==o?o:"")}).catch(e=>{console.log(e)}):(g(""),h(4),x(""))},[c,n]),N=(0,eg.Z)(em.Z)(e=>{let{theme:t}=e;return{backgroundColor:"dark"===t.palette.mode?"#FBFCFD":"#0E0E10",...t.typography["body-sm"],padding:t.spacing(1),display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,width:"100%",height:"100%"}});return(0,r.jsxs)(eh.L,{onOpenChange:Z,children:[_,(0,r.jsx)(y.Z,{title:d("Rating"),children:(0,r.jsx)(ep.Z,{slots:{root:k.ZP},slotProps:{root:{variant:"plain",color:"primary"}},sx:{borderRadius:40},children:(0,r.jsx)(eu.Z,{})})}),(0,r.jsxs)(ex.Z,{children:[(0,r.jsx)(ev.Z,{disabled:!0,sx:{minHeight:0}}),(0,r.jsx)(eb.Z,{sx:{width:"100%",maxWidth:350,display:"grid",gap:3,padding:1},children:(0,r.jsx)("form",{onSubmit:e=>{e.preventDefault(),(0,l.Vx)((0,l.VC)({data:{conv_uid:c,conv_index:n,question:a,knowledge_space:i,score:m,ques_type:u,messages:p}})).then(e=>{w.open({type:"success",content:"save success"})}).catch(e=>{w.open({type:"error",content:"save error"})})},children:(0,r.jsxs)(ek.Z,{container:!0,spacing:.5,columns:13,sx:{flexGrow:1},children:[(0,r.jsx)(ek.Z,{xs:3,children:(0,r.jsx)(N,{children:d("Q_A_Category")})}),(0,r.jsx)(ek.Z,{xs:10,children:(0,r.jsx)(ej.Z,{action:v,value:u,placeholder:"Choose one…",onChange:(e,t)=>g(null!=t?t:""),...u&&{endDecorator:(0,r.jsx)(k.ZP,{size:"sm",variant:"plain",color:"neutral",onMouseDown:e=>{e.stopPropagation()},onClick:()=>{var e;g(""),null===(e=v.current)||void 0===e||e.focusVisible()},children:(0,r.jsx)(ef.Z,{})}),indicator:null},sx:{width:"100%"},children:s&&(null===(t=Object.keys(s))||void 0===t?void 0:t.map(e=>(0,r.jsx)(ey.Z,{value:e,children:s[e]},e)))})}),(0,r.jsx)(ek.Z,{xs:3,children:(0,r.jsx)(N,{children:(0,r.jsx)(y.Z,{title:(0,r.jsx)(eb.Z,{children:(0,r.jsx)("div",{children:d("feed_back_desc")})}),variant:"solid",placement:"left",children:d("Q_A_Rating")})})}),(0,r.jsx)(ek.Z,{xs:10,sx:{pl:0,ml:0},children:(0,r.jsx)(ew.Z,{"aria-label":"Custom",step:1,min:0,max:5,valueLabelFormat:function(e){return({0:d("Lowest"),1:d("Missed"),2:d("Lost"),3:d("Incorrect"),4:d("Verbose"),5:d("Best")})[e]},valueLabelDisplay:"on",marks:[{value:0,label:"0"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"},{value:5,label:"5"}],sx:{width:"90%",pt:3,m:2,ml:1},onChange:e=>{var t;return h(null===(t=e.target)||void 0===t?void 0:t.value)},value:m})}),(0,r.jsx)(ek.Z,{xs:13,children:(0,r.jsx)(e_.Z,{placeholder:d("Please_input_the_text"),value:p,onChange:e=>x(e.target.value),minRows:2,maxRows:4,endDecorator:(0,r.jsx)(eZ.ZP,{level:"body-xs",sx:{ml:"auto"},children:d("input_count")+p.length+d("input_unit")}),sx:{width:"100%",fontSize:14}})}),(0,r.jsx)(ek.Z,{xs:13,children:(0,r.jsx)(b.Z,{type:"submit",variant:"outlined",sx:{width:"100%",height:"100%"},children:d("submit")})})]})})})]})]})},eC=n(421),eS=e=>{var t,n;let{messages:a,onSubmit:d,onFormatContent:g}=e,{dbParam:h,currentDialogue:_,scene:S,model:P,refreshDialogList:R,chatId:E,agent:M,docId:O}=(0,f.useContext)(o.p),{t:I}=(0,C.$G)(),D=(0,u.useSearchParams)(),q=null!==(t=D&&D.get("select_param"))&&void 0!==t?t:"",L=null!==(n=D&&D.get("spaceNameOriginal"))&&void 0!==n?n:"",[T,F]=(0,f.useState)(!1),[U,V]=(0,f.useState)(!1),[A,$]=(0,f.useState)(a),[H,z]=(0,f.useState)(""),[B,J]=(0,f.useState)(),G=(0,f.useRef)(null),K=(0,f.useMemo)(()=>"chat_dashboard"===S,[S]),Q=p(),Y=(0,f.useMemo)(()=>{switch(S){case"chat_agent":return M;case"chat_excel":return null==_?void 0:_.select_param;case"chat_flow":return q;default:return L||h}},[S,M,_,h,L,q]),ee=async e=>{if(!T&&e.trim()){if("chat_agent"===S&&!M){j.ZP.warning(I("choice_agent_tip"));return}try{F(!0),await d(e,{select_param:null!=Y?Y:""})}finally{F(!1)}}},et=e=>K&&g&&"string"==typeof e?g(e):e,[en,er]=j.ZP.useMessage(),eo=async e=>{let t=K&&g&&"string"==typeof e?g(e):e,n=null==t?void 0:t.replace(/\trelations:.*/g,""),r=Z()(n);r?n?en.open({type:"success",content:I("copy_success")}):en.open({type:"warning",content:I("copy_nothing")}):en.open({type:"error",content:I("copy_failed")})},el=async()=>{!T&&O&&(F(!0),await Q(O),F(!1))};return(0,s.Z)(async()=>{let e=(0,i.a_)();e&&e.id===E&&(await ee(e.message),R(),localStorage.removeItem(i.rU))},[E]),(0,f.useEffect)(()=>{let e=a;K&&(e=(0,N.cloneDeep)(a).map(e=>{if((null==e?void 0:e.role)==="view"&&"string"==typeof(null==e?void 0:e.context))try{e.context=JSON.parse(e.context)}catch(t){g&&(e.context=et(e.context))}return e})),$(e.filter(e=>["view","human"].includes(e.role)))},[K,a,g]),(0,f.useEffect)(()=>{(0,l.Vx)((0,l.Lu)()).then(e=>{var t;J(null!==(t=e[1])&&void 0!==t?t:{})}).catch(e=>{console.log(e)})},[]),(0,f.useEffect)(()=>{setTimeout(()=>{var e;null===(e=G.current)||void 0===e||e.scrollTo(0,G.current.scrollHeight)},50)},[a]),(0,r.jsxs)(r.Fragment,{children:[er,(0,r.jsx)("div",{ref:G,className:"flex flex-1 overflow-y-auto h-full w-full flex-col",children:(0,r.jsx)("div",{className:"flex items-center flex-1 flex-col text-sm leading-6 text-slate-900 dark:text-slate-300 sm:text-base sm:leading-7",children:A.length?A.map((e,t)=>{var n;return"chat_agent"===S?(0,r.jsx)(X,{content:e},t):(0,r.jsx)(ec,{content:e,isChartChat:K,onLinkClick:()=>{V(!0),z(JSON.stringify(null==e?void 0:e.context,null,2))},children:"view"===e.role&&(0,r.jsxs)("div",{className:"flex w-full border-t border-gray-200 dark:border-theme-dark",children:["chat_knowledge"===S&&e.retry?(0,r.jsxs)(b.Z,{onClick:el,slots:{root:k.ZP},slotProps:{root:{variant:"plain",color:"primary"}},children:[(0,r.jsx)(x.Z,{}),"\xa0",(0,r.jsx)("span",{className:"text-sm",children:I("Retry")})]}):null,(0,r.jsxs)("div",{className:"flex w-full flex-row-reverse",children:[(0,r.jsx)(eN,{select_param:B,conv_index:Math.ceil((t+1)/2),question:null===(n=null==A?void 0:A.filter(t=>(null==t?void 0:t.role)==="human"&&(null==t?void 0:t.order)===e.order)[0])||void 0===n?void 0:n.context,knowledge_space:L||h||""}),(0,r.jsx)(y.Z,{title:I("Copy_Btn"),children:(0,r.jsx)(b.Z,{onClick:()=>eo(null==e?void 0:e.context),slots:{root:k.ZP},slotProps:{root:{variant:"plain",color:"primary"}},sx:{borderRadius:40},children:(0,r.jsx)(v.Z,{})})})]})]})},t)}):(0,r.jsx)(m.Z,{description:"Start a conversation"})})}),(0,r.jsx)("div",{className:c()("relative sticky bottom-0 bg-theme-light dark:bg-theme-dark after:absolute after:-top-8 after:h-8 after:w-full after:bg-gradient-to-t after:from-theme-light after:to-transparent dark:after:from-theme-dark",{"cursor-not-allowed":"chat_excel"===S&&!(null==_?void 0:_.select_param)}),children:(0,r.jsxs)("div",{className:"flex flex-wrap w-full py-2 sm:pt-6 sm:pb-10 items-center",children:[P&&(0,r.jsx)("div",{className:"mr-2 flex",children:(0,ei.A)(P)}),(0,r.jsx)(W,{loading:T,onSubmit:ee,handleFinish:F})]})}),(0,r.jsx)(w.default,{title:"JSON Editor",open:U,width:"60%",cancelButtonProps:{hidden:!0},onOk:()=>{V(!1)},onCancel:()=>{V(!1)},children:(0,r.jsx)(eC.Z,{className:"w-full h-[500px]",language:"json",value:H})})]})},eP=n(45374);let eR=e=>{if("string"!=typeof e)return e;if(e.startsWith("```vis-thinking")||e.includes("```vis-thinking")){let t=e.indexOf('{"');if(-1!==t){let n=e.substring(t);try{return JSON.parse(n)}catch(t){let e=n.replace(/```$/g,"").trim();try{return JSON.parse(e)}catch(e){return console.error("Error parsing cleaned JSON:",e),null}}}}try{return"string"==typeof e?JSON.parse(e):e}catch(t){return console.log("Not JSON format or vis-thinking format, returning original content"),e}},eE=e=>{if("string"!=typeof e)return e;if(e.startsWith("```vis-thinking")||e.includes("```vis-thinking")){let t=e.indexOf("```vis-thinking"),n=t+15,r=e.indexOf("```",n);if(-1!==r)return e.substring(t,r+3)}return e};var eM=()=>{var e;let t=(0,u.useSearchParams)(),{scene:n,chatId:d,model:p,agent:x,setModel:v,history:b,setHistory:k}=(0,f.useContext)(o.p),{chat:j}=(0,a.Z)({}),y=null!==(e=t&&t.get("initMessage"))&&void 0!==e?e:"",[w,_]=(0,f.useState)(!1),[Z,N]=(0,f.useState)(),C=async()=>{_(!0);let[,e]=await (0,l.Vx)((0,l.$i)(d));k(null!=e?e:[]),_(!1)},S=e=>{var t;let n=null===(t=e[e.length-1])||void 0===t?void 0:t.context;if(n)try{let e=eR(n),t="object"==typeof e?e:"string"==typeof n?JSON.parse(n):n;N((null==t?void 0:t.template_name)==="report"?null==t?void 0:t.charts:void 0)}catch(e){console.log(e),N([])}};(0,s.Z)(async()=>{let e=(0,i.a_)();e&&e.id===d||await C()},[y,d]),(0,f.useEffect)(()=>{var e,t;if(!b.length)return;let n=null===(e=null===(t=b.filter(e=>"view"===e.role))||void 0===t?void 0:t.slice(-1))||void 0===e?void 0:e[0];(null==n?void 0:n.model_name)&&v(n.model_name),S(b)},[b.length]),(0,f.useEffect)(()=>()=>{k([])},[]);let P=(0,f.useCallback)((e,t)=>new Promise(r=>{let o=[...b,{role:"human",context:e,model_name:p,order:0,time_stamp:0},{role:"view",context:"",model_name:p,order:0,time_stamp:0}],l=o.length-1;k([...o]),j({data:{...t,chat_mode:n||"chat_normal",model_name:p,user_input:e},chatId:d,onMessage:e=>{(null==t?void 0:t.incremental)?o[l].context+=e:o[l].context=e,k([...o])},onDone:()=>{S(o),r()},onClose:()=>{S(o),r()},onError:e=>{o[l].context=e,k([...o]),r()}})}),[b,j,d,p,x,n]);return(0,r.jsxs)("div",{className:"flex flex-col h-screen w-full overflow-hidden",children:[(0,r.jsx)(h.Z,{visible:w}),(0,r.jsx)("div",{className:"flex-none",children:(0,r.jsx)(eP.Z,{refreshHistory:C,modelChange:e=>{v(e)}})}),(0,r.jsxs)("div",{className:"flex-auto flex overflow-hidden",children:[!!(null==Z?void 0:Z.length)&&(0,r.jsx)("div",{className:c()("overflow-auto",{"w-full h-1/2 md:h-full md:w-3/4 pb-4 md:pr-4":"chat_dashboard"===n}),children:(0,r.jsx)(g.ZP,{chartsData:Z})}),!(null==Z?void 0:Z.length)&&"chat_dashboard"===n&&(0,r.jsx)("div",{className:c()("flex items-center justify-center",{"w-full h-1/2 md:h-full md:w-3/4":"chat_dashboard"===n}),children:(0,r.jsx)(m.Z,{})}),(0,r.jsx)("div",{className:c()("flex flex-col overflow-hidden",{"w-full h-1/2 md:h-full md:w-1/4 border-t md:border-t-0 md:border-l dark:border-gray-800":"chat_dashboard"===n,"w-full h-full px-4 lg:px-8":"chat_dashboard"!==n}),children:(0,r.jsx)("div",{className:"h-full overflow-hidden",children:(0,r.jsx)(eS,{messages:b,onSubmit:P,onFormatContent:eE})})})]})]})}},45374:function(e,t,n){"use strict";n.d(t,{Z:function(){return E}});var r=n(52676),o=n(40330),l=n(21667),a=n(65483),i=n(50712),s=n(91959),d=n(89121),c=n(75271);function u(){let{isContract:e,setIsContract:t,scene:n}=(0,c.useContext)(o.p),l=n&&["chat_with_db_execute","chat_dashboard"].includes(n);return l?(0,r.jsxs)(d.ZP.Group,{value:e,defaultValue:!0,buttonStyle:"solid",onChange:()=>{t(!e)},children:[(0,r.jsxs)(d.ZP.Button,{value:!1,children:[(0,r.jsx)(i.Z,{component:a.ig,className:"mr-1"}),"Preview"]}),(0,r.jsxs)(d.ZP.Button,{value:!0,children:[(0,r.jsx)(s.Z,{className:"mr-1"}),"Editor"]})]}):null}n(51083);var f=n(16019),g=n(10901),m=n(25675),h=n(24841),p=function(){let{t:e}=(0,h.$G)(),{agent:t,setAgent:n}=(0,c.useContext)(o.p),{data:l=[]}=(0,g.Z)(async()=>{let[,e]=await (0,f.Vx)((0,f.H4)());return null!=e?e:[]});return(0,r.jsx)(m.default,{className:"w-60",value:t,placeholder:e("Select_Plugins"),options:l.map(e=>({label:e.app_name,value:e.app_code})),allowClear:!0,onChange:e=>{null==n||n(e)}})},x=n(38131),v=n(15543),b=n(3895),k=n(2359),j=n(9349),y=n(69439),w=n(45467),_=n(25377),Z=function(e){var t;let{convUid:n,chatMode:l,onComplete:a,...i}=e,[s,d]=(0,c.useState)(!1),[u,g]=j.ZP.useMessage(),[m,h]=(0,c.useState)([]),[p,Z]=(0,c.useState)(),{model:N}=(0,c.useContext)(o.p),{temperatureValue:C,maxNewTokensValue:S}=(0,c.useContext)(v.ChatContentContext),P=async e=>{var t;if(!e){j.ZP.error("Please select the *.(csv|xlsx|xls) file");return}if(!/\.(csv|xlsx|xls)$/.test(null!==(t=e.file.name)&&void 0!==t?t:"")){j.ZP.error("File type must be csv, xlsx or xls");return}h([e.file])},R=async()=>{d(!0);try{let e=new FormData;e.append("doc_file",m[0]),u.open({content:"Uploading ".concat(m[0].name),type:"loading",duration:0});let[t]=await (0,f.Vx)((0,f.qn)({convUid:n,chatMode:l,data:e,model:N,temperatureValue:C,maxNewTokensValue:S,config:{timeout:36e5,onUploadProgress:e=>{let t=Math.ceil(e.loaded/(e.total||0)*100);Z(t)}}}));if(t)return;j.ZP.success("success"),null==a||a()}catch(e){j.ZP.error((null==e?void 0:e.message)||"Upload Error")}finally{d(!1),u.destroy()}};return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[g,(0,r.jsx)(y.Z,{placement:"bottom",title:"File cannot be changed after upload",children:(0,r.jsx)(w.default,{disabled:s,className:"mr-1",beforeUpload:()=>!1,fileList:m,name:"file",accept:".csv,.xlsx,.xls",multiple:!1,onChange:P,showUploadList:{showDownloadIcon:!1,showPreviewIcon:!1,showRemoveIcon:!1},itemRender:()=>(0,r.jsx)(r.Fragment,{}),...i,children:(0,r.jsx)(_.ZP,{className:"flex justify-center items-center",type:"primary",disabled:s,icon:(0,r.jsx)(b.Z,{}),children:"Select File"})})}),(0,r.jsx)(_.ZP,{type:"primary",loading:s,className:"flex justify-center items-center",disabled:!m.length,icon:(0,r.jsx)(k.Z,{}),onClick:R,children:s?100===p?"Analysis":"Uploading":"Upload"}),!!m.length&&(0,r.jsxs)("div",{className:"mt-2 text-gray-500 text-sm flex items-center",onClick:()=>h([]),children:[(0,r.jsx)(x.Z,{className:"mr-2"}),(0,r.jsx)("span",{children:null===(t=m[0])||void 0===t?void 0:t.name})]})]})})},N=function(e){let{onComplete:t}=e,{currentDialogue:n,scene:l,chatId:a}=(0,c.useContext)(o.p);return"chat_excel"!==l?null:(0,r.jsx)("div",{className:"max-w-md h-full relative",children:n?(0,r.jsxs)("div",{className:"flex h-8 overflow-hidden rounded",children:[(0,r.jsx)("div",{className:"flex items-center justify-center px-2 bg-gray-600 text-lg",children:(0,r.jsx)(x.Z,{className:"text-white"})}),(0,r.jsx)("div",{className:"flex items-center justify-center px-3 bg-gray-100 text-xs rounded-tr rounded-br dark:text-gray-800 truncate",children:n.select_param})]}):(0,r.jsx)(Z,{convUid:a,chatMode:l,onComplete:t})})},C=n(87213),S=n(51921),P=n(9158),R=function(){let{scene:e,dbParam:t,setDbParam:n}=(0,c.useContext)(o.p),[l,a]=(0,c.useState)([]);(0,P.Z)(async()=>{let[,t]=await (0,f.Vx)((0,f.vD)(e));a(null!=t?t:[])},[e]);let i=(0,c.useMemo)(()=>{var e;return null===(e=l.map)||void 0===e?void 0:e.call(l,e=>({name:e.param,...S.S$[e.type]}))},[l]);return((0,c.useEffect)(()=>{(null==i?void 0:i.length)&&!t&&n(i[0].name)},[i,n,t]),null==i?void 0:i.length)?(0,r.jsx)(m.default,{value:t,className:"w-36",onChange:e=>{n(e)},children:i.map(e=>(0,r.jsxs)(m.default.Option,{children:[(0,r.jsx)(C.Z,{width:24,height:24,src:e.icon,label:e.label,className:"w-[1.5em] h-[1.5em] mr-1 inline-block mt-[-4px]"}),e.name]},e.name))}):null},E=function(e){let{refreshHistory:t,modelChange:n}=e,{scene:a,refreshDialogList:i}=(0,c.useContext)(o.p);return(0,r.jsxs)("div",{className:"w-full py-2 px-4 md:px-4 flex flex-wrap items-center justify-center gap-1 md:gap-4",children:[(0,r.jsx)(l.Z,{onChange:n}),(0,r.jsx)(R,{}),"chat_excel"===a&&(0,r.jsx)(N,{onComplete:()=>{null==i||i(),null==t||t()}}),"chat_agent"===a&&(0,r.jsx)(p,{}),(0,r.jsx)(u,{})]})}},21667:function(e,t,n){"use strict";n.d(t,{A:function(){return f}});var r=n(52676),o=n(40330),l=n(22877),a=n(25675),i=n(97858),s=n.n(i),d=n(75271),c=n(24841);let u="/models/huggingface.svg";function f(e,t){var n,o;let{width:a,height:i}=t||{};return e?(0,r.jsx)(s(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:a||24,height:i||24,src:(null===(n=l.Hf[e])||void 0===n?void 0:n.icon)||u,alt:"llm"},(null===(o=l.Hf[e])||void 0===o?void 0:o.icon)||u):null}t.Z=function(e){let{onChange:t}=e,{t:n}=(0,c.$G)(),{modelList:i,model:s}=(0,d.useContext)(o.p);return!i||i.length<=0?null:(0,r.jsx)(a.default,{value:s,placeholder:n("choose_model"),className:"w-52",onChange:e=>{null==t||t(e)},children:i.map(e=>{var t;return(0,r.jsx)(a.default.Option,{children:(0,r.jsxs)("div",{className:"flex items-center",children:[f(e),(0,r.jsx)("span",{className:"ml-2",children:(null===(t=l.Hf[e])||void 0===t?void 0:t.label)||e})]})},e)})})}},421:function(e,t,n){"use strict";let r;n.d(t,{Z:function(){return m}});var o=n(52676),l=n(40330),a=n(51921),i=n(33967),s=n(4861),d=n(84875),c=n.n(d),u=n(26187),f=n(75271);async function g(){window.obMonaco={getWorkerUrl:e=>{switch(e){case"mysql":return location.origin+"/_next/static/ob-workers/mysql.js";case"obmysql":return location.origin+"/_next/static/ob-workers/obmysql.js";case"oboracle":return location.origin+"/_next/static/ob-workers/oracle.js"}return""}};let e=await n.e(5013).then(n.bind(n,5013)),t=e.default;return r||(r=new t).setup(["mysql"]),r}function m(e){let{className:t,value:n,language:r="mysql",onChange:d,thoughts:u,session:m}=e,h=(0,f.useMemo)(()=>"mysql"!==r?n:u&&u.length>0?(0,a._m)("-- ".concat(u," \n").concat(n)):(0,a._m)(n),[n,u]),p=(0,s.Z)(m),x=(0,f.useContext)(l.p);async function v(e){var t,n;let r=await g();r.setModelOptions((null===(t=e.getModel())||void 0===t?void 0:t.id)||"",function(e,t){let{_modelId:n,delimiter:r}=e;return{delimiter:r,async getTableList(e){var n;return(null==t?void 0:null===(n=t())||void 0===n?void 0:n.getTableList(e))||[]},async getTableColumns(e,n){var r;return(null==t?void 0:null===(r=t())||void 0===r?void 0:r.getTableColumns(e))||[]},async getSchemaList(){var e;return(null==t?void 0:null===(e=t())||void 0===e?void 0:e.getSchemaList())||[]}}}({modelId:(null===(n=e.getModel())||void 0===n?void 0:n.id)||"",delimiter:";"},()=>p.current||null))}return(0,o.jsx)(i.ZP,{className:c()(t),onMount:v,value:h,defaultLanguage:r,onChange:d,theme:(null==x?void 0:x.mode)!=="dark"?"github":"githubDark",options:{minimap:{enabled:!1},wordWrap:"on"}})}i._m.config({monaco:u}),u.editor.defineTheme("github",{base:"vs",inherit:!0,rules:[{background:"ffffff",token:""},{foreground:"6a737d",token:"comment"},{foreground:"6a737d",token:"punctuation.definition.comment"},{foreground:"6a737d",token:"string.comment"},{foreground:"005cc5",token:"constant"},{foreground:"005cc5",token:"entity.name.constant"},{foreground:"005cc5",token:"variable.other.constant"},{foreground:"005cc5",token:"variable.language"},{foreground:"6f42c1",token:"entity"},{foreground:"6f42c1",token:"entity.name"},{foreground:"24292e",token:"variable.parameter.function"},{foreground:"22863a",token:"entity.name.tag"},{foreground:"d73a49",token:"keyword"},{foreground:"d73a49",token:"storage"},{foreground:"d73a49",token:"storage.type"},{foreground:"24292e",token:"storage.modifier.package"},{foreground:"24292e",token:"storage.modifier.import"},{foreground:"24292e",token:"storage.type.java"},{foreground:"032f62",token:"string"},{foreground:"032f62",token:"punctuation.definition.string"},{foreground:"032f62",token:"string punctuation.section.embedded source"},{foreground:"005cc5",token:"support"},{foreground:"005cc5",token:"meta.property-name"},{foreground:"e36209",token:"variable"},{foreground:"24292e",token:"variable.other"},{foreground:"b31d28",fontStyle:"bold italic underline",token:"invalid.broken"},{foreground:"b31d28",fontStyle:"bold italic underline",token:"invalid.deprecated"},{foreground:"fafbfc",background:"b31d28",fontStyle:"italic underline",token:"invalid.illegal"},{foreground:"fafbfc",background:"d73a49",fontStyle:"italic underline",token:"carriage-return"},{foreground:"b31d28",fontStyle:"bold italic underline",token:"invalid.unimplemented"},{foreground:"b31d28",token:"message.error"},{foreground:"24292e",token:"string source"},{foreground:"005cc5",token:"string variable"},{foreground:"032f62",token:"source.regexp"},{foreground:"032f62",token:"string.regexp"},{foreground:"032f62",token:"string.regexp.character-class"},{foreground:"032f62",token:"string.regexp constant.character.escape"},{foreground:"032f62",token:"string.regexp source.ruby.embedded"},{foreground:"032f62",token:"string.regexp string.regexp.arbitrary-repitition"},{foreground:"22863a",fontStyle:"bold",token:"string.regexp constant.character.escape"},{foreground:"005cc5",token:"support.constant"},{foreground:"005cc5",token:"support.variable"},{foreground:"005cc5",token:"meta.module-reference"},{foreground:"735c0f",token:"markup.list"},{foreground:"005cc5",fontStyle:"bold",token:"markup.heading"},{foreground:"005cc5",fontStyle:"bold",token:"markup.heading entity.name"},{foreground:"22863a",token:"markup.quote"},{foreground:"24292e",fontStyle:"italic",token:"markup.italic"},{foreground:"24292e",fontStyle:"bold",token:"markup.bold"},{foreground:"005cc5",token:"markup.raw"},{foreground:"b31d28",background:"ffeef0",token:"markup.deleted"},{foreground:"b31d28",background:"ffeef0",token:"meta.diff.header.from-file"},{foreground:"b31d28",background:"ffeef0",token:"punctuation.definition.deleted"},{foreground:"22863a",background:"f0fff4",token:"markup.inserted"},{foreground:"22863a",background:"f0fff4",token:"meta.diff.header.to-file"},{foreground:"22863a",background:"f0fff4",token:"punctuation.definition.inserted"},{foreground:"e36209",background:"ffebda",token:"markup.changed"},{foreground:"e36209",background:"ffebda",token:"punctuation.definition.changed"},{foreground:"f6f8fa",background:"005cc5",token:"markup.ignored"},{foreground:"f6f8fa",background:"005cc5",token:"markup.untracked"},{foreground:"6f42c1",fontStyle:"bold",token:"meta.diff.range"},{foreground:"005cc5",token:"meta.diff.header"},{foreground:"005cc5",fontStyle:"bold",token:"meta.separator"},{foreground:"005cc5",token:"meta.output"},{foreground:"586069",token:"brackethighlighter.tag"},{foreground:"586069",token:"brackethighlighter.curly"},{foreground:"586069",token:"brackethighlighter.round"},{foreground:"586069",token:"brackethighlighter.square"},{foreground:"586069",token:"brackethighlighter.angle"},{foreground:"586069",token:"brackethighlighter.quote"},{foreground:"b31d28",token:"brackethighlighter.unmatched"},{foreground:"b31d28",token:"sublimelinter.mark.error"},{foreground:"e36209",token:"sublimelinter.mark.warning"},{foreground:"959da5",token:"sublimelinter.gutter-mark"},{foreground:"032f62",fontStyle:"underline",token:"constant.other.reference.link"},{foreground:"032f62",fontStyle:"underline",token:"string.other.link"}],colors:{"editor.foreground":"#24292e","editor.background":"#ffffff","editor.selectionBackground":"#c8c8fa","editor.inactiveSelectionBackground":"#fafbfc","editor.lineHighlightBackground":"#fafbfc","editorCursor.foreground":"#24292e","editorWhitespace.foreground":"#959da5","editorIndentGuide.background":"#959da5","editorIndentGuide.activeBackground":"#24292e","editor.selectionHighlightBorder":"#fafbfc"}}),u.editor.defineTheme("githubDark",{base:"vs-dark",inherit:!0,rules:[{background:"24292e",token:""},{foreground:"959da5",token:"comment"},{foreground:"959da5",token:"punctuation.definition.comment"},{foreground:"959da5",token:"string.comment"},{foreground:"c8e1ff",token:"constant"},{foreground:"c8e1ff",token:"entity.name.constant"},{foreground:"c8e1ff",token:"variable.other.constant"},{foreground:"c8e1ff",token:"variable.language"},{foreground:"b392f0",token:"entity"},{foreground:"b392f0",token:"entity.name"},{foreground:"f6f8fa",token:"variable.parameter.function"},{foreground:"7bcc72",token:"entity.name.tag"},{foreground:"ea4a5a",token:"keyword"},{foreground:"ea4a5a",token:"storage"},{foreground:"ea4a5a",token:"storage.type"},{foreground:"f6f8fa",token:"storage.modifier.package"},{foreground:"f6f8fa",token:"storage.modifier.import"},{foreground:"f6f8fa",token:"storage.type.java"},{foreground:"79b8ff",token:"string"},{foreground:"79b8ff",token:"punctuation.definition.string"},{foreground:"79b8ff",token:"string punctuation.section.embedded source"},{foreground:"c8e1ff",token:"support"},{foreground:"c8e1ff",token:"meta.property-name"},{foreground:"fb8532",token:"variable"},{foreground:"f6f8fa",token:"variable.other"},{foreground:"d73a49",fontStyle:"bold italic underline",token:"invalid.broken"},{foreground:"d73a49",fontStyle:"bold italic underline",token:"invalid.deprecated"},{foreground:"fafbfc",background:"d73a49",fontStyle:"italic underline",token:"invalid.illegal"},{foreground:"fafbfc",background:"d73a49",fontStyle:"italic underline",token:"carriage-return"},{foreground:"d73a49",fontStyle:"bold italic underline",token:"invalid.unimplemented"},{foreground:"d73a49",token:"message.error"},{foreground:"f6f8fa",token:"string source"},{foreground:"c8e1ff",token:"string variable"},{foreground:"79b8ff",token:"source.regexp"},{foreground:"79b8ff",token:"string.regexp"},{foreground:"79b8ff",token:"string.regexp.character-class"},{foreground:"79b8ff",token:"string.regexp constant.character.escape"},{foreground:"79b8ff",token:"string.regexp source.ruby.embedded"},{foreground:"79b8ff",token:"string.regexp string.regexp.arbitrary-repitition"},{foreground:"7bcc72",fontStyle:"bold",token:"string.regexp constant.character.escape"},{foreground:"c8e1ff",token:"support.constant"},{foreground:"c8e1ff",token:"support.variable"},{foreground:"c8e1ff",token:"meta.module-reference"},{foreground:"fb8532",token:"markup.list"},{foreground:"0366d6",fontStyle:"bold",token:"markup.heading"},{foreground:"0366d6",fontStyle:"bold",token:"markup.heading entity.name"},{foreground:"c8e1ff",token:"markup.quote"},{foreground:"f6f8fa",fontStyle:"italic",token:"markup.italic"},{foreground:"f6f8fa",fontStyle:"bold",token:"markup.bold"},{foreground:"c8e1ff",token:"markup.raw"},{foreground:"b31d28",background:"ffeef0",token:"markup.deleted"},{foreground:"b31d28",background:"ffeef0",token:"meta.diff.header.from-file"},{foreground:"b31d28",background:"ffeef0",token:"punctuation.definition.deleted"},{foreground:"176f2c",background:"f0fff4",token:"markup.inserted"},{foreground:"176f2c",background:"f0fff4",token:"meta.diff.header.to-file"},{foreground:"176f2c",background:"f0fff4",token:"punctuation.definition.inserted"},{foreground:"b08800",background:"fffdef",token:"markup.changed"},{foreground:"b08800",background:"fffdef",token:"punctuation.definition.changed"},{foreground:"2f363d",background:"959da5",token:"markup.ignored"},{foreground:"2f363d",background:"959da5",token:"markup.untracked"},{foreground:"b392f0",fontStyle:"bold",token:"meta.diff.range"},{foreground:"c8e1ff",token:"meta.diff.header"},{foreground:"0366d6",fontStyle:"bold",token:"meta.separator"},{foreground:"0366d6",token:"meta.output"},{foreground:"ffeef0",token:"brackethighlighter.tag"},{foreground:"ffeef0",token:"brackethighlighter.curly"},{foreground:"ffeef0",token:"brackethighlighter.round"},{foreground:"ffeef0",token:"brackethighlighter.square"},{foreground:"ffeef0",token:"brackethighlighter.angle"},{foreground:"ffeef0",token:"brackethighlighter.quote"},{foreground:"d73a49",token:"brackethighlighter.unmatched"},{foreground:"d73a49",token:"sublimelinter.mark.error"},{foreground:"fb8532",token:"sublimelinter.mark.warning"},{foreground:"6a737d",token:"sublimelinter.gutter-mark"},{foreground:"79b8ff",fontStyle:"underline",token:"constant.other.reference.link"},{foreground:"79b8ff",fontStyle:"underline",token:"string.other.link"}],colors:{"editor.foreground":"#f6f8fa","editor.background":"#24292e","editor.selectionBackground":"#4c2889","editor.inactiveSelectionBackground":"#444d56","editor.lineHighlightBackground":"#444d56","editorCursor.foreground":"#ffffff","editorWhitespace.foreground":"#6a737d","editorIndentGuide.background":"#6a737d","editorIndentGuide.activeBackground":"#f6f8fa","editor.selectionHighlightBorder":"#444d56"}})},14425:function(e,t,n){"use strict";var r=n(52676),o=n(32133),l=n(25377),a=n(84875),i=n.n(a),s=n(24841);t.Z=function(e){let{className:t,error:n,description:a,refresh:d}=e,{t:c}=(0,s.$G)();return(0,r.jsx)(o.Z,{image:"/empty.png",imageStyle:{width:320,height:196,margin:"0 auto",maxWidth:"100%",maxHeight:"100%"},className:i()("flex items-center justify-center flex-col h-full w-full",t),description:n?(0,r.jsx)(l.ZP,{type:"primary",onClick:d,children:c("try_again")}):null!=a?a:c("no_data")})}},87213:function(e,t,n){"use strict";var r=n(52676),o=n(97858),l=n.n(o);t.Z=function(e){let{src:t,label:n,width:o,height:a,className:i}=e;return(0,r.jsx)(l(),{className:"w-11 h-11 rounded-full mr-4 border border-gray-200 object-contain bg-white ".concat(i),width:o||44,height:a||44,src:t,alt:n||"db-icon"})}},99532:function(e,t,n){"use strict";var r=n(52676),o=n(77547);t.Z=function(e){let{visible:t}=e;return t?(0,r.jsx)("div",{className:"absolute w-full h-full top-0 left-0 flex justify-center items-center z-10 bg-white dark:bg-black bg-opacity-50 dark:bg-opacity-50 backdrop-blur-sm text-3xl animate-fade animate-duration-200",children:(0,r.jsx)(o.Z,{})}):null}},76657:function(e,t,n){"use strict";var r=n(14059);t.Z=()=>{var e;return JSON.parse(null!==(e=localStorage.getItem(r.C9))&&void 0!==e?e:"")}},46501:function(e,t,n){"use strict";var r=n(52676),o=n(22877),l=n(97858),a=n.n(l),i=n(75271);t.Z=(0,i.memo)(e=>{let{width:t,height:n,model:l}=e,s=(0,i.useMemo)(()=>(0,o.ab)(l||"huggingface"),[l]);return l?(0,r.jsx)(a(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:t||24,height:n||24,src:s,alt:"llm",priority:!0}):null})},14113:function(e,t,n){"use strict";n.r(t);var r=n(52676),o=n(270),l=n(44741),a=n(62621),i=n(30191),s=n(874),d=n.n(s),c=n(75271),u=n(21201);t.default=(0,c.memo)(()=>{var e;let{appInfo:t}=(0,c.useContext)(u.MobileChatContext),{message:n}=a.Z.useApp(),[s,f]=(0,c.useState)(0);if(!(null==t?void 0:t.app_code))return null;let g=async()=>{let e=d()("dingtalk://dingtalkclient/page/link?url=".concat(encodeURIComponent(location.href),"&pc_slide=true"));n[e?"success":"error"](e?"复制成功":"复制失败")};return s>6&&n.info(JSON.stringify(window.navigator.userAgent),2,()=>{f(0)}),(0,r.jsxs)("header",{className:"flex w-full items-center justify-between bg-[rgba(255,255,255,0.9)] border dark:bg-black dark:border-[rgba(255,255,255,0.6)] rounded-xl mx-auto px-4 py-2 mb-4 sticky top-4 z-50 mt-4 shadow-md",children:[(0,r.jsxs)("div",{className:"flex gap-2 items-center",onClick:()=>f(s+1),children:[(0,r.jsx)(o.Z,{scene:(null==t?void 0:null===(e=t.team_context)||void 0===e?void 0:e.chat_scene)||"chat_agent",width:8,height:8}),(0,r.jsxs)("div",{className:"flex flex-col ml-2",children:[(0,r.jsx)(i.Z.Text,{className:"text-md font-bold line-clamp-2",children:null==t?void 0:t.app_name}),(0,r.jsx)(i.Z.Text,{className:"text-sm line-clamp-2",children:null==t?void 0:t.app_describe})]})]}),(0,r.jsx)("div",{onClick:g,className:"flex items-center justify-center w-10 h-10 bg-[#ffffff99] dark:bg-[rgba(255,255,255,0.2)] border border-white dark:border-[rgba(255,255,255,0.2)] rounded-[50%] cursor-pointer",children:(0,r.jsx)(l.Z,{className:"text-lg"})})]})})},49484:function(e,t,n){"use strict";n.r(t);var r=n(52676),o=n(16019),l=n(51921),a=n(14059),i=n(37903),s=n(59849),d=n(77547),c=n(39150),u=n(83058),f=n(63464),g=n(10901),m=n(19652),h=n(69208),p=n(7806),x=n(63688),v=n(25377),b=n(84875),k=n.n(b),j=n(98844),y=n(75271),w=n(21201),_=n(84663),Z=n(72717),N=n(6656);let C=["magenta","orange","geekblue","purple","cyan","green"];t.default=()=>{var e,t;let n=(0,j.useSearchParams)(),b=null!==(t=null==n?void 0:n.get("ques"))&&void 0!==t?t:"",{history:S,model:P,scene:R,temperature:E,resource:M,conv_uid:O,appInfo:I,scrollViewRef:D,order:q,userInput:L,ctrl:T,canAbort:F,canNewChat:U,setHistory:V,setCanNewChat:A,setCarAbort:$,setUserInput:H}=(0,y.useContext)(w.MobileChatContext),[z,B]=(0,y.useState)(!1),[J,G]=(0,y.useState)(!1),W=async e=>{var t,n,r;H(""),T.current=new AbortController;let o={chat_mode:R,model_name:P,user_input:e||L,conv_uid:O,temperature:E,app_code:null==I?void 0:I.app_code,...M&&{select_param:JSON.stringify(M)}};if(S&&S.length>0){let e=null==S?void 0:S.filter(e=>"view"===e.role);q.current=e[e.length-1].order+1}let i=[{role:"human",context:e||L,model_name:P,order:q.current,time_stamp:0},{role:"view",context:"",model_name:P,order:q.current,time_stamp:0,thinking:!0}],s=i.length-1;V([...S,...i]),A(!1);try{await (0,f.L)("".concat((t="http://localhost:7777",void 0!==t)?t:"","/api/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",[a.gp]:null!==(n=(0,l.n5)())&&void 0!==n?n:""},signal:T.current.signal,body:JSON.stringify(o),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===f.a)return},onclose(){var e;null===(e=T.current)||void 0===e||e.abort(),A(!0),$(!1)},onerror(e){throw Error(e)},onmessage:e=>{let t=e.data;try{t=JSON.parse(t).vis}catch(e){t.replaceAll("\\n","\n")}"[DONE]"===t?(A(!0),$(!1)):(null==t?void 0:t.startsWith("[ERROR]"))?(i[s].context=null==t?void 0:t.replace("[ERROR]",""),i[s].thinking=!1,V([...S,...i]),A(!0),$(!1)):($(!0),i[s].context=t,i[s].thinking=!1,V([...S,...i]))}})}catch(e){null===(r=T.current)||void 0===r||r.abort(),i[s].context="Sorry, we meet some error, please try again later.",i[s].thinking=!1,V([...i]),A(!0),$(!1)}},K=async()=>{L.trim()&&U&&await W()};(0,y.useEffect)(()=>{var e,t;null===(e=D.current)||void 0===e||e.scrollTo({top:null===(t=D.current)||void 0===t?void 0:t.scrollHeight,behavior:"auto"})},[S,D]);let Q=(0,y.useMemo)(()=>{if(!I)return[];let{param_need:e=[]}=I;return null==e?void 0:e.map(e=>e.type)},[I]),X=(0,y.useMemo)(()=>{var e;return 0===S.length&&I&&!!(null==I?void 0:null===(e=I.recommend_questions)||void 0===e?void 0:e.length)},[S,I]),{run:Y,loading:ee}=(0,g.Z)(async()=>await (0,o.Vx)((0,o.zR)(O)),{manual:!0,onSuccess:()=>{V([])}});return(0,y.useEffect)(()=>{b&&P&&O&&I&&W(b)},[I,O,P,b]),(0,r.jsxs)("div",{className:"flex flex-col",children:[X&&(0,r.jsx)("ul",{children:null==I?void 0:null===(e=I.recommend_questions)||void 0===e?void 0:e.map((e,t)=>(0,r.jsx)("li",{className:"mb-3",children:(0,r.jsx)(m.Z,{color:C[t],className:"p-2 rounded-xl",onClick:async()=>{W(e.question)},children:e.question})},e.id))}),(0,r.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,r.jsxs)("div",{className:"flex gap-2 mb-1 w-full overflow-x-auto",children:[(null==Q?void 0:Q.includes("model"))&&(0,r.jsx)(_.default,{}),(null==Q?void 0:Q.includes("resource"))&&(0,r.jsx)(Z.default,{}),(null==Q?void 0:Q.includes("temperature"))&&(0,r.jsx)(N.default,{})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between text-lg font-bold",children:[(0,r.jsx)(h.Z,{content:"暂停回复",trigger:["hover"],children:(0,r.jsx)(i.Z,{className:k()("p-2 cursor-pointer",{"text-[#0c75fc]":F,"text-gray-400":!F}),onClick:()=>{var e;F&&(null===(e=T.current)||void 0===e||e.abort(),setTimeout(()=>{$(!1),A(!0)},100))}})}),(0,r.jsx)(h.Z,{content:"再来一次",trigger:["hover"],children:(0,r.jsx)(s.Z,{className:k()("p-2 cursor-pointer",{"text-gray-400":!S.length||!U}),onClick:()=>{var e,t;if(!U||0===S.length)return;let n=null===(e=null===(t=S.filter(e=>"human"===e.role))||void 0===t?void 0:t.slice(-1))||void 0===e?void 0:e[0];W((null==n?void 0:n.context)||"")}})}),ee?(0,r.jsx)(p.Z,{spinning:ee,indicator:(0,r.jsx)(d.Z,{style:{fontSize:18},spin:!0}),className:"p-2"}):(0,r.jsx)(h.Z,{content:"清除历史",trigger:["hover"],children:(0,r.jsx)(c.Z,{className:k()("p-2 cursor-pointer",{"text-gray-400":!S.length||!U}),onClick:()=>{U&&Y()}})})]})]}),(0,r.jsxs)("div",{className:k()("flex py-2 px-3 items-center justify-between bg-white dark:bg-[#242733] dark:border-[#6f7f95] rounded-xl border",{"border-[#0c75fc] dark:border-[rgba(12,117,252,0.8)]":z}),children:[(0,r.jsx)(x.default.TextArea,{placeholder:"可以问我任何问题",className:"w-full resize-none border-0 p-0 focus:shadow-none",value:L,autoSize:{minRows:1},onKeyDown:e=>{if("Enter"===e.key&&!e.shiftKey){if(J){e.preventDefault();return}L.trim()&&(e.preventDefault(),K())}},onChange:e=>{H(e.target.value)},onFocus:()=>{B(!0)},onBlur:()=>B(!1),onCompositionStartCapture:()=>{G(!0)},onCompositionEndCapture:()=>{setTimeout(()=>{G(!1)},0)}}),(0,r.jsx)(v.ZP,{type:"primary",className:k()("flex items-center justify-center rounded-lg bg-button-gradient border-0 ml-2",{"opacity-40 cursor-not-allowed":!L.trim()||!U}),onClick:K,children:U?(0,r.jsx)(u.Z,{}):(0,r.jsx)(p.Z,{indicator:(0,r.jsx)(d.Z,{className:"text-white"})})})]})]})}},84663:function(e,t,n){"use strict";n.r(t);var r=n(52676),o=n(40330),l=n(46501),a=n(67629),i=n(42962),s=n(69208),d=n(75271),c=n(21201);t.default=()=>{let{modelList:e}=(0,d.useContext)(o.p),{model:t,setModel:n}=(0,d.useContext)(c.MobileChatContext),u=(0,d.useMemo)(()=>e.length>0?e.map(e=>({label:(0,r.jsxs)("div",{className:"flex items-center gap-2",onClick:()=>{n(e)},children:[(0,r.jsx)(l.Z,{width:14,height:14,model:e}),(0,r.jsx)("span",{className:"text-xs",children:e})]}),key:e})):[],[e,n]);return(0,r.jsx)(i.Z,{menu:{items:u},placement:"top",trigger:["click"],children:(0,r.jsx)(s.Z,{content:t,children:(0,r.jsxs)("div",{className:"flex items-center gap-1 border rounded-xl bg-white dark:bg-black p-2 flex-shrink-0",children:[(0,r.jsx)(l.Z,{width:16,height:16,model:t}),(0,r.jsx)("span",{className:"text-xs font-medium line-clamp-1",style:{maxWidth:96},children:t}),(0,r.jsx)(a.Z,{rotate:90})]})})})}},95873:function(e,t,n){"use strict";n.r(t);var r=n(52676),o=n(97858),l=n.n(o),a=n(75271);t.default=(0,a.memo)(e=>{let{width:t,height:n,src:o,label:a}=e;return(0,r.jsx)(l(),{width:t||14,height:n||14,src:o,alt:a||"db-icon",priority:!0})})},72717:function(e,t,n){"use strict";n.r(t);var r=n(52676),o=n(16019),l=n(15543),a=n(51921),i=n(77547),s=n(67629),d=n(85408),c=n(10901),u=n(7806),f=n(45467),g=n(42962),m=n(75271),h=n(21201),p=n(95873);t.default=()=>{let{appInfo:e,resourceList:t,scene:n,model:x,conv_uid:v,getChatHistoryRun:b,setResource:k,resource:j}=(0,m.useContext)(h.MobileChatContext),{temperatureValue:y,maxNewTokensValue:w}=(0,m.useContext)(l.ChatContentContext),[_,Z]=(0,m.useState)(null),N=(0,m.useMemo)(()=>{var t,n,r;return null===(t=null==e?void 0:null===(n=e.param_need)||void 0===n?void 0:n.filter(e=>"resource"===e.type))||void 0===t?void 0:null===(r=t[0])||void 0===r?void 0:r.value},[e]),C=(0,m.useMemo)(()=>t&&t.length>0?t.map(e=>({label:(0,r.jsxs)("div",{className:"flex items-center gap-2",onClick:()=>{Z(e),k(e.space_id||e.param)},children:[(0,r.jsx)(p.default,{width:14,height:14,src:a.S$[e.type].icon,label:a.S$[e.type].label}),(0,r.jsx)("span",{className:"text-xs",children:e.param})]}),key:e.space_id||e.param})):[],[t,k]),{run:S,loading:P}=(0,c.Z)(async e=>{let[,t]=await (0,o.Vx)((0,o.qn)({convUid:v,chatMode:n,data:e,model:x,temperatureValue:y,maxNewTokensValue:w,config:{timeout:36e5}}));return k(t),t},{manual:!0,onSuccess:async()=>{await b()}}),R=async e=>{let t=new FormData;t.append("doc_file",null==e?void 0:e.file),await S(t)},E=(0,m.useMemo)(()=>P?(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(u.Z,{size:"small",indicator:(0,r.jsx)(i.Z,{spin:!0})}),(0,r.jsx)("span",{className:"text-xs",children:"上传中"})]}):j?(0,r.jsxs)("div",{className:"flex gap-1",children:[(0,r.jsx)("span",{className:"text-xs",children:j.file_name}),(0,r.jsx)(s.Z,{rotate:90})]}):(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(d.Z,{className:"text-base"}),(0,r.jsx)("span",{className:"text-xs",children:"上传文件"})]}),[P,j]);return(0,r.jsx)(r.Fragment,{children:(()=>{switch(N){case"excel_file":case"text_file":case"image_file":return(0,r.jsx)("div",{className:"flex items-center justify-center gap-1 border rounded-xl bg-white dark:bg-black px-2 flex-shrink-0",children:(0,r.jsx)(f.default,{name:"file",accept:".xlsx,.xls",maxCount:1,showUploadList:!1,beforeUpload:()=>!1,onChange:R,className:"flex h-full w-full items-center justify-center",children:E})});case"database":case"knowledge":case"plugin":case"awel_flow":var e,n,o,l,i;if(!(null==t?void 0:t.length))return null;return(0,r.jsx)(g.Z,{menu:{items:C},placement:"top",trigger:["click"],children:(0,r.jsxs)("div",{className:"flex items-center gap-1 border rounded-xl bg-white dark:bg-black p-2 flex-shrink-0",children:[(0,r.jsx)(p.default,{width:14,height:14,src:null===(e=a.S$[(null==_?void 0:_.type)||(null==t?void 0:null===(n=t[0])||void 0===n?void 0:n.type)])||void 0===e?void 0:e.icon,label:null===(o=a.S$[(null==_?void 0:_.type)||(null==t?void 0:null===(l=t[0])||void 0===l?void 0:l.type)])||void 0===o?void 0:o.label}),(0,r.jsx)("span",{className:"text-xs font-medium",children:(null==_?void 0:_.param)||(null==t?void 0:null===(i=t[0])||void 0===i?void 0:i.param)}),(0,r.jsx)(s.Z,{rotate:90})]})})}})()})}},6656:function(e,t,n){"use strict";n.r(t);var r=n(52676),o=n(23794),l=n(42962),a=n(73810),i=n(75271),s=n(21201);t.default=()=>{let{temperature:e,setTemperature:t}=(0,i.useContext)(s.MobileChatContext),n=e=>{isNaN(e)||t(e)};return(0,r.jsx)(l.Z,{trigger:["click"],dropdownRender:()=>(0,r.jsx)("div",{className:"flex h-28 bg-white dark:bg-[rgba(255,255,255,0.5)] items-center justify-center rounded-xl py-3",children:(0,r.jsx)(a.Z,{defaultValue:.5,max:1,min:0,step:.1,vertical:!0,onChange:n,value:e})}),placement:"top",children:(0,r.jsxs)("div",{className:"flex items-center justify-between border rounded-xl bg-white dark:bg-black w-14 p-2 flex-shrink-0",children:[(0,r.jsx)(o.Z,{type:"icon-icons-temperature",className:"text-sm"}),(0,r.jsx)("span",{className:"text-xs font-medium",children:e})]})})}},21201:function(e,t,n){"use strict";n.r(t),n.d(t,{MobileChatContext:function(){return b}});var r=n(52676),o=n(40330),l=n(16019),a=n(76657),i=n(51921),s=n(14059),d=n(63464),c=n(10901),u=n(7806),f=n(52373),g=n.n(f),m=n(98844),h=n(75271),p=n(14113),x=n(49484);let v=g()(()=>Promise.all([n.e(8201),n.e(3732),n.e(4130),n.e(4521),n.e(7475),n.e(5745),n.e(9066),n.e(5675),n.e(7004),n.e(3894),n.e(1502),n.e(3769),n.e(2763),n.e(8226),n.e(7827),n.e(9842),n.e(653),n.e(4186),n.e(7365),n.e(9658),n.e(4593),n.e(1917),n.e(6905),n.e(3431)]).then(n.bind(n,83431)),{loadableGenerated:{webpack:()=>[83431]},ssr:!1}),b=(0,h.createContext)({model:"",temperature:.5,resource:null,setModel:()=>{},setTemperature:()=>{},setResource:()=>{},scene:"",history:[],setHistory:()=>{},scrollViewRef:{current:null},appInfo:{},conv_uid:"",resourceList:[],order:{current:1},handleChat:()=>Promise.resolve(),canAbort:!1,setCarAbort:()=>{},canNewChat:!1,setCanNewChat:()=>{},ctrl:{current:void 0},userInput:"",setUserInput:()=>{},getChatHistoryRun:()=>{}});t.default=()=>{var e,t;let n=(0,m.useSearchParams)(),f=null!==(e=null==n?void 0:n.get("chat_scene"))&&void 0!==e?e:"",g=null!==(t=null==n?void 0:n.get("app_code"))&&void 0!==t?t:"",{modelList:k}=(0,h.useContext)(o.p),[j,y]=(0,h.useState)([]),[w,_]=(0,h.useState)(""),[Z,N]=(0,h.useState)(.5),[C,S]=(0,h.useState)(null),P=(0,h.useRef)(null),[R,E]=(0,h.useState)(""),[M,O]=(0,h.useState)(!1),[I,D]=(0,h.useState)(!0),q=(0,h.useRef)(),L=(0,h.useRef)(1),T=(0,a.Z)(),F=(0,h.useMemo)(()=>"".concat(null==T?void 0:T.user_no,"_").concat(g),[g,T]),{run:U,loading:V}=(0,c.Z)(async()=>await (0,l.Vx)((0,l.$i)("".concat(null==T?void 0:T.user_no,"_").concat(g))),{manual:!0,onSuccess:e=>{let[,t]=e,n=null==t?void 0:t.filter(e=>"view"===e.role);n&&n.length>0&&(L.current=n[n.length-1].order+1),y(t||[])}}),{data:A,run:$,loading:H}=(0,c.Z)(async e=>{let[,t]=await (0,l.Vx)((0,l.BN)(e));return null!=t?t:{}},{manual:!0}),{run:z,data:B,loading:J}=(0,c.Z)(async()=>{var e,t;let[,n]=await (0,l.Vx)((0,l.vD)(f));return S((null==n?void 0:null===(e=n[0])||void 0===e?void 0:e.space_id)||(null==n?void 0:null===(t=n[0])||void 0===t?void 0:t.param)),null!=n?n:[]},{manual:!0}),{run:G,loading:W}=(0,c.Z)(async()=>{let[,e]=await (0,l.Vx)((0,l.iP)());return null!=e?e:[]},{manual:!0,onSuccess:e=>{var t;let n=null===(t=null==e?void 0:e.filter(e=>e.conv_uid===F))||void 0===t?void 0:t[0];(null==n?void 0:n.select_param)&&S(JSON.parse(null==n?void 0:n.select_param))}});(0,h.useEffect)(()=>{f&&g&&k.length&&$({chat_scene:f,app_code:g})},[g,f,$,k]),(0,h.useEffect)(()=>{g&&U()},[g]),(0,h.useEffect)(()=>{if(k.length>0){var e,t,n;let r=null===(e=null==A?void 0:null===(t=A.param_need)||void 0===t?void 0:t.filter(e=>"model"===e.type))||void 0===e?void 0:null===(n=e[0])||void 0===n?void 0:n.value;_(r||k[0])}},[k,A]),(0,h.useEffect)(()=>{var e,t,n;let r=null===(e=null==A?void 0:null===(t=A.param_need)||void 0===t?void 0:t.filter(e=>"temperature"===e.type))||void 0===e?void 0:null===(n=e[0])||void 0===n?void 0:n.value;N(r||.5)},[A]),(0,h.useEffect)(()=>{if(f&&(null==A?void 0:A.app_code)){var e,t,n,r,o,l;let a=null===(e=null==A?void 0:null===(t=A.param_need)||void 0===t?void 0:t.filter(e=>"resource"===e.type))||void 0===e?void 0:null===(n=e[0])||void 0===n?void 0:n.value,i=null===(r=null==A?void 0:null===(o=A.param_need)||void 0===o?void 0:o.filter(e=>"resource"===e.type))||void 0===r?void 0:null===(l=r[0])||void 0===l?void 0:l.bind_value;i&&S(i),["database","knowledge","plugin","awel_flow"].includes(a)&&!i&&z()}},[A,f,z]);let K=async e=>{var t,n,r;E(""),q.current=new AbortController;let o={chat_mode:f,model_name:w,user_input:e||R,conv_uid:F,temperature:Z,app_code:null==A?void 0:A.app_code,...C&&{select_param:C}};if(j&&j.length>0){let e=null==j?void 0:j.filter(e=>"view"===e.role);L.current=e[e.length-1].order+1}let l=[{role:"human",context:e||R,model_name:w,order:L.current,time_stamp:0},{role:"view",context:"",model_name:w,order:L.current,time_stamp:0,thinking:!0}],a=l.length-1;y([...j,...l]),D(!1);try{await (0,d.L)("".concat((t="http://localhost:7777",void 0!==t)?t:"","/api/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",[s.gp]:null!==(n=(0,i.n5)())&&void 0!==n?n:""},signal:q.current.signal,body:JSON.stringify(o),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===d.a)return},onclose(){var e;null===(e=q.current)||void 0===e||e.abort(),D(!0),O(!1)},onerror(e){throw Error(e)},onmessage:e=>{let t=e.data;try{t=JSON.parse(t).vis}catch(e){t.replaceAll("\\n","\n")}"[DONE]"===t?(D(!0),O(!1)):(null==t?void 0:t.startsWith("[ERROR]"))?(l[a].context=null==t?void 0:t.replace("[ERROR]",""),l[a].thinking=!1,y([...j,...l]),D(!0),O(!1)):(O(!0),l[a].context=t,l[a].thinking=!1,y([...j,...l]))}})}catch(e){null===(r=q.current)||void 0===r||r.abort(),l[a].context="Sorry, we meet some error, please try again later.",l[a].thinking=!1,y([...l]),D(!0),O(!1)}};return(0,h.useEffect)(()=>{f&&"chat_agent"!==f&&G()},[f,G]),(0,r.jsx)(b.Provider,{value:{model:w,resource:C,setModel:_,setTemperature:N,setResource:S,temperature:Z,appInfo:A,conv_uid:F,scene:f,history:j,scrollViewRef:P,setHistory:y,resourceList:B,order:L,handleChat:K,setCanNewChat:D,ctrl:q,canAbort:M,setCarAbort:O,canNewChat:I,userInput:R,setUserInput:E,getChatHistoryRun:U},children:(0,r.jsx)(u.Z,{size:"large",className:"flex h-screen w-screen justify-center items-center max-h-screen",spinning:V||H||J||W,children:(0,r.jsxs)("div",{className:"flex flex-col h-screen bg-gradient-light dark:bg-gradient-dark p-4 pt-0",children:[(0,r.jsxs)("div",{ref:P,className:"flex flex-col flex-1 overflow-y-auto mb-3",children:[(0,r.jsx)(p.default,{}),(0,r.jsx)(v,{})]}),(null==A?void 0:A.app_code)&&(0,r.jsx)(x.default,{})]})})})}},20346:function(e,t,n){"use strict";n.d(t,{Tk:function(){return s},PR:function(){return d}});var r=n(51921),o=n(9349);n(32699);var l=n(14121);let a=l.default.create({baseURL:"http://localhost:7777"});a.defaults.timeout=1e4,a.interceptors.response.use(e=>e.data,e=>Promise.reject(e));let i={"content-type":"application/json","User-Id":(0,r.n5)()},s=(e,t)=>{if(t){let n=Object.keys(t).filter(e=>void 0!==t[e]&&""!==t[e]).map(e=>"".concat(e,"=").concat(t[e])).join("&");n&&(e+="?".concat(n))}return a.get("/api"+e,{headers:i}).then(e=>e).catch(e=>{o.ZP.error(e),Promise.reject(e)})},d=(e,t)=>a.post(e,t,{headers:i}).then(e=>e).catch(e=>{o.ZP.error(e),Promise.reject(e)})},51083:function(){}}]);