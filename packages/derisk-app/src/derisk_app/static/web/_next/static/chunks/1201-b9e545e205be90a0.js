"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1201],{14113:function(e,t,l){l.r(t);var n=l(52676),r=l(270),a=l(55391),i=l(2148),s=l(92157),o=l(874),c=l.n(o),d=l(75271),u=l(21201);t.default=(0,d.memo)(()=>{var e;let{appInfo:t}=(0,d.useContext)(u.MobileChatContext),{message:l}=i.Z.useApp(),[o,m]=(0,d.useState)(0);if(!(null==t?void 0:t.app_code))return null;let v=async()=>{let e=c()("dingtalk://dingtalkclient/page/link?url=".concat(encodeURIComponent(location.href),"&pc_slide=true"));l[e?"success":"error"](e?"复制成功":"复制失败")};return o>6&&l.info(JSON.stringify(window.navigator.userAgent),2,()=>{m(0)}),(0,n.jsxs)("header",{className:"flex w-full items-center justify-between bg-[rgba(255,255,255,0.9)] border dark:bg-black dark:border-[rgba(255,255,255,0.6)] rounded-xl mx-auto px-4 py-2 mb-4 sticky top-4 z-50 mt-4 shadow-md",children:[(0,n.jsxs)("div",{className:"flex gap-2 items-center",onClick:()=>m(o+1),children:[(0,n.jsx)(r.Z,{scene:(null==t?void 0:null===(e=t.team_context)||void 0===e?void 0:e.chat_scene)||"chat_agent",width:8,height:8}),(0,n.jsxs)("div",{className:"flex flex-col ml-2",children:[(0,n.jsx)(s.Z.Text,{className:"text-md font-bold line-clamp-2",children:null==t?void 0:t.app_name}),(0,n.jsx)(s.Z.Text,{className:"text-sm line-clamp-2",children:null==t?void 0:t.app_describe})]})]}),(0,n.jsx)("div",{onClick:v,className:"flex items-center justify-center w-10 h-10 bg-[#ffffff99] dark:bg-[rgba(255,255,255,0.2)] border border-white dark:border-[rgba(255,255,255,0.2)] rounded-[50%] cursor-pointer",children:(0,n.jsx)(a.Z,{className:"text-lg"})})]})})},49484:function(e,t,l){l.r(t);var n=l(52676),r=l(63384),a=l(51921),i=l(14059),s=l(6181),o=l(65351),c=l(79312),d=l(94752),u=l(47219),m=l(63464),v=l(58976),x=l(52977),p=l(35209),h=l(16116),f=l(7464),g=l(25433),b=l(82187),j=l.n(b),y=l(98844),w=l(75271),_=l(21201),N=l(84663),k=l(72717),C=l(6656);let Z=["magenta","orange","geekblue","purple","cyan","green"];t.default=()=>{var e,t;let l=(0,y.useSearchParams)(),b=null!==(t=null==l?void 0:l.get("ques"))&&void 0!==t?t:"",{history:S,model:R,scene:E,temperature:M,resource:O,conv_uid:T,appInfo:A,scrollViewRef:P,order:V,userInput:z,ctrl:D,canAbort:J,canNewChat:q,setHistory:H,setCanNewChat:I,setCarAbort:L,setUserInput:U}=(0,w.useContext)(_.MobileChatContext),[W,$]=(0,w.useState)(!1),[F,B]=(0,w.useState)(!1),K=async e=>{var t,l,n;U(""),D.current=new AbortController;let r={chat_mode:E,model_name:R,user_input:e||z,conv_uid:T,temperature:M,app_code:null==A?void 0:A.app_code,...O&&{select_param:JSON.stringify(O)}};if(S&&S.length>0){let e=null==S?void 0:S.filter(e=>"view"===e.role);V.current=e[e.length-1].order+1}let s=[{role:"human",context:e||z,model_name:R,order:V.current,time_stamp:0},{role:"view",context:"",model_name:R,order:V.current,time_stamp:0,thinking:!0}],o=s.length-1;H([...S,...s]),I(!1);try{await (0,m.L)("".concat((t="http://0.0.0.0:7777",void 0!==t)?t:"","/api/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",[i.gp]:null!==(l=(0,a.n5)())&&void 0!==l?l:""},signal:D.current.signal,body:JSON.stringify(r),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===m.a)return},onclose(){var e;null===(e=D.current)||void 0===e||e.abort(),I(!0),L(!1)},onerror(e){throw Error(e)},onmessage:e=>{let t=e.data;try{t=JSON.parse(t).vis}catch(e){t.replaceAll("\\n","\n")}"[DONE]"===t?(I(!0),L(!1)):(null==t?void 0:t.startsWith("[ERROR]"))?(s[o].context=null==t?void 0:t.replace("[ERROR]",""),s[o].thinking=!1,H([...S,...s]),I(!0),L(!1)):(L(!0),s[o].context=t,s[o].thinking=!1,H([...S,...s]))}})}catch(e){null===(n=D.current)||void 0===n||n.abort(),s[o].context="Sorry, we meet some error, please try again later.",s[o].thinking=!1,H([...s]),I(!0),L(!1)}},G=async()=>{z.trim()&&q&&await K()};(0,w.useEffect)(()=>{var e,t;null===(e=P.current)||void 0===e||e.scrollTo({top:null===(t=P.current)||void 0===t?void 0:t.scrollHeight,behavior:"auto"})},[S,P]);let Q=(0,w.useMemo)(()=>{if(!A)return[];let{param_need:e=[]}=A;return null==e?void 0:e.map(e=>e.type)},[A]),X=(0,w.useMemo)(()=>{var e;return 0===S.length&&A&&!!(null==A?void 0:null===(e=A.recommend_questions)||void 0===e?void 0:e.length)},[S,A]),{run:Y,loading:ee}=(0,v.Z)(async()=>await (0,r.Vx)((0,r.zR)(T)),{manual:!0,onSuccess:()=>{H([])}});return(0,w.useEffect)(()=>{b&&R&&T&&A&&K(b)},[A,T,R,b]),(0,n.jsxs)("div",{className:"flex flex-col",children:[X&&(0,n.jsx)("ul",{children:null==A?void 0:null===(e=A.recommend_questions)||void 0===e?void 0:e.map((e,t)=>(0,n.jsx)("li",{className:"mb-3",children:(0,n.jsx)(x.Z,{color:Z[t],className:"p-2 rounded-xl",onClick:async()=>{K(e.question)},children:e.question})},e.id))}),(0,n.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,n.jsxs)("div",{className:"flex gap-2 mb-1 w-full overflow-x-auto",children:[(null==Q?void 0:Q.includes("model"))&&(0,n.jsx)(N.default,{}),(null==Q?void 0:Q.includes("resource"))&&(0,n.jsx)(k.default,{}),(null==Q?void 0:Q.includes("temperature"))&&(0,n.jsx)(C.default,{})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between text-lg font-bold",children:[(0,n.jsx)(p.Z,{content:"暂停回复",trigger:["hover"],children:(0,n.jsx)(s.Z,{className:j()("p-2 cursor-pointer",{"text-[#0c75fc]":J,"text-gray-400":!J}),onClick:()=>{var e;J&&(null===(e=D.current)||void 0===e||e.abort(),setTimeout(()=>{L(!1),I(!0)},100))}})}),(0,n.jsx)(p.Z,{content:"再来一次",trigger:["hover"],children:(0,n.jsx)(o.Z,{className:j()("p-2 cursor-pointer",{"text-gray-400":!S.length||!q}),onClick:()=>{var e,t;if(!q||0===S.length)return;let l=null===(e=null===(t=S.filter(e=>"human"===e.role))||void 0===t?void 0:t.slice(-1))||void 0===e?void 0:e[0];K((null==l?void 0:l.context)||"")}})}),ee?(0,n.jsx)(h.Z,{spinning:ee,indicator:(0,n.jsx)(c.Z,{style:{fontSize:18},spin:!0}),className:"p-2"}):(0,n.jsx)(p.Z,{content:"清除历史",trigger:["hover"],children:(0,n.jsx)(d.Z,{className:j()("p-2 cursor-pointer",{"text-gray-400":!S.length||!q}),onClick:()=>{q&&Y()}})})]})]}),(0,n.jsxs)("div",{className:j()("flex py-2 px-3 items-center justify-between bg-white dark:bg-[#242733] dark:border-[#6f7f95] rounded-xl border",{"border-[#0c75fc] dark:border-[rgba(12,117,252,0.8)]":W}),children:[(0,n.jsx)(f.default.TextArea,{placeholder:"可以问我任何问题",className:"w-full resize-none border-0 p-0 focus:shadow-none",value:z,autoSize:{minRows:1},onKeyDown:e=>{if("Enter"===e.key&&!e.shiftKey){if(F){e.preventDefault();return}z.trim()&&(e.preventDefault(),G())}},onChange:e=>{U(e.target.value)},onFocus:()=>{$(!0)},onBlur:()=>$(!1),onCompositionStartCapture:()=>{B(!0)},onCompositionEndCapture:()=>{setTimeout(()=>{B(!1)},0)}}),(0,n.jsx)(g.ZP,{type:"primary",className:j()("flex items-center justify-center rounded-lg bg-button-gradient border-0 ml-2",{"opacity-40 cursor-not-allowed":!z.trim()||!q}),onClick:G,children:q?(0,n.jsx)(u.Z,{}):(0,n.jsx)(h.Z,{indicator:(0,n.jsx)(c.Z,{className:"text-white"})})})]})]})}},84663:function(e,t,l){l.r(t);var n=l(52676),r=l(40330),a=l(46501),i=l(22069),s=l(54929),o=l(35209),c=l(75271),d=l(21201);t.default=()=>{let{modelList:e}=(0,c.useContext)(r.p),{model:t,setModel:l}=(0,c.useContext)(d.MobileChatContext),u=(0,c.useMemo)(()=>e.length>0?e.map(e=>({label:(0,n.jsxs)("div",{className:"flex items-center gap-2",onClick:()=>{l(e)},children:[(0,n.jsx)(a.Z,{width:14,height:14,model:e}),(0,n.jsx)("span",{className:"text-xs",children:e})]}),key:e})):[],[e,l]);return(0,n.jsx)(s.Z,{menu:{items:u},placement:"top",trigger:["click"],children:(0,n.jsx)(o.Z,{content:t,children:(0,n.jsxs)("div",{className:"flex items-center gap-1 border rounded-xl bg-white dark:bg-black p-2 flex-shrink-0",children:[(0,n.jsx)(a.Z,{width:16,height:16,model:t}),(0,n.jsx)("span",{className:"text-xs font-medium line-clamp-1",style:{maxWidth:96},children:t}),(0,n.jsx)(i.Z,{rotate:90})]})})})}},95873:function(e,t,l){l.r(t);var n=l(52676),r=l(97858),a=l.n(r),i=l(75271);t.default=(0,i.memo)(e=>{let{width:t,height:l,src:r,label:i}=e;return(0,n.jsx)(a(),{width:t||14,height:l||14,src:r,alt:i||"db-icon",priority:!0})})},72717:function(e,t,l){l.r(t);var n=l(52676),r=l(63384),a=l(15543),i=l(51921),s=l(79312),o=l(22069),c=l(42808),d=l(58976),u=l(16116),m=l(29144),v=l(54929),x=l(75271),p=l(21201),h=l(95873);t.default=()=>{let{appInfo:e,resourceList:t,scene:l,model:f,conv_uid:g,getChatHistoryRun:b,setResource:j,resource:y}=(0,x.useContext)(p.MobileChatContext),{temperatureValue:w,maxNewTokensValue:_}=(0,x.useContext)(a.ChatContentContext),[N,k]=(0,x.useState)(null),C=(0,x.useMemo)(()=>{var t,l,n;return null===(t=null==e?void 0:null===(l=e.param_need)||void 0===l?void 0:l.filter(e=>"resource"===e.type))||void 0===t?void 0:null===(n=t[0])||void 0===n?void 0:n.value},[e]),Z=(0,x.useMemo)(()=>t&&t.length>0?t.map(e=>({label:(0,n.jsxs)("div",{className:"flex items-center gap-2",onClick:()=>{k(e),j(e.space_id||e.param)},children:[(0,n.jsx)(h.default,{width:14,height:14,src:i.S$[e.type].icon,label:i.S$[e.type].label}),(0,n.jsx)("span",{className:"text-xs",children:e.param})]}),key:e.space_id||e.param})):[],[t,j]),{run:S,loading:R}=(0,d.Z)(async e=>{let[,t]=await (0,r.Vx)((0,r.qn)({convUid:g,chatMode:l,data:e,model:f,temperatureValue:w,maxNewTokensValue:_,config:{timeout:36e5}}));return j(t),t},{manual:!0,onSuccess:async()=>{await b()}}),E=async e=>{let t=new FormData;t.append("doc_file",null==e?void 0:e.file),await S(t)},M=(0,x.useMemo)(()=>R?(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(u.Z,{size:"small",indicator:(0,n.jsx)(s.Z,{spin:!0})}),(0,n.jsx)("span",{className:"text-xs",children:"上传中"})]}):y?(0,n.jsxs)("div",{className:"flex gap-1",children:[(0,n.jsx)("span",{className:"text-xs",children:y.file_name}),(0,n.jsx)(o.Z,{rotate:90})]}):(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(c.Z,{className:"text-base"}),(0,n.jsx)("span",{className:"text-xs",children:"上传文件"})]}),[R,y]);return(0,n.jsx)(n.Fragment,{children:(()=>{switch(C){case"excel_file":case"text_file":case"image_file":return(0,n.jsx)("div",{className:"flex items-center justify-center gap-1 border rounded-xl bg-white dark:bg-black px-2 flex-shrink-0",children:(0,n.jsx)(m.default,{name:"file",accept:".xlsx,.xls",maxCount:1,showUploadList:!1,beforeUpload:()=>!1,onChange:E,className:"flex h-full w-full items-center justify-center",children:M})});case"database":case"knowledge":case"plugin":case"awel_flow":var e,l,r,a,s;if(!(null==t?void 0:t.length))return null;return(0,n.jsx)(v.Z,{menu:{items:Z},placement:"top",trigger:["click"],children:(0,n.jsxs)("div",{className:"flex items-center gap-1 border rounded-xl bg-white dark:bg-black p-2 flex-shrink-0",children:[(0,n.jsx)(h.default,{width:14,height:14,src:null===(e=i.S$[(null==N?void 0:N.type)||(null==t?void 0:null===(l=t[0])||void 0===l?void 0:l.type)])||void 0===e?void 0:e.icon,label:null===(r=i.S$[(null==N?void 0:N.type)||(null==t?void 0:null===(a=t[0])||void 0===a?void 0:a.type)])||void 0===r?void 0:r.label}),(0,n.jsx)("span",{className:"text-xs font-medium",children:(null==N?void 0:N.param)||(null==t?void 0:null===(s=t[0])||void 0===s?void 0:s.param)}),(0,n.jsx)(o.Z,{rotate:90})]})})}})()})}},6656:function(e,t,l){l.r(t);var n=l(52676),r=l(23794),a=l(54929),i=l(46967),s=l(75271),o=l(21201);t.default=()=>{let{temperature:e,setTemperature:t}=(0,s.useContext)(o.MobileChatContext),l=e=>{isNaN(e)||t(e)};return(0,n.jsx)(a.Z,{trigger:["click"],dropdownRender:()=>(0,n.jsx)("div",{className:"flex h-28 bg-white dark:bg-[rgba(255,255,255,0.5)] items-center justify-center rounded-xl py-3",children:(0,n.jsx)(i.Z,{defaultValue:.5,max:1,min:0,step:.1,vertical:!0,onChange:l,value:e})}),placement:"top",children:(0,n.jsxs)("div",{className:"flex items-center justify-between border rounded-xl bg-white dark:bg-black w-14 p-2 flex-shrink-0",children:[(0,n.jsx)(r.Z,{type:"icon-icons-temperature",className:"text-sm"}),(0,n.jsx)("span",{className:"text-xs font-medium",children:e})]})})}},21201:function(e,t,l){l.r(t),l.d(t,{MobileChatContext:function(){return b}});var n=l(52676),r=l(40330),a=l(63384),i=l(76657),s=l(51921),o=l(14059),c=l(63464),d=l(58976),u=l(16116),m=l(52373),v=l.n(m),x=l(98844),p=l(75271),h=l(14113),f=l(49484);let g=v()(()=>Promise.all([l.e(8201),l.e(3732),l.e(4130),l.e(4521),l.e(768),l.e(5745),l.e(9066),l.e(4745),l.e(1568),l.e(7707),l.e(9914),l.e(9308),l.e(2763),l.e(8226),l.e(8025),l.e(4186),l.e(8814),l.e(350),l.e(4965),l.e(6447),l.e(8889),l.e(163),l.e(2486),l.e(3431)]).then(l.bind(l,83431)),{loadableGenerated:{webpack:()=>[83431]},ssr:!1}),b=(0,p.createContext)({model:"",temperature:.5,resource:null,setModel:()=>{},setTemperature:()=>{},setResource:()=>{},scene:"",history:[],setHistory:()=>{},scrollViewRef:{current:null},appInfo:{},conv_uid:"",resourceList:[],order:{current:1},handleChat:()=>Promise.resolve(),canAbort:!1,setCarAbort:()=>{},canNewChat:!1,setCanNewChat:()=>{},ctrl:{current:void 0},userInput:"",setUserInput:()=>{},getChatHistoryRun:()=>{}});t.default=()=>{var e,t;let l=(0,x.useSearchParams)(),m=null!==(e=null==l?void 0:l.get("chat_scene"))&&void 0!==e?e:"",v=null!==(t=null==l?void 0:l.get("app_code"))&&void 0!==t?t:"",{modelList:j}=(0,p.useContext)(r.p),[y,w]=(0,p.useState)([]),[_,N]=(0,p.useState)(""),[k,C]=(0,p.useState)(.5),[Z,S]=(0,p.useState)(null),R=(0,p.useRef)(null),[E,M]=(0,p.useState)(""),[O,T]=(0,p.useState)(!1),[A,P]=(0,p.useState)(!0),V=(0,p.useRef)(),z=(0,p.useRef)(1),D=(0,i.Z)(),J=(0,p.useMemo)(()=>"".concat(null==D?void 0:D.user_no,"_").concat(v),[v,D]),{run:q,loading:H}=(0,d.Z)(async()=>await (0,a.Vx)((0,a.$i)("".concat(null==D?void 0:D.user_no,"_").concat(v))),{manual:!0,onSuccess:e=>{let[,t]=e,l=null==t?void 0:t.filter(e=>"view"===e.role);l&&l.length>0&&(z.current=l[l.length-1].order+1),w(t||[])}}),{data:I,run:L,loading:U}=(0,d.Z)(async e=>{let[,t]=await (0,a.Vx)((0,a.BN)(e));return null!=t?t:{}},{manual:!0}),{run:W,data:$,loading:F}=(0,d.Z)(async()=>{var e,t;let[,l]=await (0,a.Vx)((0,a.vD)(m));return S((null==l?void 0:null===(e=l[0])||void 0===e?void 0:e.space_id)||(null==l?void 0:null===(t=l[0])||void 0===t?void 0:t.param)),null!=l?l:[]},{manual:!0}),{run:B,loading:K}=(0,d.Z)(async()=>{let[,e]=await (0,a.Vx)((0,a.iP)());return null!=e?e:[]},{manual:!0,onSuccess:e=>{var t;let l=null===(t=null==e?void 0:e.filter(e=>e.conv_uid===J))||void 0===t?void 0:t[0];(null==l?void 0:l.select_param)&&S(JSON.parse(null==l?void 0:l.select_param))}});(0,p.useEffect)(()=>{m&&v&&j.length&&L({chat_scene:m,app_code:v})},[v,m,L,j]),(0,p.useEffect)(()=>{v&&q()},[v]),(0,p.useEffect)(()=>{if(j.length>0){var e,t,l;let n=null===(e=null==I?void 0:null===(t=I.param_need)||void 0===t?void 0:t.filter(e=>"model"===e.type))||void 0===e?void 0:null===(l=e[0])||void 0===l?void 0:l.value;N(n||j[0])}},[j,I]),(0,p.useEffect)(()=>{var e,t,l;let n=null===(e=null==I?void 0:null===(t=I.param_need)||void 0===t?void 0:t.filter(e=>"temperature"===e.type))||void 0===e?void 0:null===(l=e[0])||void 0===l?void 0:l.value;C(n||.5)},[I]),(0,p.useEffect)(()=>{if(m&&(null==I?void 0:I.app_code)){var e,t,l,n,r,a;let i=null===(e=null==I?void 0:null===(t=I.param_need)||void 0===t?void 0:t.filter(e=>"resource"===e.type))||void 0===e?void 0:null===(l=e[0])||void 0===l?void 0:l.value,s=null===(n=null==I?void 0:null===(r=I.param_need)||void 0===r?void 0:r.filter(e=>"resource"===e.type))||void 0===n?void 0:null===(a=n[0])||void 0===a?void 0:a.bind_value;s&&S(s),["database","knowledge","plugin","awel_flow"].includes(i)&&!s&&W()}},[I,m,W]);let G=async e=>{var t,l,n;M(""),V.current=new AbortController;let r={chat_mode:m,model_name:_,user_input:e||E,conv_uid:J,temperature:k,app_code:null==I?void 0:I.app_code,...Z&&{select_param:Z}};if(y&&y.length>0){let e=null==y?void 0:y.filter(e=>"view"===e.role);z.current=e[e.length-1].order+1}let a=[{role:"human",context:e||E,model_name:_,order:z.current,time_stamp:0},{role:"view",context:"",model_name:_,order:z.current,time_stamp:0,thinking:!0}],i=a.length-1;w([...y,...a]),P(!1);try{await (0,c.L)("".concat((t="http://0.0.0.0:7777",void 0!==t)?t:"","/api/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",[o.gp]:null!==(l=(0,s.n5)())&&void 0!==l?l:""},signal:V.current.signal,body:JSON.stringify(r),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===c.a)return},onclose(){var e;null===(e=V.current)||void 0===e||e.abort(),P(!0),T(!1)},onerror(e){throw Error(e)},onmessage:e=>{let t=e.data;try{t=JSON.parse(t).vis}catch(e){t.replaceAll("\\n","\n")}"[DONE]"===t?(P(!0),T(!1)):(null==t?void 0:t.startsWith("[ERROR]"))?(a[i].context=null==t?void 0:t.replace("[ERROR]",""),a[i].thinking=!1,w([...y,...a]),P(!0),T(!1)):(T(!0),a[i].context=t,a[i].thinking=!1,w([...y,...a]))}})}catch(e){null===(n=V.current)||void 0===n||n.abort(),a[i].context="Sorry, we meet some error, please try again later.",a[i].thinking=!1,w([...a]),P(!0),T(!1)}};return(0,p.useEffect)(()=>{m&&"chat_agent"!==m&&B()},[m,B]),(0,n.jsx)(b.Provider,{value:{model:_,resource:Z,setModel:N,setTemperature:C,setResource:S,temperature:k,appInfo:I,conv_uid:J,scene:m,history:y,scrollViewRef:R,setHistory:w,resourceList:$,order:z,handleChat:G,setCanNewChat:P,ctrl:V,canAbort:O,setCarAbort:T,canNewChat:A,userInput:E,setUserInput:M,getChatHistoryRun:q},children:(0,n.jsx)(u.Z,{size:"large",className:"flex h-screen w-screen justify-center items-center max-h-screen",spinning:H||U||F||K,children:(0,n.jsxs)("div",{className:"flex flex-col h-screen bg-gradient-light dark:bg-gradient-dark p-4 pt-0",children:[(0,n.jsxs)("div",{ref:R,className:"flex flex-col flex-1 overflow-y-auto mb-3",children:[(0,n.jsx)(h.default,{}),(0,n.jsx)(g,{})]}),(null==I?void 0:I.app_code)&&(0,n.jsx)(f.default,{})]})})})}}}]);